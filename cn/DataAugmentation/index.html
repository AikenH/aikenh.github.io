<!doctype html>
<html lang="cn"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Data Augmentation - AikenH Blogs</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Aiken Hong"><meta name="msapplication-TileImage" content="/img/pokemon.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Aiken Hong"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="intergrate with those augmentation method. this doc will  Record those theory and the effect after transformation Show the codes for ez use  And the complete .py will be intergrate in my classificatio"><meta property="og:type" content="blog"><meta property="og:title" content="Data Augmentation"><meta property="og:url" content="http://aikenh.cn/cn/DataAugmentation/"><meta property="og:site_name" content="AikenH Blogs"><meta property="og:description" content="intergrate with those augmentation method. this doc will  Record those theory and the effect after transformation Show the codes for ez use  And the complete .py will be intergrate in my classificatio"><meta property="og:locale" content="cn"><meta property="og:image" content="http://aikenh.cn/img/header_img/lml_bg12.jpg"><meta property="article:published_time" content="2021-11-27T22:24:20.000Z"><meta property="article:modified_time" content="2023-10-30T09:27:38.000Z"><meta property="article:author" content="AikenH"><meta property="article:tag" content="Machine Learning"><meta property="article:tag" content="Augmentation"><meta property="article:tag" content="Pytorch"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://aikenh.cn/img/header_img/lml_bg12.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://aikenh.cn/cn/DataAugmentation/"},"headline":"Data Augmentation","image":["http://aikenh.cn/img/header_img/lml_bg12.jpg"],"datePublished":"2021-11-27T22:24:20.000Z","dateModified":"2023-10-30T09:27:38.000Z","author":{"@type":"Person","name":"AikenH"},"publisher":{"@type":"Organization","name":"AikenH Blogs","logo":{"@type":"ImageObject","url":{"text":"Aiken's Blog"}}},"description":"intergrate with those augmentation method. this doc will  Record those theory and the effect after transformation Show the codes for ez use  And the complete .py will be intergrate in my classificatio"}</script><link rel="canonical" href="http://aikenh.cn/cn/DataAugmentation/"><link rel="icon" href="/img/pokemon.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-dark.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css" title="default"><link rel="alternate stylesheet" href="/css/cyberpunk.css" title="cyberpunk"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="AikenH Blogs" type="application/atom+xml">
</head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">Aiken&#039;s Blog</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/AikenH"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a><a class="navbar-item night" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-lightbulb" id="night-icon"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-9-widescreen"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="/img/header_img/lml_bg12.jpg" alt="Data Augmentation"></span></div><article class="card-content article" role="article"><h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal"><i class="fas fa-angle-double-right"></i>Data Augmentation</h1><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><i class="far fa-calendar-alt"> </i><time dateTime="2021-11-27T22:24:20.000Z" title="2021-11-27T22:24:20.000Z">2021-11-28</time></span><span class="level-item">Updated&nbsp;<time dateTime="2023-10-30T09:27:38.000Z" title="2023/10/30 17:27:38">2023-10-30</time></span><span class="level-item"><a class="link-muted" href="/categories/Machine-Learning/">Machine Learning</a></span><span class="level-item">12 minutes read (About 1760 words)</span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>&nbsp;visits</span></div></div><div class="content"><p>intergrate with those augmentation method.</p>
<p>this doc will</p>
<ul>
<li>Record those theory and the effect after transformation</li>
<li>Show the codes for ez use</li>
</ul>
<p>And the complete <code>.py</code> will be intergrate in my classification pipeline</p>
<p><strong>reference</strong> below:arrow_down_small:, if use them,start it for respect for his work.</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/aleju/imgaug#documentation">aleju/imgaug</a></li>
<li>:star:<a target="_blank" rel="noopener" href="https://github.com/albumentations-team/albumentations">albumentations-team/albumentations: </a></li>
<li><a target="_blank" rel="noopener" href="https://pytorch.org/vision/stable/transforms.html#transforms-on-pil-image-and-torch-tensor">torchvision</a></li>
<li><a target="_blank" rel="noopener" href="https://pillow.readthedocs.io/en/stable/reference/ImageEnhance.html">PIL/ImageEnhance CCBS</a></li>
<li>opencv</li>
</ul>
<h2 id="Principle"><a href="#Principle" class="headerlink" title="Principle"></a>Principle</h2><p><strong>Principle 1</strong> of coding: Don’t reinvent the wheel unless it’s needed</p>
<ul>
<li>具体而言，仅在函数的拓展性较差，无法对其定制化，满足我们的日常需求的时候，我们会自行编写函数从而满足我们的需求，否则我们直接引用已知的库，提升我们的实现效率。</li>
</ul>
<span id="more"></span>
<p><strong>Principle 2</strong> of coding 图像增强的两种使用方式：</p>
<ul>
<li><p>做全集的增强后存储在本地，然后通过<strong>随机</strong>载入或者按一定<strong>batch</strong>的载入来实现我们增强的作用，（or contrasive），这种方式实际上是使用空间来换时间，由于处理是一次性的，所以如果空间充足的话，是更为充足的方式。</p>
</li>
<li><p>动态的在线增强：这种方式比较消耗io和cpu，不推荐，但是如果本地的空间不够，就只能采用这种方式了。</p>
</li>
</ul>
<p><strong>Principle 3</strong> of saving 如果我们要存储本地副本的话，推荐的存储格式和方式</p>
<ul>
<li><p><strong>文件格式</strong>：<code>npz</code> 由于多种增强，实际上这种方式还蛮适合使用<code>npz</code>格式作为我们的存储，这种既保留了对应的<code>np</code>还可以保留对应的字典信息，此外这种方式的存取速度也不算慢，（相较之下好像没有特别突出的一种格式）</p>
</li>
<li><p><strong>路径格式</strong>：<code>imagenet</code>也就是对应的train-class-data的层级关系，通过这种约定俗称的存储关系我们得以在我们框架中的dataset格式方便读入</p>
</li>
</ul>
<h2 id="PIL，CV2，SkImage的选择"><a href="#PIL，CV2，SkImage的选择" class="headerlink" title="PIL，CV2，SkImage的选择"></a>PIL，CV2，SkImage的选择</h2><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/cfca9c4338e7">pytorch图像的加载/读取方式</a> | <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/357069891">cv2、PIL、matplotlib</a> </p>
<p>在这里讲解三个模块之间的基本区别和其中的选择，目前希望将已有的算法从PIL转向CV2，后续也会添加一下三个模块对于Torch的适配性等等</p>
<h3 id="数据读写"><a href="#数据读写" class="headerlink" title="数据读写"></a>数据读写</h3><p>基于下列的代码和注释给出相应的之间的区别，通过这些区别我们可以知道几乎所有的格式在使用的时候都是需要对应的转换的，</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> cv2<br>img  = cv2.imread(<span class="hljs-string">&#x27;lena.png&#x27;</span>) <span class="hljs-comment"># numpy格式，HWC，【0，255】，BGR</span><br>img = cv2.cvtColor(img,cv2.COLOR_BGR2RGB) <span class="hljs-comment"># 除了最下方的转换方式外也可以通过这种方式进行转换</span><br>cv2.imwrite(<span class="hljs-string">&#x27;lena.jpg&#x27;</span>, img) <span class="hljs-comment"># img 需为BGR格式的numpy array</span><br><br><span class="hljs-keyword">import</span> PIL<br><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br>img = Image.<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;lena.png&#x27;</span>) <span class="hljs-comment"># PIL格式，RGB，【0，255】</span><br>img = np.array(img) <span class="hljs-comment"># 转换为numpy格式, HWC</span><br>Img.fromarray(img).save(<span class="hljs-string">&#x27;lena.png&#x27;</span>) <span class="hljs-comment"># x需要转换为PIL.Image格式才能保存</span><br><br><span class="hljs-keyword">from</span> skimage <span class="hljs-keyword">import</span> io <br>img = io.imread(<span class="hljs-string">&#x27;lena.png&#x27;</span>) <span class="hljs-comment"># numpy 格式， RGB，【0，1】 HWC</span><br>io.imsave(<span class="hljs-string">&#x27;lena.jpg&#x27;</span>)<br><br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br>img = plt.imread(<span class="hljs-string">&#x27;lena.png&#x27;</span>) <span class="hljs-comment"># numpy 格式，HWC [0,255] RGB</span><br>plt.imsave(<span class="hljs-string">&#x27;lena.jpg&#x27;</span>)<br><br><span class="hljs-comment"># BGR 转换 RGB, 转回来也是一样的操作 </span><br>img_rgb = img_bgr[:,:,::-<span class="hljs-number">1</span>]<br></code></pre></td></tr></table></figure>
<p>基于上述的代码，我们可以总结出：</p>
<p>当我们使用matplotlib的时候</p>
<ul>
<li>当我们用cv2读取图像的时候若要进行matplotlib的展示，我们需要对其做<code>bgr2rgb</code>的转换，PIL则需要做到numpy的转换，skimage考虑归一化方面的问题</li>
</ul>
<p>当我们要使用tensror格式的时候</p>
<ul>
<li><p>我们需要对cv2转换成RGB</p>
</li>
<li><p>对三个方法都是用<code>transpose</code>或者类似的方法转换到CHW</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch <br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br>torch_img = torch.from_numpy(np.transpose(img,(<span class="hljs-number">2</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>)))<br></code></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="简单图像增强"><a href="#简单图像增强" class="headerlink" title="简单图像增强"></a>简单图像增强</h2><p>在这里由于opencv更为强大且全面，我们将框架转移到opencv中进行图像增强处理，于是本章节会主要介绍<code>opencv</code>, <code>torchvision中的图像增强，同时也会对</code>pillow<code>,</code>skimage`进行简单的介绍。</p>
<h3 id="TorchVision"><a href="#TorchVision" class="headerlink" title="TorchVision"></a>TorchVision</h3><p>torchvision的使用实际上是最简单便捷的，为了协调统一，该类变换我们在totensor后进行使用，接在其他所有变换的后面，实际上有一些变换是可以获取参数的，要调用的对应函数我们可以在对应<a target="_blank" rel="noopener" href="https://pytorch.org/vision/stable/transforms.html#scriptable-transforms">文档</a>中查询</p>
<p><strong>随机机制：</strong>现已向后兼容torch</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 随机种子采用torch</span><br><span class="hljs-keyword">import</span> torch <br>torch.manual_seed(<span class="hljs-number">17</span>)<br><br><span class="hljs-comment"># KEY FUNCTION: 给一个transformers加上概率，以一定的概率执行该操作</span><br>transformers.RandomApply(transforms,p=<span class="hljs-number">0.5</span>)<br><br><span class="hljs-comment"># Key Function：从给定的一系列transforms中选一个进行操作</span><br>transformers.RandomChoice(transforms)<br></code></pre></td></tr></table></figure>
<p>由于存在<code>randomapply</code>这个函数，所以实际上我们在调用变换的时候，我们可以用prefix random去搜补全，如果没有的话，也可以使用<code>RandomApply</code>来手动赋予随机性。</p>
<p><strong>组合机制：</strong>同时使用多种变换，这种方法将一组强关联的变换进行组合，简化后续的使用，但是对于我们如果需要做多种增强的话，实际上并不是一个合适的方式。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># a simple example for torchvision&#x27;s transformer</span><br>transform = transforms.Compose([<br>	transforms.CenterCrop(<span class="hljs-number">10</span>),<br>	transforms.PILtoTensor(),<br>	transforms.ConvertImageDtype(torch.<span class="hljs-built_in">float</span>)<br>])<br></code></pre></td></tr></table></figure>
<p><strong>常见的一些增强：</strong><a target="_blank" rel="noopener" href="https://www.bilibili.com/read/cv7313702/">列在下面</a></p>
<ul>
<li><p>裁剪系列：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># cental crop</span><br>transforms.CenterCrop(size), <br><br><span class="hljs-comment"># five corners and the cental crop</span><br>transforms.FiveCrop(size), <br><span class="hljs-keyword">lambda</span>(<span class="hljs-keyword">lambda</span> crops: torch.stack[ToTensor()(crop) <span class="hljs-keyword">for</span> crop <span class="hljs-keyword">in</span> crops])<br><br><span class="hljs-comment"># 随机裁剪到对应的尺寸，</span><br>transforms.RandomCrop(size, padding=<span class="hljs-literal">None</span>, pad_if_needed=<span class="hljs-literal">False</span>, fill=<span class="hljs-number">0</span>, padding_mode=<span class="hljs-string">&#x27;constant&#x27;</span>) <br><br><span class="hljs-comment"># 随机裁剪后resize到指定的尺寸</span><br>transforms.RandomResizedCropsize, scale=(<span class="hljs-number">0.08</span>, <span class="hljs-number">1.0</span>), ratio=(<span class="hljs-number">0.75</span>, <span class="hljs-number">1.33</span>), interpolation=&lt;InterpolationMode.BILINEAR: <span class="hljs-string">&#x27;bilinear&#x27;</span>&gt;)<br>                             <br><span class="hljs-comment"># Padding 无需多言</span><br>transformers.Pad(padding,fill=<span class="hljs-number">0</span>,padding_mode=<span class="hljs-string">&#x27;constant&#x27;</span>)<br></code></pre></td></tr></table></figure>
</li>
<li><p>色彩变换增强</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 色彩抖动,随机改变亮度对比度饱和度和色调</span><br>transforms.Colorjitter(brightness=<span class="hljs-number">0</span>, contrast=<span class="hljs-number">0</span>, saturation=<span class="hljs-number">0</span>, hue=<span class="hljs-number">0</span>)<br><br><span class="hljs-comment"># 图像转换为灰度</span><br>transforms.grayscale(num_output_channel=<span class="hljs-number">1</span>)<br><br></code></pre></td></tr></table></figure>
</li>
<li><p>几何变换增强</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 仿射变换</span><br>transformers.RandomAffine(degrees, translate=<span class="hljs-literal">None</span>, scale=<span class="hljs-literal">None</span>, shear=<span class="hljs-literal">None</span>, interpolation=&lt;InterpolationMode.NEAREST: <span class="hljs-string">&#x27;nearest&#x27;</span>&gt;, fill=<span class="hljs-number">0</span>, fillcolor=<span class="hljs-literal">None</span>, resample=<span class="hljs-literal">None</span>)<br><span class="hljs-comment"># 可以通过以下函数获取变换矩阵</span><br>get_params(degrees: <span class="hljs-type">List</span>[<span class="hljs-built_in">float</span>], translate: <span class="hljs-type">Optional</span>[<span class="hljs-type">List</span>[<span class="hljs-built_in">float</span>]], scale_ranges: <span class="hljs-type">Optional</span>[<span class="hljs-type">List</span>[<span class="hljs-built_in">float</span>]], shears: <span class="hljs-type">Optional</span>[<span class="hljs-type">List</span>[<span class="hljs-built_in">float</span>]], img_size: <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]) → <span class="hljs-type">Tuple</span>[<span class="hljs-built_in">float</span>, <span class="hljs-type">Tuple</span>[<span class="hljs-built_in">int</span>, <span class="hljs-built_in">int</span>], <span class="hljs-built_in">float</span>, <span class="hljs-type">Tuple</span>[<span class="hljs-built_in">float</span>, <span class="hljs-built_in">float</span>]]<br><br>transforms.RandomHorizontalFlip(p=<span class="hljs-number">0.5</span>)<br>transforms.RandomPerspective(distortion_scale=<span class="hljs-number">0.5</span>, p=<span class="hljs-number">0.5</span>, interpolation=&lt;InterpolationMode.BILINEAR: <span class="hljs-string">&#x27;bilinear&#x27;</span>&gt;, fill=<span class="hljs-number">0</span>)<br>RandomResizedCrop<br></code></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="OpenCV"><a href="#OpenCV" class="headerlink" title="OpenCV"></a>OpenCV</h3><h4 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h4><p>Ubuntu：安装opencv的python版本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">apt-get -y python3-opencv<br>pip install opencv-python<br></code></pre></td></tr></table></figure>
<h4 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h4><p>这一部分可能主要还是对OpenCV基础使用方式的介绍，至于数据增强方面，上面有一个库已经集成了很大一部分图像增强的操作，且在效率上也有了很高的优化和证实，简单的使用方式如下。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">try</span>:<br>    <span class="hljs-keyword">import</span> albumentations <span class="hljs-keyword">as</span> A<br><span class="hljs-keyword">except</span> ImportError:<br>    os.system(<span class="hljs-string">&quot;pip install - U albumentations&quot;</span>)<br>    <span class="hljs-keyword">import</span> albumentations <span class="hljs-keyword">as</span> A<br><span class="hljs-keyword">import</span> cv2<br><br><span class="hljs-comment"># Declare an augmentation pipeline</span><br>transform = A.Compose([<br>    A.RandomCrop(width=<span class="hljs-number">256</span>, height=<span class="hljs-number">256</span>),<br>    A.HorizontalFlip(p=<span class="hljs-number">0.5</span>),<br>    A.RandomBrightnessContrast(p=<span class="hljs-number">0.2</span>),<br>])<br><br><span class="hljs-comment"># Read an image with OpenCV and convert it to the RGB colorspace</span><br>image = cv2.imread(<span class="hljs-string">&quot;image.jpg&quot;</span>)<br>image = cv2.cvtColor(image, cv2.COLOR_BGR2RGB)<br><br><span class="hljs-comment"># Augment an image</span><br>transformed = transform(image=image)<br>transformed_image = transformed[<span class="hljs-string">&quot;image&quot;</span>]<br></code></pre></td></tr></table></figure>
<p>下面我们会讲一些opencv中的简单使用方式：</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/silence-cho/p/10926248.html">(一)OpenCV-Python学习—基础知识 - silence_cho - 博客园 (cnblogs.com)</a></p>
<h3 id="Pillow"><a href="#Pillow" class="headerlink" title="Pillow"></a>Pillow</h3><p>Using PIL do <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/74053773">some augmentation</a></p>
<ol>
<li>CCBS： color，contrast，brightness，shapen</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># way1：PIL</span><br><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> ImageEnhance<br>ccbs_img = ImageEnhance.Color(img).enhance(factor1)<br>...<br></code></pre></td></tr></table></figure>
<ol>
<li><p>Blur，Detail，Edge_Enhance，Smooth，Sharpen…</p>
<p>自行在文档中找到对应的方法，实际上不是很多</p>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br><span class="hljs-keyword">from</span> PIL.ImageFillter <span class="hljs-keyword">import</span> SMOOTH,BLUR<br>img = Image.<span class="hljs-built_in">open</span>(image_pah)<br>img_1 = img.filtter(BLUR)<br>img_2 = img.filtter(SMOOTH)<br></code></pre></td></tr></table></figure>
<h3 id="SkImage"><a href="#SkImage" class="headerlink" title="SkImage"></a>SkImage</h3><p>…</p>
<h2 id="混合图像增强（For-ML）"><a href="#混合图像增强（For-ML）" class="headerlink" title="混合图像增强（For ML）"></a>混合图像增强（For ML）</h2><p>==ALL in one 不是什么好点子==<br>为了对Machine Learning中的任务进行图像增强任务，我们在过程中可能会使用一些Github Repo，主要可能就是albumation，在进行图像增强和数据混合的过程中，我们会遇到的问题包括：</p>
<ul>
<li>PIL和NP，Tensor的三者格式不对应的关系</li>
<li>Channel混杂的关系</li>
<li>调用transformer的形式不统一的问题</li>
</ul>
<p>为此我们特地开了这个专题，介绍一下使用的方式，以及使我们在后续的使用过程中注意最终转换到datalist中最好采用统一的存储形式</p>
<ol>
<li>path（load by cv or pil，st np）</li>
<li>data （np（else），tensor（cuda）for instant use）</li>
</ol>
<p>以此来规范我们的dataset，and sampler or mixer</p>
<p>我们可以尝试使用如下的方式来进行transformer的管理操作，此外如果我们要用的是纯粹的数据增强而不是用来dataloader的transformer，我们就不要用这个逻辑去做，我们直接集成Augmentation就好了<br>ch</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">mytransformer</span>():<br>	<span class="hljs-comment"># if augs is not none we need to add ToPIL to get the right data type</span><br>	<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_transformers</span>():<br>		self.transformer = &#123;<br>			<span class="hljs-string">&#x27;augs&#x27;</span>: Augs.Compose([]),<br>			<span class="hljs-string">&#x27;trans&#x27;</span>: transformers.Compose([<br>				tranformers.ToPIL(),<br>				...<br>			]),<br>		&#125;<br><br>	<span class="hljs-comment"># then we using k-v pair to do all my transformer, </span><br>	<span class="hljs-keyword">def</span> <span class="hljs-title function_">__call__</span>(<span class="hljs-params">img</span>):<br>		<span class="hljs-keyword">for</span> k,v <span class="hljs-keyword">in</span> transformer:<br>			img = transformer[<span class="hljs-string">&#x27;augs&#x27;</span>](image=img)[<span class="hljs-string">&#x27;image&#x27;</span>]<br>			img = transformer[<span class="hljs-string">&#x27;trans&#x27;</span>](img)<br>		<span class="hljs-keyword">return</span> img<br>	<br></code></pre></td></tr></table></figure>
<h2 id="特殊图像增强"><a href="#特殊图像增强" class="headerlink" title="特殊图像增强"></a>特殊图像增强</h2><p>…</p>
</div><div class="article-licensing box"><div class="licensing-title"><p>Data Augmentation</p><p><a href="http://aikenh.cn/cn/DataAugmentation/">http://aikenh.cn/cn/DataAugmentation/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>AikenH</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2021-11-28</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2023-10-30</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><hr style="height:1px;margin:1rem 0"><div class="level is-mobile is-flex"><div class="article-tags is-size-7 is-uppercase"><i class="fas fa-tags has-text-grey"></i> <a class="link-muted" rel="tag" href="/tags/Machine-Learning/">Machine Learning, </a><a class="link-muted" rel="tag" href="/tags/Augmentation/">Augmentation, </a><a class="link-muted" rel="tag" href="/tags/Pytorch/">Pytorch </a></div></div><!--!--></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">Like this article? Support the author with</h3><div class="buttons is-centered"><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>Alipay</span><span class="qrcode"><img src="/img/alipay.jpg" alt="Alipay"></span></a><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>Wechat</span><span class="qrcode"><img src="/img/wechat.jpg" alt="Wechat"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/cn/Linux/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Linux 基础操作 01</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/cn/MLFlow/"><span class="level-item">MLFlow</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_config = function () {
            this.page.url = 'http://aikenh.cn/cn/DataAugmentation/';
            this.page.identifier = 'cn/DataAugmentation/';
        };
        (function() {
            var d = document, s = d.createElement('script');  
            s.src = '//' + 'my-tech-blog-3' + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/title.jpg" alt="AikenH"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">AikenH</p><p class="is-size-6 is-block">Future Full-Stack Developer</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>ShenZhen</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">135</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">42</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">100</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/AikenH" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="ZhiHu" href="https://www.zhihu.com/people/Aiken-h"><i class="fab fa-zhihu"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Weibo" href="https://weibo.com/u/1788200627"><i class="fab fa-weibo"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Steam" href="https://steamcommunity.com/id/AikenH/"><i class="fab fa-steam"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/AikenH"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/atom.xml"><i class="fas fa-rss"></i></a></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="level is-mobile" href="#Principle"><span class="level-left"><span class="level-item">1</span><span class="level-item">Principle</span></span></a></li><li><a class="level is-mobile" href="#PIL，CV2，SkImage的选择"><span class="level-left"><span class="level-item">2</span><span class="level-item">PIL，CV2，SkImage的选择</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#数据读写"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">数据读写</span></span></a></li></ul></li><li><a class="level is-mobile" href="#简单图像增强"><span class="level-left"><span class="level-item">3</span><span class="level-item">简单图像增强</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#TorchVision"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">TorchVision</span></span></a></li><li><a class="level is-mobile" href="#OpenCV"><span class="level-left"><span class="level-item">3.2</span><span class="level-item">OpenCV</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Install"><span class="level-left"><span class="level-item">3.2.1</span><span class="level-item">Install</span></span></a></li><li><a class="level is-mobile" href="#Usage"><span class="level-left"><span class="level-item">3.2.2</span><span class="level-item">Usage</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Pillow"><span class="level-left"><span class="level-item">3.3</span><span class="level-item">Pillow</span></span></a></li><li><a class="level is-mobile" href="#SkImage"><span class="level-left"><span class="level-item">3.4</span><span class="level-item">SkImage</span></span></a></li></ul></li><li><a class="level is-mobile" href="#混合图像增强（For-ML）"><span class="level-left"><span class="level-item">4</span><span class="level-item">混合图像增强（For ML）</span></span></a></li><li><a class="level is-mobile" href="#特殊图像增强"><span class="level-left"><span class="level-item">5</span><span class="level-item">特殊图像增强</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><figure class="media-left"><a class="image" href="/cn/%E5%AE%B6%E5%BA%AD%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%B4%E4%BD%93%E6%96%B9%E6%A1%88/"><img src="/img/header_img/lml_bg1.jpg" alt="家庭服务器整体方案"></a></figure><div class="media-content"><p class="date"><time dateTime="2023-12-09T00:24:36.000Z">2023-12-09</time></p><p class="title"><a href="/cn/%E5%AE%B6%E5%BA%AD%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%B4%E4%BD%93%E6%96%B9%E6%A1%88/">家庭服务器整体方案</a></p><p class="categories"><a href="/categories/NAS/">NAS</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/cn/%E6%A0%91%E8%8E%93%E6%B4%BE%E5%AE%B6%E5%BA%AD%E5%BD%B1%E9%9F%B3%E4%B8%AD%E5%BF%832/"><img src="/img/header_img/lml_bg1.jpg" alt="树莓派家庭影音中心2"></a></figure><div class="media-content"><p class="date"><time dateTime="2023-11-11T04:08:37.000Z">2023-11-11</time></p><p class="title"><a href="/cn/%E6%A0%91%E8%8E%93%E6%B4%BE%E5%AE%B6%E5%BA%AD%E5%BD%B1%E9%9F%B3%E4%B8%AD%E5%BF%832/">树莓派家庭影音中心2</a></p><p class="categories"><a href="/categories/Dev/">Dev</a> / <a href="/categories/Dev/Raspberry-pie/">Raspberry-pie</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/cn/emby_localhost_crack_by_nginx/"><img src="/img/header_img/lml_bg2.jpg" alt="破解本地自托管Emby服务"></a></figure><div class="media-content"><p class="date"><time dateTime="2023-11-10T06:05:15.000Z">2023-11-10</time></p><p class="title"><a href="/cn/emby_localhost_crack_by_nginx/">破解本地自托管Emby服务</a></p><p class="categories"><a href="/categories/NAS/">NAS</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/cn/deploy_server_byipv6_03_ddnsgo/"><img src="/img/header_img/lml_bg12.jpg" alt="使用Ipv6部署服务03 DDNS-go 动态域名解析"></a></figure><div class="media-content"><p class="date"><time dateTime="2023-11-07T05:40:13.000Z">2023-11-07</time></p><p class="title"><a href="/cn/deploy_server_byipv6_03_ddnsgo/">使用Ipv6部署服务03 DDNS-go 动态域名解析</a></p><p class="categories"><a href="/categories/NAS/">NAS</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/cn/deploy_server_byipv6_02_nginx/"><img src="/img/header_img/lml_bg14.jpg" alt="使用Ipv6部署服务02 Nginx和Https"></a></figure><div class="media-content"><p class="date"><time dateTime="2023-11-06T12:49:16.000Z">2023-11-06</time></p><p class="title"><a href="/cn/deploy_server_byipv6_02_nginx/">使用Ipv6部署服务02 Nginx和Https</a></p><p class="categories"><a href="/categories/NAS/">NAS</a></p></div></article></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">Aiken&#039;s Blog</a><p class="is-size-7"><span>&copy; 2023 AikenH</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_pv">Visited by <span id="busuanzi_value_site_uv">0</span> users</span> and <span id="busuanzi_container2_site_uv"><span id="busuanzi_value_site_pv">0</span>&nbsp;visits</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.9/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><script src="/js/night.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>