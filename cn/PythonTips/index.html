<!doctype html>
<html lang="cn"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>（转）What the Fuck Python！ 一些python特性 - AikenH Blogs</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Aiken Hong"><meta name="msapplication-TileImage" content="/img/pokemon.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Aiken Hong"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="What the f*ck Python! 🐍 一些有趣且鲜为人知的 Python 特性.   English | 中文    Python, 是一个设计优美的解释型高级语言, 它提供了很多能让程序员感到舒适的功能特性. 但有的时候, Python 的一些输出结果对于初学者来说似乎并不是那么一目了然. 这个有趣的项目意在收集 Python 中那些难以理解和反人类直觉的例子以及鲜为人知的功能特性"><meta property="og:type" content="blog"><meta property="og:title" content="（转）What the Fuck Python！ 一些python特性"><meta property="og:url" content="http://aikenh.cn/cn/PythonTips/"><meta property="og:site_name" content="AikenH Blogs"><meta property="og:description" content="What the f*ck Python! 🐍 一些有趣且鲜为人知的 Python 特性.   English | 中文    Python, 是一个设计优美的解释型高级语言, 它提供了很多能让程序员感到舒适的功能特性. 但有的时候, Python 的一些输出结果对于初学者来说似乎并不是那么一目了然. 这个有趣的项目意在收集 Python 中那些难以理解和反人类直觉的例子以及鲜为人知的功能特性"><meta property="og:locale" content="cn"><meta property="og:image" content="http://aikenh.cn/img/header_img/lml_bg32.jpg"><meta property="article:published_time" content="2021-11-27T22:24:23.000Z"><meta property="article:modified_time" content="2023-10-30T09:27:38.000Z"><meta property="article:author" content="AikenH"><meta property="article:tag" content="Python"><meta property="article:tag" content="Langs"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://aikenh.cn/img/header_img/lml_bg32.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://aikenh.cn/cn/PythonTips/"},"headline":"（转）What the Fuck Python！ 一些python特性","image":["http://aikenh.cn/img/header_img/lml_bg32.jpg"],"datePublished":"2021-11-27T22:24:23.000Z","dateModified":"2023-10-30T09:27:38.000Z","author":{"@type":"Person","name":"AikenH"},"publisher":{"@type":"Organization","name":"AikenH Blogs","logo":{"@type":"ImageObject","url":{"text":"Aiken's Blog"}}},"description":"What the f*ck Python! 🐍 一些有趣且鲜为人知的 Python 特性.   English | 中文    Python, 是一个设计优美的解释型高级语言, 它提供了很多能让程序员感到舒适的功能特性. 但有的时候, Python 的一些输出结果对于初学者来说似乎并不是那么一目了然. 这个有趣的项目意在收集 Python 中那些难以理解和反人类直觉的例子以及鲜为人知的功能特性"}</script><link rel="canonical" href="http://aikenh.cn/cn/PythonTips/"><link rel="icon" href="/img/pokemon.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-dark.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css" title="default"><link rel="alternate stylesheet" href="/css/cyberpunk.css" title="cyberpunk"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="AikenH Blogs" type="application/atom+xml">
</head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">Aiken&#039;s Blog</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/AikenH"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a><a class="navbar-item night" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-lightbulb" id="night-icon"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-9-widescreen"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="/img/header_img/lml_bg32.jpg" alt="（转）What the Fuck Python！ 一些python特性"></span></div><article class="card-content article" role="article"><h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal"><i class="fas fa-angle-double-right"></i>（转）What the Fuck Python！ 一些python特性</h1><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><i class="far fa-calendar-alt"> </i><time dateTime="2021-11-27T22:24:23.000Z" title="2021-11-27T22:24:23.000Z">2021-11-28</time></span><span class="level-item">Updated&nbsp;<time dateTime="2023-10-30T09:27:38.000Z" title="2023/10/30 17:27:38">2023-10-30</time></span><span class="level-item"><a class="link-muted" href="/categories/Langs/">Langs</a><span> / </span><a class="link-muted" href="/categories/Langs/Python/">Python</a></span><span class="level-item">an hour read (About 12282 words)</span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>&nbsp;visits</span></div></div><div class="content"><p align="center"><img src="/images/logo.png" alt=""></p>
<h1 align="center">What the f*ck Python! 🐍</h1>
<p align="center">一些有趣且鲜为人知的 Python 特性.</p>

<p><p align="center">
<a target="_blank" rel="noopener" href="https://github.com/satwikkansal/wtfpython">English</a>
| <a href="#">中文</a>
</p><br><a target="_blank" rel="noopener" href="http://www.wtfpl.net"><img src="https://img.shields.io/badge/License-WTFPL%202.0-lightgrey.svg?style=flat-square" alt="WTFPL 2.0"></a> <a target="_blank" rel="noopener" href="https://github.com/satwikkansal/wtfpython/commit/30e05a5973930c38cdb59f1c02b85b19b22ac531"><img src="https://img.shields.io/badge/Commit-30e05a-yellow.svg" alt="Commit id"></a> <a target="_blank" rel="noopener" href="https://996.icu"><img src="https://img.shields.io/badge/link-996.icu-red.svg" alt="996.icu"></a></p>
<p>Python, 是一个设计优美的解释型高级语言, 它提供了很多能让程序员感到舒适的功能特性. 但有的时候, Python 的一些输出结果对于初学者来说似乎并不是那么一目了然.</p>
<p>这个有趣的项目意在收集 Python 中那些难以理解和反人类直觉的例子以及鲜为人知的功能特性, 并尝试讨论这些现象背后真正的原理!</p>
<p>虽然下面的有些例子并不一定会让你觉得 WTFs, 但它们依然有可能会告诉你一些你所不知道的 Python 有趣特性.  我觉得这是一种学习编程语言内部原理的好办法, 而且我相信你也会从中获得乐趣!</p>
<p>如果您是一位经验比较丰富的 Python 程序员, 你可以尝试挑战看是否能一次就找到例子的正确答案. 你可能对其中的一些例子已经比较熟悉了, 那这也许能唤起你当年踩这些坑时的甜蜜回忆 :sweat_smile:</p>
<p>PS: 如果你不是第一次读了, 你可以在<a target="_blank" rel="noopener" href="https://github.com/satwikkansal/wtfpython/releases/">这里</a>获取变动内容.</p>
<p>那么, 让我们开始吧…<br><span id="more"></span></p>
<h1 id="Table-of-Contents-目录"><a href="#Table-of-Contents-目录" class="headerlink" title="Table of Contents/目录"></a>Table of Contents/目录</h1><!-- TOC -->
<ul>
<li><a href="#table-of-contents目录">Table of Contents/目录</a></li>
<li><a href="#structure-of-the-examples示例结构">Structure of the Examples/示例结构</a></li>
<li><a href="#usage用法">Usage/用法</a></li>
<li><a href="#-examples示例">👀 Examples/示例</a><ul>
<li><a href="#section-strain-your-brain大脑运动">Section: Strain your brain!/大脑运动!</a><ul>
<li><a href="#-strings-can-be-tricky-sometimes微妙的字符串-">&gt; Strings can be tricky sometimes/微妙的字符串 *</a></li>
<li><a href="#-time-for-some-hash-brownies是时候来点蛋糕了">&gt; Time for some hash brownies!/是时候来点蛋糕了!</a></li>
<li><a href="#-return-return-everywhere到处返回">&gt; Return return everywhere!/到处返回！</a></li>
<li><a href="#-deep-down-were-all-the-same本质上我们都一样-">&gt; Deep down, we’re all the same./本质上,我们都一样. *</a></li>
<li><a href="#-for-what为什么">&gt; For what?/为什么?</a></li>
<li><a href="#-evaluation-time-discrepancy执行时机差异">&gt; Evaluation time discrepancy/执行时机差异</a></li>
<li><a href="#-is-is-not-what-it-is出人意料的is">&gt; <code>is</code> is not what it is!/出人意料的<code>is</code>!</a></li>
<li><a href="#-a-tic-tac-toe-where-x-wins-in-the-first-attempt一蹴即至">&gt; A tic-tac-toe where X wins in the first attempt!/一蹴即至!</a></li>
<li><a href="#-the-sticky-output-function麻烦的输出">&gt; The sticky output function/麻烦的输出</a></li>
<li><a href="#-is-not--is-not-is-not-is-not--不是-is-not-">&gt; <code>is not ...</code> is not <code>is (not ...)</code>/<code>is not ...</code> 不是 <code>is (not ...)</code></a></li>
<li><a href="#-the-surprising-comma意外的逗号">&gt; The surprising comma/意外的逗号</a></li>
<li><a href="#-backslashes-at-the-end-of-string字符串末尾的反斜杠">&gt; Backslashes at the end of string/字符串末尾的反斜杠</a></li>
<li><a href="#-not-knot别纠结">&gt; not knot!/别纠结!</a></li>
<li><a href="#-half-triple-quoted-strings三个引号">&gt; Half triple-quoted strings/三个引号</a></li>
<li><a href="#-midnight-time-doesnt-exist不存在的午夜">&gt; Midnight time doesn’t exist?/不存在的午夜?</a></li>
<li><a href="#-whats-wrong-with-booleans布尔你咋了">&gt; What’s wrong with booleans?/布尔你咋了?</a></li>
<li><a href="#-class-attributes-and-instance-attributes类属性和实例属性">&gt; Class attributes and instance attributes/类属性和实例属性</a></li>
<li><a href="#-yielding-none生成-none">&gt; yielding None/生成 None</a></li>
<li><a href="#-mutating-the-immutable强人所难">&gt; Mutating the immutable!/强人所难</a></li>
<li><a href="#-the-disappearing-variable-from-outer-scope消失的外部变量">&gt; The disappearing variable from outer scope/消失的外部变量</a></li>
<li><a href="#-when-true-is-actually-false真亦假">&gt; When True is actually False/真亦假</a></li>
<li><a href="#-from-filled-to-none-in-one-instruction从有到无">&gt; From filled to None in one instruction…/从有到无…</a></li>
<li><a href="#-subclass-relationships子类关系-">&gt; Subclass relationships/子类关系 *</a></li>
<li><a href="#-the-mysterious-key-type-conversion神秘的键型转换-">&gt; The mysterious key type conversion/神秘的键型转换 *</a></li>
<li><a href="#-lets-see-if-you-can-guess-this看看你能否猜到这一点">&gt; Let’s see if you can guess this?/看看你能否猜到这一点?</a></li>
</ul>
</li>
<li><a href="#section-appearances-are-deceptive外表是靠不住的">Section: Appearances are deceptive!/外表是靠不住的!</a><ul>
<li><a href="#-skipping-lines跳过一行">&gt; Skipping lines?/跳过一行?</a></li>
<li><a href="#-teleportation空间移动-">&gt; Teleportation/空间移动 *</a></li>
<li><a href="#-well-something-is-fishy嗯有些可疑">&gt; Well, something is fishy…/嗯, 有些可疑…</a></li>
</ul>
</li>
<li><a href="#section-watch-out-for-the-landmines小心地雷">Section: Watch out for the landmines!/小心地雷!</a><ul>
<li><a href="#-modifying-a-dictionary-while-iterating-over-it迭代字典时的修改">&gt; Modifying a dictionary while iterating over it/迭代字典时的修改</a></li>
<li><a href="#-stubborn-del-operator坚强的-del-">&gt; Stubborn <code>del</code> operator/坚强的 <code>del</code> *</a></li>
<li><a href="#-deleting-a-list-item-while-iterating迭代列表时删除元素">&gt; Deleting a list item while iterating/迭代列表时删除元素</a></li>
<li><a href="#-loop-variables-leaking-out循环变量泄漏">&gt; Loop variables leaking out!/循环变量泄漏!</a></li>
<li><a href="#-beware-of-default-mutable-arguments当心默认的可变参数">&gt; Beware of default mutable arguments!/当心默认的可变参数!</a></li>
<li><a href="#-catching-the-exceptions捕获异常">&gt; Catching the Exceptions/捕获异常</a></li>
<li><a href="#-same-operands-different-story同人不同命">&gt; Same operands, different story!/同人不同命!</a></li>
<li><a href="#-the-out-of-scope-variable外部作用域变量">&gt; The out of scope variable/外部作用域变量</a></li>
<li><a href="#-be-careful-with-chained-operations小心链式操作">&gt; Be careful with chained operations/小心链式操作</a></li>
<li><a href="#-name-resolution-ignoring-class-scope忽略类作用域的名称解析">&gt; Name resolution ignoring class scope/忽略类作用域的名称解析</a></li>
<li><a href="#-needle-in-a-haystack大海捞针">&gt; Needle in a Haystack/大海捞针</a></li>
</ul>
</li>
<li><a href="#section-the-hidden-treasures隐藏的宝藏">Section: The Hidden treasures!/隐藏的宝藏!</a><ul>
<li><a href="#-okay-python-can-you-make-me-flypython-可否带我飞-">&gt; Okay Python, Can you make me fly?/Python, 可否带我飞? *</a></li>
<li><a href="#-goto-but-whygoto-但为什么-">&gt; <code>goto</code>, but why?/<code>goto</code>, 但为什么? *</a></li>
<li><a href="#-brace-yourself做好思想准备-">&gt; Brace yourself!/做好思想准备 *</a></li>
<li><a href="#-lets-meet-friendly-language-uncle-for-life让生活更友好-">&gt; Let’s meet Friendly Language Uncle For Life/让生活更友好 *</a></li>
<li><a href="#-even-python-understands-that-love-is-complicated连Python也知道爱是难言的-">&gt; Even Python understands that love is complicated/连Python也知道爱是难言的 *</a></li>
<li><a href="#-yes-it-exists是的-它存在">&gt; Yes, it exists!/是的, 它存在!</a></li>
<li><a href="#-inpinity无限-">&gt; Inpinity/无限 *</a></li>
<li><a href="#-mangling-time修饰时间-">&gt; Mangling time!修饰时间! *</a></li>
</ul>
</li>
<li><a href="#section-miscellaneous杂项">Section: Miscellaneous/杂项</a><ul>
<li><a href="#--is-faster更快的-">&gt; <code>+=</code> is faster/更快的 <code>+=</code> </a></li>
<li><a href="#-lets-make-a-giant-string来做个巨大的字符串吧">&gt; Let’s make a giant string!/来做个巨大的字符串吧!</a></li>
<li><a href="#-explicit-typecast-of-strings字符串的显式类型转换">&gt; Explicit typecast of strings/字符串的显式类型转换</a></li>
<li><a href="#-minor-ones小知识点">&gt; Minor Ones/小知识点</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#contributing贡献">Contributing/贡献</a></li>
<li><a href="#acknowledgements致谢">Acknowledgements/致谢</a></li>
<li><a href="#-license许可">🎓 License/许可</a><ul>
<li><a href="#help帮助">Help/帮助</a></li>
<li><a href="#surprise-your-geeky-pythonist-friends想给你的极客朋友一个惊喜">Surprise your geeky pythonist friends?/想给你的极客朋友一个惊喜?</a></li>
<li><a href="#need-a-pdf-version需要来一份pdf版的">Need a pdf version?/需要来一份pdf版的?</a></li>
<li><a href="#follow-commit追踪Commit">Follow Commit/追踪Commit</a></li>
<li><a href="#996icu">996.icu</a></li>
</ul>
</li>
</ul>
<!-- /TOC -->
<h1 id="Structure-of-the-Examples-示例结构"><a href="#Structure-of-the-Examples-示例结构" class="headerlink" title="Structure of the Examples/示例结构"></a>Structure of the Examples/示例结构</h1><p>所有示例的结构都如下所示:</p>
<blockquote>
<h3 id="gt-一个精选的标题"><a href="#gt-一个精选的标题" class="headerlink" title="&gt; 一个精选的标题 *"></a>&gt; 一个精选的标题 *</h3><p>标题末尾的星号表示该示例在第一版中不存在，是最近添加的.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 准备代码.</span><br><span class="hljs-comment"># 释放魔法...</span><br></code></pre></td></tr></table></figure>
<p><strong>Output (Python version):</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>触发语句<br>出乎意料的输出结果<br></code></pre></td></tr></table></figure><br>(可选): 对意外输出结果的简短描述.</p>
<h4 id="💡-说明"><a href="#💡-说明" class="headerlink" title="💡 说明:"></a>💡 说明:</h4><ul>
<li>简要说明发生了什么以及为什么会发生.<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">如有必要, 举例说明<br></code></pre></td></tr></table></figure>
<strong>Output:</strong><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>触发语句 <span class="hljs-comment"># 一些让魔法变得容易理解的例子</span><br><span class="hljs-comment"># 一些正常的输入</span><br></code></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<p><strong>注意:</strong> 所有的示例都在 Python 3.5.2 版本的交互解释器上测试过, 如果不特别说明应该适用于所有 Python 版本.</p>
<h1 id="Usage-用法"><a href="#Usage-用法" class="headerlink" title="Usage/用法"></a>Usage/用法</h1><p>我个人建议, 最好依次阅读下面的示例, 并对每个示例:</p>
<ul>
<li>仔细阅读设置例子最开始的代码.  如果您是一位经验丰富的 Python 程序员, 那么大多数时候您都能成功预期到后面的结果.</li>
<li>阅读输出结果,<ul>
<li>确认结果是否如你所料.</li>
<li>确认你是否知道这背后的原理.<ul>
<li>如果不知道, 深呼吸然后阅读说明 (如果你还是看不明白, 别沉默! 可以在<a target="_blank" rel="noopener" href="https://github.com/satwikkansal/wtfPython">这</a>提个 issue).</li>
<li>如果知道, 给自己点奖励, 然后去看下一个例子.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>PS: 你也可以在命令行阅读 WTFpython. 我们有 pypi 包 和 npm 包(支持代码高亮).(译: 这两个都是英文版的)</p>
<p>安装 npm 包 <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/wtfpython"><code>wtfpython</code></a><br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ npm install -g wtfpython<br></code></pre></td></tr></table></figure></p>
<p>或者, 安装 pypi 包 <a target="_blank" rel="noopener" href="https://pypi.python.org/pypi/wtfpython"><code>wtfpython</code></a><br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ pip install wtfpython -U<br></code></pre></td></tr></table></figure></p>
<p>现在, 在命令行中运行 <code>wtfpython</code>, 你就可以开始浏览了.</p>
<hr>
<h1 id="👀-Examples-示例"><a href="#👀-Examples-示例" class="headerlink" title="👀 Examples/示例"></a>👀 Examples/示例</h1><h2 id="Section-Strain-your-brain-大脑运动"><a href="#Section-Strain-your-brain-大脑运动" class="headerlink" title="Section: Strain your brain!/大脑运动!"></a>Section: Strain your brain!/大脑运动!</h2><h3 id="gt-Strings-can-be-tricky-sometimes-微妙的字符串"><a href="#gt-Strings-can-be-tricky-sometimes-微妙的字符串" class="headerlink" title="&gt; Strings can be tricky sometimes/微妙的字符串 *"></a>&gt; Strings can be tricky sometimes/微妙的字符串 *</h3><p>1.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>a = <span class="hljs-string">&quot;some_string&quot;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">id</span>(a)<br><span class="hljs-number">140420665652016</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">id</span>(<span class="hljs-string">&quot;some&quot;</span> + <span class="hljs-string">&quot;_&quot;</span> + <span class="hljs-string">&quot;string&quot;</span>) <span class="hljs-comment"># 注意两个的id值是相同的.</span><br><span class="hljs-number">140420665652016</span><br></code></pre></td></tr></table></figure></p>
<p>2.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>a = <span class="hljs-string">&quot;wtf&quot;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>b = <span class="hljs-string">&quot;wtf&quot;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>a <span class="hljs-keyword">is</span> b<br><span class="hljs-literal">True</span><br><br><span class="hljs-meta">&gt;&gt;&gt; </span>a = <span class="hljs-string">&quot;wtf!&quot;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>b = <span class="hljs-string">&quot;wtf!&quot;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>a <span class="hljs-keyword">is</span> b<br><span class="hljs-literal">False</span><br><br><span class="hljs-meta">&gt;&gt;&gt; </span>a, b = <span class="hljs-string">&quot;wtf!&quot;</span>, <span class="hljs-string">&quot;wtf!&quot;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>a <span class="hljs-keyword">is</span> b <br><span class="hljs-literal">True</span> <span class="hljs-comment"># 3.7 版本返回结果为 False.</span><br></code></pre></td></tr></table></figure>
<p>3.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&#x27;a&#x27;</span> * <span class="hljs-number">20</span> <span class="hljs-keyword">is</span> <span class="hljs-string">&#x27;aaaaaaaaaaaaaaaaaaaa&#x27;</span><br><span class="hljs-literal">True</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&#x27;a&#x27;</span> * <span class="hljs-number">21</span> <span class="hljs-keyword">is</span> <span class="hljs-string">&#x27;aaaaaaaaaaaaaaaaaaaaa&#x27;</span><br><span class="hljs-literal">False</span> <span class="hljs-comment"># 3.7 版本返回结果为 True</span><br></code></pre></td></tr></table></figure></p>
<p>很好理解, 对吧?</p>
<h4 id="💡-说明-1"><a href="#💡-说明-1" class="headerlink" title="💡 说明:"></a>💡 说明:</h4><ul>
<li>这些行为是由于 Cpython 在编译优化时, 某些情况下会尝试使用已经存在的不可变对象而不是每次都创建一个新对象. (这种行为被称作字符串的驻留[string interning])</li>
<li>发生驻留之后, 许多变量可能指向内存中的相同字符串对象. (从而节省内存)</li>
<li><p>在上面的代码中, 字符串是隐式驻留的. 何时发生隐式驻留则取决于具体的实现. 这里有一些方法可以用来猜测字符串是否会被驻留:</p>
<ul>
<li>所有长度为 0 和长度为 1 的字符串都被驻留.</li>
<li>字符串在编译时被实现 (<code>&#39;wtf&#39;</code> 将被驻留, 但是 <code>&#39;&#39;.join([&#39;w&#39;, &#39;t&#39;, &#39;f&#39;])</code> 将不会被驻留)</li>
<li><p>字符串中只包含字母，数字或下划线时将会驻留. 所以 <code>&#39;wtf!&#39;</code> 由于包含 <code>!</code> 而未被驻留. 可以在<a target="_blank" rel="noopener" href="https://github.com/python/cpython/blob/3.6/Objects/codeobject.c#L19">这里</a>找到 CPython 对此规则的实现.</p>
<p><img src="https://picture-bed-001-1310572365.cos.ap-guangzhou.myqcloud.com/imgs/img/20210911212111.png" alt=""></p>
</li>
</ul>
</li>
<li><p>当在同一行将 <code>a</code> 和 <code>b</code> 的值设置为 <code>&quot;wtf!&quot;</code> 的时候, Python 解释器会创建一个新对象, 然后同时引用第二个变量(译: 仅适用于3.7以下, 详细情况请看<a target="_blank" rel="noopener" href="https://github.com/leisurelicht/wtfpython-cn/issues/13">这里</a>). 如果你在不同的行上进行赋值操作, 它就不会“知道”已经有一个 <code>wtf！</code> 对象 (因为 <code>&quot;wtf!&quot;</code> 不是按照上面提到的方式被隐式驻留的). 它是一种编译器优化, 特别适用于交互式环境.</p>
</li>
<li>常量折叠(constant folding) 是 Python 中的一种 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Peephole_optimization">窥孔优化(peephole optimization)</a> 技术. 这意味着在编译时表达式 <code>&#39;a&#39;*20</code> 会被替换为 <code>&#39;aaaaaaaaaaaaaaaaaaaa&#39;</code> 以减少运行时的时钟周期. 只有长度小于 20 的字符串才会发生常量折叠. (为啥? 想象一下由于表达式 <code>&#39;a&#39;*10**10</code> 而生成的 <code>.pyc</code> 文件的大小). 相关的源码实现在<a target="_blank" rel="noopener" href="https://github.com/python/cpython/blob/3.6/Python/peephole.c#L288">这里</a>.</li>
<li>如果你是使用 3.7 版本中运行上述示例代码, 会发现部分代码的运行结果与注释说明相同. 这是因为在 3.7 版本中, 常量折叠已经从窥孔优化器迁移至新的 AST 优化器, 后者可以以更高的一致性来执行优化. (由 Eugene Toder 和 INADA Naoki 在 <a target="_blank" rel="noopener" href="https://bugs.python.org/issue29469">bpo-29469</a> 和 <a target="_blank" rel="noopener" href="https://bugs.python.org/issue11549">bpo-11549</a> 中贡献.) </li>
<li>(译: 但是在最新的 3.8 版本中, 结果又变回去了. 虽然 3.8 版本和 3.7 版本一样, 都是使用 AST 优化器. 目前不确定官方对 3.8 版本的 AST 做了什么调整.)</li>
</ul>
<hr>
<h3 id="gt-Time-for-some-hash-brownies-是时候来点蛋糕了"><a href="#gt-Time-for-some-hash-brownies-是时候来点蛋糕了" class="headerlink" title="&gt; Time for some hash brownies!/是时候来点蛋糕了!"></a>&gt; Time for some hash brownies!/是时候来点蛋糕了!</h3><ul>
<li>hash brownie指一种含有大麻成分的蛋糕, 所以这里是句双关</li>
</ul>
<p>1.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">some_dict = &#123;&#125;<br>some_dict[<span class="hljs-number">5.5</span>] = <span class="hljs-string">&quot;Ruby&quot;</span><br>some_dict[<span class="hljs-number">5.0</span>] = <span class="hljs-string">&quot;JavaScript&quot;</span><br>some_dict[<span class="hljs-number">5</span>] = <span class="hljs-string">&quot;Python&quot;</span><br></code></pre></td></tr></table></figure></p>
<p><strong>Output:</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>some_dict[<span class="hljs-number">5.5</span>]<br><span class="hljs-string">&quot;Ruby&quot;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>some_dict[<span class="hljs-number">5.0</span>]<br><span class="hljs-string">&quot;Python&quot;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>some_dict[<span class="hljs-number">5</span>]<br><span class="hljs-string">&quot;Python&quot;</span><br></code></pre></td></tr></table></figure></p>
<p>“Python” 消除了 “JavaScript” 的存在?</p>
<h4 id="💡-说明-2"><a href="#💡-说明-2" class="headerlink" title="💡 说明:"></a>💡 说明:</h4><ul>
<li>Python 字典通过检查键值是否相等和比较哈希值来确定两个键是否相同.</li>
<li>具有相同值的不可变对象在Python中始终具有相同的哈希值.<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-number">5</span> == <span class="hljs-number">5.0</span><br><span class="hljs-literal">True</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">hash</span>(<span class="hljs-number">5</span>) == <span class="hljs-built_in">hash</span>(<span class="hljs-number">5.0</span>)<br><span class="hljs-literal">True</span><br></code></pre></td></tr></table></figure>
<strong>注意:</strong> 具有不同值的对象也可能具有相同的哈希值（哈希冲突）.</li>
<li>当执行 <code>some_dict[5] = &quot;Python&quot;</code> 语句时, 因为Python将 <code>5</code> 和 <code>5.0</code> 识别为 <code>some_dict</code> 的同一个键, 所以已有值 “JavaScript” 就被 “Python” 覆盖了.</li>
<li>这个 StackOverflow的 <a target="_blank" rel="noopener" href="https://stackoverflow.com/a/32211042/4354153">回答</a> 漂亮地解释了这背后的基本原理.</li>
</ul>
<hr>
<h3 id="gt-Return-return-everywhere-到处返回！"><a href="#gt-Return-return-everywhere-到处返回！" class="headerlink" title="&gt; Return return everywhere!/到处返回！"></a>&gt; Return return everywhere!/到处返回！</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">some_func</span>():<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;from_try&#x27;</span><br>    <span class="hljs-keyword">finally</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;from_finally&#x27;</span><br></code></pre></td></tr></table></figure>
<p><strong>Output:</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>some_func()<br><span class="hljs-string">&#x27;from_finally&#x27;</span><br></code></pre></td></tr></table></figure></p>
<h4 id="💡-说明-3"><a href="#💡-说明-3" class="headerlink" title="💡 说明:"></a>💡 说明:</h4><ul>
<li>当在 “try…finally” 语句的 <code>try</code> 中执行 <code>return</code>, <code>break</code> 或 <code>continue</code> 后, <code>finally</code> 子句依然会执行.</li>
<li>函数的返回值由最后执行的 <code>return</code> 语句决定. 由于 <code>finally</code> 子句一定会执行, 所以 <code>finally</code> 子句中的 <code>return</code> 将始终是最后执行的语句.</li>
</ul>
<hr>
<h3 id="gt-Deep-down-we’re-all-the-same-本质上-我们都一样"><a href="#gt-Deep-down-we’re-all-the-same-本质上-我们都一样" class="headerlink" title="&gt; Deep down, we’re all the same./本质上,我们都一样. *"></a>&gt; Deep down, we’re all the same./本质上,我们都一样. *</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">WTF</span>:<br>  <span class="hljs-keyword">pass</span><br></code></pre></td></tr></table></figure>
<p><strong>Output:</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>WTF() == WTF() <span class="hljs-comment"># 两个不同的对象应该不相等</span><br><span class="hljs-literal">False</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>WTF() <span class="hljs-keyword">is</span> WTF() <span class="hljs-comment"># 也不相同</span><br><span class="hljs-literal">False</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">hash</span>(WTF()) == <span class="hljs-built_in">hash</span>(WTF()) <span class="hljs-comment"># 哈希值也应该不同</span><br><span class="hljs-literal">True</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">id</span>(WTF()) == <span class="hljs-built_in">id</span>(WTF())<br><span class="hljs-literal">True</span><br></code></pre></td></tr></table></figure></p>
<h4 id="💡-说明-4"><a href="#💡-说明-4" class="headerlink" title="💡 说明:"></a>💡 说明:</h4><ul>
<li>当调用 <code>id</code> 函数时, Python 创建了一个 <code>WTF</code> 类的对象并传给 <code>id</code> 函数. 然后 <code>id</code> 函数获取其id值 (也就是内存地址), 然后丢弃该对象. 该对象就被销毁了.</li>
<li>当我们连续两次进行这个操作时, Python会将相同的内存地址分配给第二个对象. 因为 (在CPython中) <code>id</code> 函数使用对象的内存地址作为对象的id值, 所以两个对象的id值是相同的.</li>
<li>综上, 对象的id值仅仅在对象的生命周期内唯一. 在对象被销毁之后, 或被创建之前, 其他对象可以具有相同的id值.</li>
<li><p>那为什么 <code>is</code> 操作的结果为 <code>False</code> 呢? 让我们看看这段代码.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">WTF</span>(<span class="hljs-title class_ inherited__">object</span>):<br>  <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>): <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;I&quot;</span>)<br>  <span class="hljs-keyword">def</span> <span class="hljs-title function_">__del__</span>(<span class="hljs-params">self</span>): <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;D&quot;</span>)<br></code></pre></td></tr></table></figure>
<p><strong>Output:</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>WTF() <span class="hljs-keyword">is</span> WTF()<br>I<br>I<br>D<br>D<br><span class="hljs-literal">False</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">id</span>(WTF()) == <span class="hljs-built_in">id</span>(WTF())<br>I<br>D<br>I<br>D<br><span class="hljs-literal">True</span><br></code></pre></td></tr></table></figure>
<p>正如你所看到的, 对象销毁的顺序是造成所有不同之处的原因.</p>
</li>
</ul>
<hr>
<h3 id="gt-For-what-为什么"><a href="#gt-For-what-为什么" class="headerlink" title="&gt; For what?/为什么?"></a>&gt; For what?/为什么?</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">some_string = <span class="hljs-string">&quot;wtf&quot;</span><br>some_dict = &#123;&#125;<br><span class="hljs-keyword">for</span> i, some_dict[i] <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(some_string):<br>    <span class="hljs-keyword">pass</span><br></code></pre></td></tr></table></figure>
<p><strong>Output:</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>some_dict <span class="hljs-comment"># 创建了索引字典.</span><br>&#123;<span class="hljs-number">0</span>: <span class="hljs-string">&#x27;w&#x27;</span>, <span class="hljs-number">1</span>: <span class="hljs-string">&#x27;t&#x27;</span>, <span class="hljs-number">2</span>: <span class="hljs-string">&#x27;f&#x27;</span>&#125;<br></code></pre></td></tr></table></figure></p>
<h4 id="💡-说明-5"><a href="#💡-说明-5" class="headerlink" title="💡 说明:"></a>💡 说明:</h4><ul>
<li><p><a target="_blank" rel="noopener" href="https://docs.python.org/3/reference/grammar.html">Python 语法</a> 中对 <code>for</code> 的定义是:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">for_stmt: &#x27;for&#x27; exprlist &#x27;in&#x27; testlist &#x27;:&#x27; suite [&#x27;else&#x27; &#x27;:&#x27; suite]<br></code></pre></td></tr></table></figure>
<p>其中 <code>exprlist</code> 指分配目标. 这意味着对可迭代对象中的<strong>每一项都会执行</strong>类似 <code>&#123;exprlist&#125; = &#123;next_value&#125;</code> 的操作.</p>
<p>一个有趣的例子说明了这一点:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>    <span class="hljs-built_in">print</span>(i)<br>    i = <span class="hljs-number">10</span><br></code></pre></td></tr></table></figure>
<p><strong>Output:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">0<br>1<br>2<br>3<br></code></pre></td></tr></table></figure>
<p>你可曾觉得这个循环只会运行一次?</p>
<p><strong>💡 说明:</strong></p>
<ul>
<li>由于循环在Python中工作方式, 赋值语句 <code>i = 10</code> 并不会影响迭代循环, 在每次迭代开始之前, 迭代器(这里指 <code>range(4)</code>) 生成的下一个元素就被解包并赋值给目标列表的变量(这里指 <code>i</code>)了.</li>
</ul>
</li>
<li><p>在每一次的迭代中, <code>enumerate(some_string)</code> 函数就生成一个新值 <code>i</code> (计数器增加) 并从 <code>some_string</code> 中获取一个字符. 然后将字典 <code>some_dict</code> 键 <code>i</code> (刚刚分配的) 的值设为该字符. 本例中循环的展开可以简化为:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>i, some_dict[i] = (<span class="hljs-number">0</span>, <span class="hljs-string">&#x27;w&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>i, some_dict[i] = (<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;t&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>i, some_dict[i] = (<span class="hljs-number">2</span>, <span class="hljs-string">&#x27;f&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>some_dict<br></code></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h3 id="gt-Evaluation-time-discrepancy-执行时机差异"><a href="#gt-Evaluation-time-discrepancy-执行时机差异" class="headerlink" title="&gt; Evaluation time discrepancy/执行时机差异"></a>&gt; Evaluation time discrepancy/执行时机差异</h3><p>1.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">array = [<span class="hljs-number">1</span>, <span class="hljs-number">8</span>, <span class="hljs-number">15</span>]<br>g = (x <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> array <span class="hljs-keyword">if</span> array.count(x) &gt; <span class="hljs-number">0</span>)<br>array = [<span class="hljs-number">2</span>, <span class="hljs-number">8</span>, <span class="hljs-number">22</span>]<br></code></pre></td></tr></table></figure></p>
<p><strong>Output:</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(<span class="hljs-built_in">list</span>(g))<br>[<span class="hljs-number">8</span>]<br></code></pre></td></tr></table></figure></p>
<p>2.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">array_1 = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>]<br>g1 = (x <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> array_1)<br>array_1 = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>]<br><br>array_2 = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>]<br>g2 = (x <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> array_2)<br>array_2[:] = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>]<br></code></pre></td></tr></table></figure>
<p><strong>Output:</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(<span class="hljs-built_in">list</span>(g1))<br>[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>]<br><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(<span class="hljs-built_in">list</span>(g2))<br>[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>]<br></code></pre></td></tr></table></figure></p>
<h4 id="💡-说明-6"><a href="#💡-说明-6" class="headerlink" title="💡 说明"></a>💡 说明</h4><ul>
<li>在<a target="_blank" rel="noopener" href="https://wiki.python.org/moin/Generators">生成器</a>表达式中, <code>in</code> 子句在声明时执行, 而条件子句则是在运行时执行.</li>
<li>所以在运行前, <code>array</code> 已经被重新赋值为 <code>[2, 8, 22]</code>, 因此对于之前的 <code>1</code>, <code>8</code> 和 <code>15</code>, 只有 <code>count(8)</code> 的结果是大于 <code>0</code> 的, 所以生成器只会生成 <code>8</code>.</li>
<li>第二部分中 <code>g1</code> 和 <code>g2</code> 的输出差异则是由于变量 <code>array_1</code> 和 <code>array_2</code> 被重新赋值的方式导致的.</li>
<li>在第一种情况下, <code>array_1</code> 被绑定到新对象 <code>[1,2,3,4,5]</code>, 因为 <code>in</code> 子句是在声明时被执行的， 所以它仍然引用旧对象 <code>[1,2,3,4]</code>(并没有被销毁).</li>
<li>在第二种情况下, 对 <code>array_2</code> 的切片赋值将相同的旧对象 <code>[1,2,3,4]</code> 原地更新为 <code>[1,2,3,4,5]</code>. 因此 <code>g2</code> 和 <code>array_2</code> 仍然引用同一个对象(这个对象现在已经更新为 <code>[1,2,3,4,5]</code>).</li>
</ul>
<hr>
<h3 id="gt-is-is-not-what-it-is-出人意料的is"><a href="#gt-is-is-not-what-it-is-出人意料的is" class="headerlink" title="&gt; is is not what it is!/出人意料的is!"></a>&gt; <code>is</code> is not what it is!/出人意料的<code>is</code>!</h3><p>下面是一个在互联网上非常有名的例子.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>a = <span class="hljs-number">256</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>b = <span class="hljs-number">256</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>a <span class="hljs-keyword">is</span> b<br><span class="hljs-literal">True</span><br><br><span class="hljs-meta">&gt;&gt;&gt; </span>a = <span class="hljs-number">257</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>b = <span class="hljs-number">257</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>a <span class="hljs-keyword">is</span> b<br><span class="hljs-literal">False</span><br><br><span class="hljs-meta">&gt;&gt;&gt; </span>a = <span class="hljs-number">257</span>; b = <span class="hljs-number">257</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>a <span class="hljs-keyword">is</span> b<br><span class="hljs-literal">True</span><br></code></pre></td></tr></table></figure>
<h4 id="💡-说明-7"><a href="#💡-说明-7" class="headerlink" title="💡 说明:"></a>💡 说明:</h4><p><strong><code>is</code> 和 <code>==</code> 的区别</strong></p>
<ul>
<li><code>is</code> 运算符检查两个运算对象是否引用自同一对象 (即, 它检查两个运算对象是否相同).</li>
<li><code>==</code> 运算符比较两个运算对象的值是否相等.</li>
<li>因此 <code>is</code> 代表引用相同, <code>==</code> 代表值相等. 下面的例子可以很好的说明这点,<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>[] == []<br><span class="hljs-literal">True</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>[] <span class="hljs-keyword">is</span> [] <span class="hljs-comment"># 这两个空列表位于不同的内存地址.</span><br><span class="hljs-literal">False</span><br></code></pre></td></tr></table></figure>
</li>
</ul>
<p><strong><code>256</code> 是一个已经存在的对象, 而 <code>257</code> 不是</strong></p>
<p>当你启动Python 的时候, 数值为 <code>-5</code> 到 <code>256</code> 的对象就已经被分配好了. 这些数字因为经常被使用, 所以会被提前准备好.</p>
<p>Python 通过这种创建小整数池的方式来避免小整数频繁的申请和销毁内存空间.</p>
<p>引用自 <a target="_blank" rel="noopener" href="https://docs.python.org/3/c-api/long.html">https://docs.python.org/3/c-api/long.html</a></p>
<blockquote>
<p>当前的实现为-5到256之间的所有整数保留一个整数对象数组, 当你创建了一个该范围内的整数时, 你只需要返回现有对象的引用. 所以改变1的值是有可能的. 我怀疑这种行为在Python中是未定义行为. :-)</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">id</span>(<span class="hljs-number">256</span>)<br><span class="hljs-number">10922528</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>a = <span class="hljs-number">256</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>b = <span class="hljs-number">256</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">id</span>(a)<br><span class="hljs-number">10922528</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">id</span>(b)<br><span class="hljs-number">10922528</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">id</span>(<span class="hljs-number">257</span>)<br><span class="hljs-number">140084850247312</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>x = <span class="hljs-number">257</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>y = <span class="hljs-number">257</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">id</span>(x)<br><span class="hljs-number">140084850247440</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">id</span>(y)<br><span class="hljs-number">140084850247344</span><br></code></pre></td></tr></table></figure>
<p>这里解释器并没有智能到能在执行 <code>y = 257</code> 时意识到我们已经创建了一个整数 <code>257</code>, 所以它在内存中又新建了另一个对象.</p>
<p><strong>当 <code>a</code> 和 <code>b</code> 在同一行中使用相同的值初始化时，会指向同一个对象.</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>a, b = <span class="hljs-number">257</span>, <span class="hljs-number">257</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">id</span>(a)<br><span class="hljs-number">140640774013296</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">id</span>(b)<br><span class="hljs-number">140640774013296</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>a = <span class="hljs-number">257</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>b = <span class="hljs-number">257</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">id</span>(a)<br><span class="hljs-number">140640774013392</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">id</span>(b)<br><span class="hljs-number">140640774013488</span><br></code></pre></td></tr></table></figure>
<ul>
<li>当 a 和 b 在同一行中被设置为 <code>257</code> 时, Python 解释器会创建一个新对象, 然后同时引用第二个变量. 如果你在不同的行上进行, 它就不会 “知道” 已经存在一个 <code>257</code> 对象了.</li>
<li>这是一种特别为交互式环境做的编译器优化. 当你在实时解释器中输入两行的时候, 他们会单独编译, 因此也会单独进行优化. 如果你在 <code>.py</code> 文件中尝试这个例子, 则不会看到相同的行为, 因为文件是一次性编译的.</li>
</ul>
<hr>
<h3 id="gt-A-tic-tac-toe-where-X-wins-in-the-first-attempt-一蹴即至"><a href="#gt-A-tic-tac-toe-where-X-wins-in-the-first-attempt-一蹴即至" class="headerlink" title="&gt; A tic-tac-toe where X wins in the first attempt!/一蹴即至!"></a>&gt; A tic-tac-toe where X wins in the first attempt!/一蹴即至!</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 我们先初始化一个变量row</span><br>row = [<span class="hljs-string">&quot;&quot;</span>]*<span class="hljs-number">3</span> <span class="hljs-comment">#row i[&#x27;&#x27;, &#x27;&#x27;, &#x27;&#x27;]</span><br><span class="hljs-comment"># 并创建一个变量board</span><br>board = [row]*<span class="hljs-number">3</span><br></code></pre></td></tr></table></figure>
<p><strong>Output:</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>board<br>[[<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>], [<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>], [<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>]]<br><span class="hljs-meta">&gt;&gt;&gt; </span>board[<span class="hljs-number">0</span>]<br>[<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>board[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]<br><span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>board[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] = <span class="hljs-string">&quot;X&quot;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>board<br>[[<span class="hljs-string">&#x27;X&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>], [<span class="hljs-string">&#x27;X&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>], [<span class="hljs-string">&#x27;X&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>]]<br></code></pre></td></tr></table></figure></p>
<p>我们有没有赋值过3个 “X” 呢？</p>
<h4 id="💡-说明-8"><a href="#💡-说明-8" class="headerlink" title="💡 说明:"></a>💡 说明:</h4><p>当我们初始化 <code>row</code> 变量时, 下面这张图展示了内存中的情况。</p>
<p><img src="https://picture-bed-001-1310572365.cos.ap-guangzhou.myqcloud.com/imgs/img/20210911212128.png" alt="image"></p>
<p>而当通过对 <code>row</code> 做乘法来初始化 <code>board</code> 时, 内存中的情况则如下图所示 (每个元素 <code>board[0]</code>, <code>board[1]</code> 和 <code>board[2]</code> 都和 <code>row</code> 一样引用了同一列表.)</p>
<p><img src="https://picture-bed-001-1310572365.cos.ap-guangzhou.myqcloud.com/imgs/img/20210911212130.png" alt="image"></p>
<p>我们可以通过不使用变量 <code>row</code> 生成 <code>board</code> 来避免这种情况. (<a target="_blank" rel="noopener" href="https://github.com/satwikkansal/wtfpython/issues/68">这个</a>issue提出了这个需求.)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>board = [[<span class="hljs-string">&#x27;&#x27;</span>]*<span class="hljs-number">3</span> <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>)]<br><span class="hljs-meta">&gt;&gt;&gt; </span>board[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] = <span class="hljs-string">&quot;X&quot;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>board<br>[[<span class="hljs-string">&#x27;X&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>], [<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>], [<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>]]<br></code></pre></td></tr></table></figure>
<hr>
<h3 id="gt-The-sticky-output-function-麻烦的输出"><a href="#gt-The-sticky-output-function-麻烦的输出" class="headerlink" title="&gt; The sticky output function/麻烦的输出"></a>&gt; The sticky output function/麻烦的输出</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python">funcs = []<br>results = []<br><span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">some_func</span>():<br>        <span class="hljs-keyword">return</span> x<br>    funcs.append(some_func)<br>    results.append(some_func()) <span class="hljs-comment"># 注意这里函数被执行了</span><br><br>funcs_results = [func() <span class="hljs-keyword">for</span> func <span class="hljs-keyword">in</span> funcs]<br></code></pre></td></tr></table></figure>
<p><strong>Output:</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>results<br>[<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>funcs_results<br>[<span class="hljs-number">6</span>, <span class="hljs-number">6</span>, <span class="hljs-number">6</span>, <span class="hljs-number">6</span>, <span class="hljs-number">6</span>, <span class="hljs-number">6</span>, <span class="hljs-number">6</span>]<br></code></pre></td></tr></table></figure></p>
<p>即使每次在迭代中将 <code>some_func</code> 加入 <code>funcs</code> 前的 <code>x</code> 值都不相同, 所有的函数还是都返回6.</p>
<p>// 再换个例子</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>powers_of_x = [<span class="hljs-keyword">lambda</span> x: x**i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>)]<br><span class="hljs-meta">&gt;&gt;&gt; </span>[f(<span class="hljs-number">2</span>) <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> powers_of_x]<br>[<span class="hljs-number">512</span>, <span class="hljs-number">512</span>, <span class="hljs-number">512</span>, <span class="hljs-number">512</span>, <span class="hljs-number">512</span>, <span class="hljs-number">512</span>, <span class="hljs-number">512</span>, <span class="hljs-number">512</span>, <span class="hljs-number">512</span>, <span class="hljs-number">512</span>]<br></code></pre></td></tr></table></figure>
<h4 id="💡-说明-9"><a href="#💡-说明-9" class="headerlink" title="💡 说明:"></a>💡 说明:</h4><ul>
<li><p>当在循环内部定义一个函数时, 如果该函数在其主体中使用了循环变量, 则闭包函数将与循环变量绑定, 而不是它的值. 因此, 所有的函数都是使用最后分配给变量的值来进行计算的.</p>
</li>
<li><p>可以通过将循环变量作为命名变量传递给函数来获得预期的结果. <strong>为什么这样可行?</strong> 因为这会在函数内再次定义一个局部变量.</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">funcs = []<br><span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">some_func</span>(<span class="hljs-params">x=x</span>):<br>        <span class="hljs-keyword">return</span> x<br>    funcs.append(some_func)<br></code></pre></td></tr></table></figure>
<p>  <strong>Output:</strong></p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>funcs_results = [func() <span class="hljs-keyword">for</span> func <span class="hljs-keyword">in</span> funcs]<br><span class="hljs-meta">&gt;&gt;&gt; </span>funcs_results<br>[<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>]<br></code></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h3 id="gt-is-not-is-not-is-not-is-not-不是-is-not"><a href="#gt-is-not-is-not-is-not-is-not-不是-is-not" class="headerlink" title="&gt; is not ... is not is (not ...)/is not ... 不是 is (not ...)"></a>&gt; <code>is not ...</code> is not <code>is (not ...)</code>/<code>is not ...</code> 不是 <code>is (not ...)</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&#x27;something&#x27;</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span><br><span class="hljs-literal">True</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&#x27;something&#x27;</span> <span class="hljs-keyword">is</span> (<span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>)<br><span class="hljs-literal">False</span><br></code></pre></td></tr></table></figure>
<h4 id="💡-说明-10"><a href="#💡-说明-10" class="headerlink" title="💡 说明:"></a>💡 说明:</h4><ul>
<li><code>is not</code> 是个单独的二元运算符, 与分别使用 <code>is</code> 和 <code>not</code> 不同.</li>
<li>如果操作符两侧的变量指向同一个对象, 则 <code>is not</code> 的结果为 <code>False</code>, 否则结果为 <code>True</code>.</li>
</ul>
<hr>
<h3 id="gt-The-surprising-comma-意外的逗号"><a href="#gt-The-surprising-comma-意外的逗号" class="headerlink" title="&gt; The surprising comma/意外的逗号"></a>&gt; The surprising comma/意外的逗号</h3><p><strong>Output:</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">def</span> <span class="hljs-title function_">f</span>(<span class="hljs-params">x, y,</span>):<br><span class="hljs-meta">... </span>    <span class="hljs-built_in">print</span>(x, y)<br>...<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">def</span> <span class="hljs-title function_">g</span>(<span class="hljs-params">x=<span class="hljs-number">4</span>, y=<span class="hljs-number">5</span>,</span>):<br><span class="hljs-meta">... </span>    <span class="hljs-built_in">print</span>(x, y)<br>...<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">def</span> <span class="hljs-title function_">h</span>(<span class="hljs-params">x, **kwargs,</span>):<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="hljs-number">1</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">h</span>(<span class="hljs-params">x, **kwargs,</span>):<br>                     ^<br>SyntaxError: invalid syntax<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">def</span> <span class="hljs-title function_">h</span>(<span class="hljs-params">*args,</span>):<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="hljs-number">1</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">h</span>(<span class="hljs-params">*args,</span>):<br>                ^<br>SyntaxError: invalid syntax<br></code></pre></td></tr></table></figure></p>
<h4 id="💡-说明-11"><a href="#💡-说明-11" class="headerlink" title="💡 说明:"></a>💡 说明:</h4><ul>
<li>在Python函数的形式参数列表中, 尾随逗号并不一定是合法的.</li>
<li>在Python中, 参数列表部分用前置逗号定义, 部分用尾随逗号定义. 这种冲突导致逗号被夹在中间, 没有规则定义它.(译:这一句看得我也很懵逼,只能强翻了.详细解释看下面的讨论帖会一目了然.)</li>
<li><strong>注意:</strong> 尾随逗号的问题已经在Python 3.6中被<a target="_blank" rel="noopener" href="https://bugs.python.org/issue9232">修复</a>了. 而这篇<a target="_blank" rel="noopener" href="https://bugs.python.org/issue9232#msg248399">帖子</a>中则简要讨论了Python中尾随逗号的不同用法.</li>
</ul>
<hr>
<h3 id="gt-Backslashes-at-the-end-of-string-字符串末尾的反斜杠"><a href="#gt-Backslashes-at-the-end-of-string-字符串末尾的反斜杠" class="headerlink" title="&gt; Backslashes at the end of string/字符串末尾的反斜杠"></a>&gt; Backslashes at the end of string/字符串末尾的反斜杠</h3><p><strong>Output:</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&gt;&gt;&gt; print(&quot;\\ C:\\&quot;)<br>\ C:\<br>&gt;&gt;&gt; print(r&quot;\ C:&quot;)<br>\ C:<br>&gt;&gt;&gt; print(r&quot;\ C:\&quot;)<br><br>    File &quot;&lt;stdin&gt;&quot;, line 1<br>      print(r&quot;\ C:\&quot;)<br>                     ^<br>SyntaxError: EOL while scanning string literal<br></code></pre></td></tr></table></figure></p>
<h4 id="💡-说明-12"><a href="#💡-说明-12" class="headerlink" title="💡 说明:"></a>💡 说明:</h4><ul>
<li>在以 <code>r</code> 开头的原始字符串中, 反斜杠并没有特殊含义.<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(<span class="hljs-built_in">repr</span>(<span class="hljs-string">r&quot;wt\&quot;f&quot;</span>))<br><span class="hljs-string">&#x27;wt\\&quot;f&#x27;</span><br></code></pre></td></tr></table></figure></li>
<li>解释器所做的只是简单的改变了反斜杠的行为, 因此会直接放行反斜杠及后一个的字符. 这就是反斜杠在原始字符串末尾不起作用的原因.</li>
</ul>
<hr>
<h3 id="gt-not-knot-别纠结"><a href="#gt-not-knot-别纠结" class="headerlink" title="&gt; not knot!/别纠结!"></a>&gt; not knot!/别纠结!</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">x = <span class="hljs-literal">True</span><br>y = <span class="hljs-literal">False</span><br></code></pre></td></tr></table></figure>
<p><strong>Output:</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">not</span> x == y<br><span class="hljs-literal">True</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>x == <span class="hljs-keyword">not</span> y<br>  File <span class="hljs-string">&quot;&lt;input&gt;&quot;</span>, line <span class="hljs-number">1</span><br>    x == <span class="hljs-keyword">not</span> y<br>           ^<br>SyntaxError: invalid syntax<br></code></pre></td></tr></table></figure></p>
<h4 id="💡-说明-13"><a href="#💡-说明-13" class="headerlink" title="💡 说明:"></a>💡 说明:</h4><ul>
<li>运算符的优先级会影响表达式的求值顺序, 而在 Python 中 <code>==</code> 运算符的优先级要高于 <code>not</code> 运算符.</li>
<li>所以 <code>not x == y</code> 相当于 <code>not (x == y)</code>, 同时等价于 <code>not (True == False)</code>, 最后的运算结果就是 <code>True</code>.</li>
<li>之所以 <code>x == not y</code> 会抛一个 <code>SyntaxError</code> 异常, 是因为它会被认为等价于 <code>(x == not) y</code>, 而不是你一开始期望的 <code>x == (not y)</code>.</li>
<li>解释器期望 <code>not</code> 标记是 <code>not in</code> 操作符的一部分 (因为 <code>==</code> 和 <code>not in</code> 操作符具有相同的优先级), 但是它在 <code>not</code> 标记后面找不到 <code>in</code> 标记, 所以会抛出 <code>SyntaxError</code> 异常.</li>
</ul>
<hr>
<h3 id="gt-Half-triple-quoted-strings-三个引号"><a href="#gt-Half-triple-quoted-strings-三个引号" class="headerlink" title="&gt; Half triple-quoted strings/三个引号"></a>&gt; Half triple-quoted strings/三个引号</h3><p><strong>Output:</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;wtfpython&#x27;</span><span class="hljs-string">&#x27;&#x27;</span>)<br>wtfpython<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;wtfpython&quot;</span><span class="hljs-string">&quot;&quot;</span>)<br>wtfpython<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-comment"># 下面的语句会抛出 `SyntaxError` 异常</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-comment"># print(&#x27;&#x27;&#x27;wtfpython&#x27;)</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-comment"># print(&quot;&quot;&quot;wtfpython&quot;)</span><br></code></pre></td></tr></table></figure></p>
<h4 id="💡-说明-14"><a href="#💡-说明-14" class="headerlink" title="💡 说明:"></a>💡 说明:</h4><ul>
<li>Python 提供隐式的<a target="_blank" rel="noopener" href="https://docs.python.org/2/reference/lexical_analysis.html#string-literal-concatenation">字符串连接</a>, 例如,<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&gt;&gt;&gt; print(&quot;wtf&quot; &quot;python&quot;)<br>wtfpython<br>&gt;&gt;&gt; print(&quot;wtf&quot; &quot;&quot;) # or &quot;wtf&quot;&quot;&quot;<br>wtf<br></code></pre></td></tr></table></figure></li>
<li><code>&#39;&#39;&#39;</code> 和 <code>&quot;&quot;&quot;</code> 在 Python中也是字符串定界符, Python 解释器在先遇到三个引号的的时候会尝试再寻找三个终止引号作为定界符, 如果不存在则会导致 <code>SyntaxError</code> 异常.</li>
</ul>
<hr>
<h3 id="gt-Midnight-time-doesn’t-exist-不存在的午夜"><a href="#gt-Midnight-time-doesn’t-exist-不存在的午夜" class="headerlink" title="&gt; Midnight time doesn’t exist?/不存在的午夜?"></a>&gt; Midnight time doesn’t exist?/不存在的午夜?</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime<br><br>midnight = datetime(<span class="hljs-number">2018</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)<br>midnight_time = midnight.time()<br><br>noon = datetime(<span class="hljs-number">2018</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">12</span>, <span class="hljs-number">0</span>)<br>noon_time = noon.time()<br><br><span class="hljs-keyword">if</span> midnight_time:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Time at midnight is&quot;</span>, midnight_time)<br><br><span class="hljs-keyword">if</span> noon_time:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Time at noon is&quot;</span>, noon_time)<br></code></pre></td></tr></table></figure>
<p><strong>Output:</strong><br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">(<span class="hljs-string">&#x27;Time at noon is&#x27;</span>, datetime.time(12, 0))<br></code></pre></td></tr></table></figure></p>
<p>midnight_time 并没有被输出.</p>
<h4 id="💡-说明-15"><a href="#💡-说明-15" class="headerlink" title="💡 说明:"></a>💡 说明:</h4><p>在Python 3.5之前, 如果 <code>datetime.time</code> 对象存储的UTC的午夜时间(译: 就是 <code>00:00</code>), 那么它的布尔值会被认为是 <code>False</code>. 当使用 <code>if obj:</code> 语句来检查 <code>obj</code> 是否为 <code>null</code> 或者某些“空”值的时候, 很容易出错.</p>
<hr>
<h3 id="gt-What’s-wrong-with-booleans-布尔你咋了"><a href="#gt-What’s-wrong-with-booleans-布尔你咋了" class="headerlink" title="&gt; What’s wrong with booleans?/布尔你咋了?"></a>&gt; What’s wrong with booleans?/布尔你咋了?</h3><p>1.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 一个简单的例子, 统计下面可迭代对象中的布尔型值的个数和整型值的个数</span><br>mixed_list = [<span class="hljs-literal">False</span>, <span class="hljs-number">1.0</span>, <span class="hljs-string">&quot;some_string&quot;</span>, <span class="hljs-number">3</span>, <span class="hljs-literal">True</span>, [], <span class="hljs-literal">False</span>]<br>integers_found_so_far = <span class="hljs-number">0</span><br>booleans_found_so_far = <span class="hljs-number">0</span><br><br><span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> mixed_list:<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(item, <span class="hljs-built_in">int</span>):<br>        integers_found_so_far += <span class="hljs-number">1</span><br>    <span class="hljs-keyword">elif</span> <span class="hljs-built_in">isinstance</span>(item, <span class="hljs-built_in">bool</span>):<br>        booleans_found_so_far += <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure></p>
<p><strong>Output:</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>integers_found_so_far<br><span class="hljs-number">4</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>booleans_found_so_far<br><span class="hljs-number">0</span><br></code></pre></td></tr></table></figure></p>
<p>2.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">another_dict = &#123;&#125;<br>another_dict[<span class="hljs-literal">True</span>] = <span class="hljs-string">&quot;JavaScript&quot;</span><br>another_dict[<span class="hljs-number">1</span>] = <span class="hljs-string">&quot;Ruby&quot;</span><br>another_dict[<span class="hljs-number">1.0</span>] = <span class="hljs-string">&quot;Python&quot;</span><br></code></pre></td></tr></table></figure></p>
<p><strong>Output:</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>another_dict[<span class="hljs-literal">True</span>]<br><span class="hljs-string">&quot;Python&quot;</span><br></code></pre></td></tr></table></figure></p>
<p>3.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>some_bool = <span class="hljs-literal">True</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&quot;wtf&quot;</span>*some_bool<br><span class="hljs-string">&#x27;wtf&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>some_bool = <span class="hljs-literal">False</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&quot;wtf&quot;</span>*some_bool<br><span class="hljs-string">&#x27;&#x27;</span><br></code></pre></td></tr></table></figure></p>
<h4 id="💡-说明-16"><a href="#💡-说明-16" class="headerlink" title="💡 说明:"></a>💡 说明:</h4><ul>
<li><p>布尔值是 <code>int</code> 的子类</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">isinstance</span>(<span class="hljs-literal">True</span>, <span class="hljs-built_in">int</span>)<br><span class="hljs-literal">True</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">isinstance</span>(<span class="hljs-literal">False</span>, <span class="hljs-built_in">int</span>)<br><span class="hljs-literal">True</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>所以 <code>True</code> 的整数值是 <code>1</code>, 而 <code>False</code> 的整数值是 <code>0</code>.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-literal">True</span> == <span class="hljs-number">1</span> == <span class="hljs-number">1.0</span> <span class="hljs-keyword">and</span> <span class="hljs-literal">False</span> == <span class="hljs-number">0</span> == <span class="hljs-number">0.0</span><br><span class="hljs-literal">True</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>关于其背后的原理, 请看这个 StackOverflow 的<a target="_blank" rel="noopener" href="https://stackoverflow.com/a/8169049/4354153">回答</a>.</p>
</li>
</ul>
<hr>
<h3 id="gt-Class-attributes-and-instance-attributes-类属性和实例属性"><a href="#gt-Class-attributes-and-instance-attributes-类属性和实例属性" class="headerlink" title="&gt; Class attributes and instance attributes/类属性和实例属性"></a>&gt; Class attributes and instance attributes/类属性和实例属性</h3><p>1.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span>:<br>    x = <span class="hljs-number">1</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">B</span>(<span class="hljs-title class_ inherited__">A</span>):<br>    <span class="hljs-keyword">pass</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">C</span>(<span class="hljs-title class_ inherited__">A</span>):<br>    <span class="hljs-keyword">pass</span><br></code></pre></td></tr></table></figure></p>
<p><strong>Output:</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>A.x, B.x, C.x<br>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>B.x = <span class="hljs-number">2</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>A.x, B.x, C.x<br>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>A.x = <span class="hljs-number">3</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>A.x, B.x, C.x<br>(<span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>a = A()<br><span class="hljs-meta">&gt;&gt;&gt; </span>a.x, A.x<br>(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>a.x += <span class="hljs-number">1</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>a.x, A.x<br>(<span class="hljs-number">4</span>, <span class="hljs-number">3</span>)<br></code></pre></td></tr></table></figure></p>
<p>2.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SomeClass</span>:<br>    some_var = <span class="hljs-number">15</span><br>    some_list = [<span class="hljs-number">5</span>]<br>    another_list = [<span class="hljs-number">5</span>]<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, x</span>):<br>        self.some_var = x + <span class="hljs-number">1</span><br>        self.some_list = self.some_list + [x]<br>        self.another_list += [x]<br></code></pre></td></tr></table></figure></p>
<p><strong>Output:</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>some_obj = SomeClass(<span class="hljs-number">420</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>some_obj.some_list<br>[<span class="hljs-number">5</span>, <span class="hljs-number">420</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>some_obj.another_list<br>[<span class="hljs-number">5</span>, <span class="hljs-number">420</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>another_obj = SomeClass(<span class="hljs-number">111</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>another_obj.some_list<br>[<span class="hljs-number">5</span>, <span class="hljs-number">111</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>another_obj.another_list<br>[<span class="hljs-number">5</span>, <span class="hljs-number">420</span>, <span class="hljs-number">111</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>another_obj.another_list <span class="hljs-keyword">is</span> SomeClass.another_list<br><span class="hljs-literal">True</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>another_obj.another_list <span class="hljs-keyword">is</span> some_obj.another_list<br><span class="hljs-literal">True</span><br></code></pre></td></tr></table></figure>
<h4 id="💡-说明-17"><a href="#💡-说明-17" class="headerlink" title="💡 说明:"></a>💡 说明:</h4><ul>
<li>类变量和实例变量在内部是通过类对象的字典来处理(译: 就是 <code>__dict__</code> 属性). 如果在当前类的字典中找不到的话就去它的父类中寻找.</li>
<li><code>+=</code> 运算符会在原地修改可变对象, 而不是创建新对象. 因此, 在这种情况下, 修改一个实例的属性会影响其他实例和类属性.</li>
</ul>
<hr>
<h3 id="gt-yielding-None-生成-None"><a href="#gt-yielding-None-生成-None" class="headerlink" title="&gt; yielding None/生成 None"></a>&gt; yielding None/生成 None</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">some_iterable = (<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">some_func</span>(<span class="hljs-params">val</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;something&quot;</span><br></code></pre></td></tr></table></figure>
<p><strong>Output:</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>[x <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> some_iterable]<br>[<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>[(<span class="hljs-keyword">yield</span> x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> some_iterable]<br>&lt;generator <span class="hljs-built_in">object</span> &lt;listcomp&gt; at <span class="hljs-number">0x7f70b0a4ad58</span>&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">list</span>([(<span class="hljs-keyword">yield</span> x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> some_iterable])<br>[<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">list</span>((<span class="hljs-keyword">yield</span> x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> some_iterable)<br>[<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-literal">None</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-literal">None</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">list</span>(some_func((<span class="hljs-keyword">yield</span> x)) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> some_iterable)<br>[<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;something&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;something&#x27;</span>]<br></code></pre></td></tr></table></figure></p>
<h4 id="💡-说明-18"><a href="#💡-说明-18" class="headerlink" title="💡 说明:"></a>💡 说明:</h4><ul>
<li>来源和解释可以在这里找到: <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/32139885/yield-in-list-comprehensions-and-generator-expressions">https://stackoverflow.com/questions/32139885/yield-in-list-comprehensions-and-generator-expressions</a></li>
<li>相关错误报告: <a target="_blank" rel="noopener" href="http://bugs.python.org/issue10544">http://bugs.python.org/issue10544</a></li>
<li>这个bug在3.7以后的版本中不被推荐使用, 并在3.8中被修复. 因此在3.8中尝试在推导式中使用 yield, 只会得到一个 SyntaxError. 详细内容可以看<a target="_blank" rel="noopener" href="https://docs.python.org/dev/whatsnew/3.7.html#deprecated-python-behavior">3.7更新内容</a>, <a target="_blank" rel="noopener" href="https://docs.python.org/dev/whatsnew/3.8.html#changes-in-python-behavior">3.8更新内容</a>.</li>
</ul>
<hr>
<h3 id="gt-Mutating-the-immutable-强人所难"><a href="#gt-Mutating-the-immutable-强人所难" class="headerlink" title="&gt; Mutating the immutable!/强人所难"></a>&gt; Mutating the immutable!/强人所难</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">some_tuple = (<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;tuple&quot;</span>, <span class="hljs-string">&quot;with&quot;</span>, <span class="hljs-string">&quot;values&quot;</span>)<br>another_tuple = ([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>], [<span class="hljs-number">5</span>, <span class="hljs-number">6</span>])<br></code></pre></td></tr></table></figure>
<p><strong>Output:</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>some_tuple[<span class="hljs-number">2</span>] = <span class="hljs-string">&quot;change this&quot;</span><br>TypeError: <span class="hljs-string">&#x27;tuple&#x27;</span> <span class="hljs-built_in">object</span> does <span class="hljs-keyword">not</span> support item assignment<br><span class="hljs-meta">&gt;&gt;&gt; </span>another_tuple[<span class="hljs-number">2</span>].append(<span class="hljs-number">1000</span>) <span class="hljs-comment"># 这里不出现错误</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>another_tuple<br>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>], [<span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">1000</span>])<br><span class="hljs-meta">&gt;&gt;&gt; </span>another_tuple[<span class="hljs-number">2</span>] += [<span class="hljs-number">99</span>, <span class="hljs-number">999</span>]<br>TypeError: <span class="hljs-string">&#x27;tuple&#x27;</span> <span class="hljs-built_in">object</span> does <span class="hljs-keyword">not</span> support item assignment<br><span class="hljs-meta">&gt;&gt;&gt; </span>another_tuple<br>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>], [<span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">1000</span>, <span class="hljs-number">99</span>, <span class="hljs-number">999</span>])<br></code></pre></td></tr></table></figure></p>
<p>我还以为元组是不可变的呢…</p>
<h4 id="💡-说明-19"><a href="#💡-说明-19" class="headerlink" title="💡 说明:"></a>💡 说明:</h4><ul>
<li><p>引用 <a target="_blank" rel="noopener" href="https://docs.python.org/2/reference/datamodel.html">https://docs.python.org/2/reference/datamodel.html</a></p>
<blockquote>
<p>不可变序列<br>不可变序列的对象一旦创建就不能再改变. (如果对象包含对其他对象的引用，则这些其他对象可能是可变的并且可能会被修改; 但是，由不可变对象直接引用的对象集合不能更改.)</p>
</blockquote>
</li>
<li><p><code>+=</code> 操作符在原地修改了列表. 元素赋值操作并不工作, 但是当异常抛出时, 元素已经在原地被修改了.</p>
</li>
</ul>
<p>(译: 对于不可变对象, 这里指tuple, <code>+=</code> 并不是原子操作, 而是 <code>extend</code> 和 <code>=</code> 两个动作, 这里 <code>=</code> 操作虽然会抛出异常, 但 <code>extend</code> 操作已经修改成功了. 详细解释可以看<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000010767068">这里</a>)</p>
<hr>
<h3 id="gt-The-disappearing-variable-from-outer-scope-消失的外部变量"><a href="#gt-The-disappearing-variable-from-outer-scope-消失的外部变量" class="headerlink" title="&gt; The disappearing variable from outer scope/消失的外部变量"></a>&gt; The disappearing variable from outer scope/消失的外部变量</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">e = <span class="hljs-number">7</span><br><span class="hljs-keyword">try</span>:<br>    <span class="hljs-keyword">raise</span> Exception()<br><span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>    <span class="hljs-keyword">pass</span><br></code></pre></td></tr></table></figure>
<p><strong>Output (Python 2.x):</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(e)<br><span class="hljs-comment"># prints nothing</span><br></code></pre></td></tr></table></figure></p>
<p><strong>Output (Python 3.x):</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(e)<br>NameError: name <span class="hljs-string">&#x27;e&#x27;</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> defined<br></code></pre></td></tr></table></figure></p>
<h4 id="💡-说明-20"><a href="#💡-说明-20" class="headerlink" title="💡 说明:"></a>💡 说明:</h4><ul>
<li><p>出处: <a target="_blank" rel="noopener" href="https://docs.python.org/3/reference/compound_stmts.html#except">https://docs.python.org/3/reference/compound_stmts.html#except</a></p>
<p>当使用 <code>as</code> 为目标分配异常的时候, 将在except子句的末尾清除该异常.</p>
<p>这就好像</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">except</span> E <span class="hljs-keyword">as</span> N:<br>    foo<br></code></pre></td></tr></table></figure>
<p>会被翻译成</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">except</span> E <span class="hljs-keyword">as</span> N:<br>    <span class="hljs-keyword">try</span>:<br>        foo<br>    <span class="hljs-keyword">finally</span>:<br>        <span class="hljs-keyword">del</span> N<br></code></pre></td></tr></table></figure>
<p>这意味着异常必须在被赋值给其他变量才能在 <code>except</code> 子句之后引用它. 而异常之所以会被清除, 则是由于上面附加的回溯信息(trackback)会和栈帧(stack frame)形成循环引用, 使得该栈帧中的所有本地变量在下一次垃圾回收发生之前都处于活动状态.(译: 也就是说不会被回收)</p>
</li>
<li><p>子句在 Python 中并没有独立的作用域. 示例中的所有内容都处于同一作用域内, 所以变量 <code>e</code> 会由于执行了 <code>except</code> 子句而被删除. 而对于有独立的内部作用域的函数来说情况就不一样了. 下面的例子说明了这一点:</p>
   <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">f</span>(<span class="hljs-params">x</span>):<br>    <span class="hljs-keyword">del</span>(x)<br>    <span class="hljs-built_in">print</span>(x)<br><br>x = <span class="hljs-number">5</span><br>y = [<span class="hljs-number">5</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>]<br></code></pre></td></tr></table></figure>
<p>   <strong>Output:</strong></p>
   <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python">&gt;&gt;&gt;f(x)<br>UnboundLocalError: local variable <span class="hljs-string">&#x27;x&#x27;</span> referenced before assignment<br>&gt;&gt;&gt;f(y)<br>UnboundLocalError: local variable <span class="hljs-string">&#x27;x&#x27;</span> referenced before assignment<br><span class="hljs-meta">&gt;&gt;&gt; </span>x<br><span class="hljs-number">5</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>y<br>[<span class="hljs-number">5</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>]<br></code></pre></td></tr></table></figure>
</li>
<li><p>在 Python 2.x 中, <code>Exception()</code> 实例被赋值给了变量 <code>e</code>, 所以当你尝试打印结果的时候, 它的输出为空.（译: 正常的Exception实例打印出来就是空）</p>
<p>  <strong>Output (Python 2.x):</strong></p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>e<br>Exception()<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span> e<br><span class="hljs-comment"># 没有打印任何内容!</span><br></code></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h3 id="gt-When-True-is-actually-False-真亦假"><a href="#gt-When-True-is-actually-False-真亦假" class="headerlink" title="&gt; When True is actually False/真亦假"></a>&gt; When True is actually False/真亦假</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-literal">True</span> = <span class="hljs-literal">False</span><br><span class="hljs-keyword">if</span> <span class="hljs-literal">True</span> == <span class="hljs-literal">False</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;I&#x27;ve lost faith in truth!&quot;</span>)<br></code></pre></td></tr></table></figure>
<p><strong>Output:</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">I&#x27;ve lost faith in truth!<br></code></pre></td></tr></table></figure></p>
<h4 id="💡-说明-21"><a href="#💡-说明-21" class="headerlink" title="💡 说明:"></a>💡 说明:</h4><ul>
<li>最初, Python 并没有 <code>bool</code> 型 (人们用0表示假值, 用非零值比如1作为真值). 后来他们添加了 <code>True</code>, <code>False</code>, 和 <code>bool</code> 型, 但是, 为了向后兼容, 他们没法把 <code>True</code> 和 <code>False</code> 设置为常量, 只是设置成了内置变量.</li>
<li>Python 3 由于不再需要向后兼容, 终于可以修复这个问题了, 所以这个例子无法在 Python 3.x 中执行!</li>
</ul>
<hr>
<h3 id="gt-From-filled-to-None-in-one-instruction…-从有到无…"><a href="#gt-From-filled-to-None-in-one-instruction…-从有到无…" class="headerlink" title="&gt; From filled to None in one instruction…/从有到无…"></a>&gt; From filled to None in one instruction…/从有到无…</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python">some_list = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]<br>some_dict = &#123;<br>  <span class="hljs-string">&quot;key_1&quot;</span>: <span class="hljs-number">1</span>,<br>  <span class="hljs-string">&quot;key_2&quot;</span>: <span class="hljs-number">2</span>,<br>  <span class="hljs-string">&quot;key_3&quot;</span>: <span class="hljs-number">3</span><br>&#125;<br><br>some_list = some_list.append(<span class="hljs-number">4</span>)<br>some_dict = some_dict.update(&#123;<span class="hljs-string">&quot;key_4&quot;</span>: <span class="hljs-number">4</span>&#125;)<br></code></pre></td></tr></table></figure>
<p><strong>Output:</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(some_list)<br><span class="hljs-literal">None</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(some_dict)<br><span class="hljs-literal">None</span><br></code></pre></td></tr></table></figure></p>
<h4 id="💡-说明-22"><a href="#💡-说明-22" class="headerlink" title="💡 说明:"></a>💡 说明:</h4><p>大多数修改序列/映射对象的方法, 比如 <code>list.append</code>, <code>dict.update</code>, <code>list.sort</code> 等等. 都是原地修改对象并返回 <code>None</code>. 这样做的理由是, 如果操作可以原地完成, 就可以避免创建对象的副本来提高性能. (参考<a target="_blank" rel="noopener" href="http://docs.python.org/2/faq/design.html#why-doesn-t-list-sort-return-the-sorted-list">这里</a>)</p>
<hr>
<h3 id="gt-Subclass-relationships-子类关系"><a href="#gt-Subclass-relationships-子类关系" class="headerlink" title="&gt; Subclass relationships/子类关系 *"></a>&gt; Subclass relationships/子类关系 *</h3><p><strong>Output:</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> Hashable<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">issubclass</span>(<span class="hljs-built_in">list</span>, <span class="hljs-built_in">object</span>)<br><span class="hljs-literal">True</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">issubclass</span>(<span class="hljs-built_in">object</span>, Hashable)<br><span class="hljs-literal">True</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">issubclass</span>(<span class="hljs-built_in">list</span>, Hashable)<br><span class="hljs-literal">False</span><br></code></pre></td></tr></table></figure></p>
<p>子类关系应该是可传递的, 对吧? (即, 如果 <code>A</code> 是 <code>B</code> 的子类, <code>B</code> 是 <code>C</code> 的子类, 那么 <code>A</code> <em>应该</em> 是 <code>C</code> 的子类.)</p>
<h4 id="💡-说明-23"><a href="#💡-说明-23" class="headerlink" title="💡 说明:"></a>💡 说明:</h4><ul>
<li>Python 中的子类关系并不一定是传递的. 任何人都可以在元类中随意定义 <code>__subclasscheck__</code>.</li>
<li>当 <code>issubclass(cls, Hashable)</code> 被调用时, 它只是在 <code>cls</code> 中寻找 <code>__hash__</code> 方法或者从继承的父类中寻找 <code>__hash__</code> 方法.</li>
<li>由于 <code>object</code> is 可散列的(hashable), 但是 <code>list</code> 是不可散列的, 所以它打破了这种传递关系.</li>
<li>在<a target="_blank" rel="noopener" href="https://www.naftaliharris.com/blog/python-subclass-intransitivity/">这里</a>可以找到更详细的解释.</li>
</ul>
<hr>
<h3 id="gt-The-mysterious-key-type-conversion-神秘的键型转换"><a href="#gt-The-mysterious-key-type-conversion-神秘的键型转换" class="headerlink" title="&gt; The mysterious key type conversion/神秘的键型转换 *"></a>&gt; The mysterious key type conversion/神秘的键型转换 *</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SomeClass</span>(<span class="hljs-title class_ inherited__">str</span>):<br>    <span class="hljs-keyword">pass</span><br><br>some_dict = &#123;<span class="hljs-string">&#x27;s&#x27;</span>:<span class="hljs-number">42</span>&#125;<br></code></pre></td></tr></table></figure>
<p><strong>Output:</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">type</span>(<span class="hljs-built_in">list</span>(some_dict.keys())[<span class="hljs-number">0</span>])<br><span class="hljs-built_in">str</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>s = SomeClass(<span class="hljs-string">&#x27;s&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>some_dict[s] = <span class="hljs-number">40</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>some_dict <span class="hljs-comment"># 预期: 两个不同的键值对</span><br>&#123;<span class="hljs-string">&#x27;s&#x27;</span>: <span class="hljs-number">40</span>&#125;<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">type</span>(<span class="hljs-built_in">list</span>(some_dict.keys())[<span class="hljs-number">0</span>])<br><span class="hljs-built_in">str</span><br></code></pre></td></tr></table></figure></p>
<h4 id="💡-说明-24"><a href="#💡-说明-24" class="headerlink" title="💡 说明:"></a>💡 说明:</h4><ul>
<li>由于 <code>SomeClass</code> 会从 <code>str</code> 自动继承 <code>__hash__</code> 方法, 所以 <code>s</code> 对象和 <code>&quot;s&quot;</code> 字符串的哈希值是相同的.</li>
<li>而 <code>SomeClass(&quot;s&quot;) == &quot;s&quot;</code> 为 <code>True</code> 是因为 <code>SomeClass</code> 也继承了 <code>str</code> 类 <code>__eq__</code> 方法.</li>
<li>由于两者的哈希值相同且相等, 所以它们在字典中表示相同的键.</li>
<li><p>如果想要实现期望的功能, 我们可以重定义 <code>SomeClass</code> 的 <code>__eq__</code> 方法.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SomeClass</span>(<span class="hljs-title class_ inherited__">str</span>):<br>  <span class="hljs-keyword">def</span> <span class="hljs-title function_">__eq__</span>(<span class="hljs-params">self, other</span>):<br>      <span class="hljs-keyword">return</span> (<br>          <span class="hljs-built_in">type</span>(self) <span class="hljs-keyword">is</span> SomeClass<br>          <span class="hljs-keyword">and</span> <span class="hljs-built_in">type</span>(other) <span class="hljs-keyword">is</span> SomeClass<br>          <span class="hljs-keyword">and</span> <span class="hljs-built_in">super</span>().__eq__(other)<br>      )<br><br>  <span class="hljs-comment"># 当我们自定义 __eq__ 方法时, Python 不会再自动继承 __hash__ 方法</span><br>  <span class="hljs-comment"># 所以我们也需要定义它</span><br>  __hash__ = <span class="hljs-built_in">str</span>.__hash__<br><br>some_dict = &#123;<span class="hljs-string">&#x27;s&#x27;</span>:<span class="hljs-number">42</span>&#125;<br></code></pre></td></tr></table></figure>
<p><strong>Output:</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>s = SomeClass(<span class="hljs-string">&#x27;s&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>some_dict[s] = <span class="hljs-number">40</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>some_dict<br>&#123;<span class="hljs-string">&#x27;s&#x27;</span>: <span class="hljs-number">40</span>, <span class="hljs-string">&#x27;s&#x27;</span>: <span class="hljs-number">42</span>&#125;<br><span class="hljs-meta">&gt;&gt;&gt; </span>keys = <span class="hljs-built_in">list</span>(some_dict.keys())<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">type</span>(keys[<span class="hljs-number">0</span>]), <span class="hljs-built_in">type</span>(keys[<span class="hljs-number">1</span>])<br>(__main__.SomeClass, <span class="hljs-built_in">str</span>)<br></code></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h3 id="gt-Let’s-see-if-you-can-guess-this-看看你能否猜到这一点"><a href="#gt-Let’s-see-if-you-can-guess-this-看看你能否猜到这一点" class="headerlink" title="&gt; Let’s see if you can guess this?/看看你能否猜到这一点?"></a>&gt; Let’s see if you can guess this?/看看你能否猜到这一点?</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">a, b = a[b] = &#123;&#125;, <span class="hljs-number">5</span><br></code></pre></td></tr></table></figure>
<p><strong>Output:</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>a<br>&#123;<span class="hljs-number">5</span>: (&#123;...&#125;, <span class="hljs-number">5</span>)&#125;<br></code></pre></td></tr></table></figure></p>
<h4 id="💡-说明-25"><a href="#💡-说明-25" class="headerlink" title="💡 说明:"></a>💡 说明:</h4><ul>
<li><p>根据 <a target="_blank" rel="noopener" href="https://docs.python.org/2/reference/simple_stmts.html#assignment-statements">Python 语言参考</a>, 赋值语句的形式如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">(target_list &quot;=&quot;)+ (expression_list | yield_expression)<br></code></pre></td></tr></table></figure>
<blockquote>
<p>赋值语句计算表达式列表(expression list)(牢记 这可以是单个表达式或以逗号分隔的列表, 后者返回元组)并将单个结果对象从左到右分配给目标列表中的每一项.</p>
</blockquote>
</li>
<li><p><code>(target_list &quot;=&quot;)+</code> 中的 <code>+</code> 意味着可以有<strong>一个或多个</strong>目标列表. 在这个例子中, 目标列表是 <code>a, b</code> 和 <code>a[b]</code> (注意表达式列表只能有一个, 在我们的例子中是 <code>&#123;&#125;, 5</code>).</p>
</li>
<li><p>表达式列表计算结束后, 将其值自动解包后<strong>从左到右</strong>分配给目标列表(target list). 因此, 在我们的例子中, 首先将 <code>&#123;&#125;, 5</code> 元组并赋值给 <code>a, b</code>, 然后我们就可以得到 <code>a = &#123;&#125;</code> 且 <code>b = 5</code>.</p>
</li>
<li><p><code>a</code> 被赋值的 <code>&#123;&#125;</code> 是可变对象.</p>
</li>
<li><p>第二个目标列表是 <code>a[b]</code> (你可能觉得这里会报错, 因为在之前的语句中 <code>a</code> 和 <code>b</code> 都还没有被定义. 但是别忘了, 我们刚刚将 <code>a</code> 赋值 <code>&#123;&#125;</code> 且将 <code>b</code> 赋值为 <code>5</code>).</p>
</li>
<li><p>现在, 我们将通过将字典中键 <code>5</code> 的值设置为元组 <code>(&#123;&#125;, 5)</code> 来创建循环引用 (输出中的 <code>&#123;...&#125;</code> 指与 <code>a</code> 引用了相同的对象). 下面是一个更简单的循环引用的例子</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>some_list = some_list[<span class="hljs-number">0</span>] = [<span class="hljs-number">0</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>some_list<br>[[...]]<br><span class="hljs-meta">&gt;&gt;&gt; </span>some_list[<span class="hljs-number">0</span>]<br>[[...]]<br><span class="hljs-meta">&gt;&gt;&gt; </span>some_list <span class="hljs-keyword">is</span> some_list[<span class="hljs-number">0</span>]<br><span class="hljs-literal">True</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>some_list[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>][<span class="hljs-number">0</span>][<span class="hljs-number">0</span>][<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] == some_list<br><span class="hljs-literal">True</span><br></code></pre></td></tr></table></figure>
<p>我们的例子就是这种情况 (<code>a[b][0]</code> 与 <code>a</code> 是相同的对象)</p>
</li>
<li><p>总结一下, 你也可以把例子拆成</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">a, b = &#123;&#125;, <span class="hljs-number">5</span><br>a[b] = a, b<br></code></pre></td></tr></table></figure>
<p>并且可以通过 <code>a[b][0]</code> 与 <code>a</code> 是相同的对象来证明是循环引用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>a[b][<span class="hljs-number">0</span>] <span class="hljs-keyword">is</span> a<br><span class="hljs-literal">True</span><br></code></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<hr>
<h2 id="Section-Appearances-are-deceptive-外表是靠不住的"><a href="#Section-Appearances-are-deceptive-外表是靠不住的" class="headerlink" title="Section: Appearances are deceptive!/外表是靠不住的!"></a>Section: Appearances are deceptive!/外表是靠不住的!</h2><h3 id="gt-Skipping-lines-跳过一行"><a href="#gt-Skipping-lines-跳过一行" class="headerlink" title="&gt; Skipping lines?/跳过一行?"></a>&gt; Skipping lines?/跳过一行?</h3><p><strong>Output:</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>value = <span class="hljs-number">11</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>valuе = <span class="hljs-number">32</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>value<br><span class="hljs-number">11</span><br></code></pre></td></tr></table></figure></p>
<p>什么鬼?</p>
<p><strong>注意:</strong> 如果你想要重现的话最简单的方法是直接复制上面的代码片段到你的文件或命令行里.</p>
<h4 id="💡-说明-26"><a href="#💡-说明-26" class="headerlink" title="💡 说明:"></a>💡 说明:</h4><p>一些非西方字符虽然看起来和英语字母相同, 但会被解释器识别为不同的字母.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;е&#x27;</span>) <span class="hljs-comment"># 西里尔语的 &#x27;e&#x27; (Ye)</span><br><span class="hljs-number">1077</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;e&#x27;</span>) <span class="hljs-comment"># 拉丁语的 &#x27;e&#x27;, 用于英文并使用标准键盘输入</span><br><span class="hljs-number">101</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&#x27;е&#x27;</span> == <span class="hljs-string">&#x27;e&#x27;</span><br><span class="hljs-literal">False</span><br><br><span class="hljs-meta">&gt;&gt;&gt; </span>value = <span class="hljs-number">42</span> <span class="hljs-comment"># 拉丁语 e</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>valuе = <span class="hljs-number">23</span> <span class="hljs-comment"># 西里尔语 &#x27;e&#x27;, Python 2.x 的解释器在这会抛出 `SyntaxError` 异常</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>value<br><span class="hljs-number">42</span><br></code></pre></td></tr></table></figure>
<p>内置的 <code>ord()</code> 函数可以返回一个字符的 Unicode <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Code_point">代码点</a>, 这里西里尔语 ‘e’ 和拉丁语 ‘e’ 的代码点不同证实了上述例子.</p>
<hr>
<h3 id="gt-Teleportation-空间移动"><a href="#gt-Teleportation-空间移动" class="headerlink" title="&gt; Teleportation/空间移动 *"></a>&gt; Teleportation/空间移动 *</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">energy_send</span>(<span class="hljs-params">x</span>):<br>    <span class="hljs-comment"># 初始化一个 numpy 数组</span><br>    np.array([<span class="hljs-built_in">float</span>(x)])<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">energy_receive</span>():<br>    <span class="hljs-comment"># 返回一个空的 numpy 数组</span><br>    <span class="hljs-keyword">return</span> np.empty((), dtype=np.<span class="hljs-built_in">float</span>).tolist()<br></code></pre></td></tr></table></figure>
<p><strong>Output:</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>energy_send(<span class="hljs-number">123.456</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>energy_receive()<br><span class="hljs-number">123.456</span><br></code></pre></td></tr></table></figure></p>
<p>谁来给我发个诺贝尔奖?</p>
<h4 id="💡-说明-27"><a href="#💡-说明-27" class="headerlink" title="💡 说明:"></a>💡 说明:</h4><ul>
<li>注意在 <code>energy_send</code> 函数中创建的 numpy 数组并没有返回, 因此内存空间被释放并可以被重新分配.</li>
<li><code>numpy.empty()</code> 直接返回下一段空闲内存，而不重新初始化. 而这个内存点恰好就是刚刚释放的那个(通常情况下, 并不绝对).</li>
</ul>
<hr>
<h3 id="gt-Well-something-is-fishy…-嗯，有些可疑…"><a href="#gt-Well-something-is-fishy…-嗯，有些可疑…" class="headerlink" title="&gt; Well, something is fishy…/嗯，有些可疑…"></a>&gt; Well, something is fishy…/嗯，有些可疑…</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">square</span>(<span class="hljs-params">x</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    一个通过加法计算平方的简单函数.</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    sum_so_far = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> counter <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(x):<br>        sum_so_far = sum_so_far + x<br>  <span class="hljs-keyword">return</span> sum_so_far<br></code></pre></td></tr></table></figure>
<p><strong>Output (Python 2.x):</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>square(<span class="hljs-number">10</span>)<br><span class="hljs-number">10</span><br></code></pre></td></tr></table></figure>
<p>难道不应该是100吗?</p>
<p><strong>注意:</strong> 如果你无法重现, 可以尝试运行这个文件<a href="/mixed_tabs_and_spaces.py">mixed_tabs_and_spaces.py</a>.</p>
<h4 id="💡-说明-28"><a href="#💡-说明-28" class="headerlink" title="💡 说明:"></a>💡 说明:</h4><ul>
<li><strong>不要混用制表符(tab)和空格(space)!</strong> 在上面的例子中, return 的前面是”1个制表符”, 而其他部分的代码前面是 “4个空格”.</li>
<li><p>Python是这么处理制表符的:</p>
<blockquote>
<p>首先, 制表符会从左到右依次被替换成8个空格, 直到被替换后的字符总数是八的倍数 &lt;…&gt;</p>
</blockquote>
</li>
<li>因此, <code>square</code> 函数最后一行的制表符会被替换成8个空格, 导致return语句进入循环语句里面.</li>
<li><p>Python 3 很友好, 在这种情况下会自动抛出错误.</p>
<p>  <strong>Output (Python 3.x):</strong></p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">TabError: inconsistent use of tabs <span class="hljs-keyword">and</span> spaces <span class="hljs-keyword">in</span> indentation<br></code></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<hr>
<h2 id="Section-Watch-out-for-the-landmines-小心地雷"><a href="#Section-Watch-out-for-the-landmines-小心地雷" class="headerlink" title="Section: Watch out for the landmines!/小心地雷!"></a>Section: Watch out for the landmines!/小心地雷!</h2><h3 id="gt-Modifying-a-dictionary-while-iterating-over-it-迭代字典时的修改"><a href="#gt-Modifying-a-dictionary-while-iterating-over-it-迭代字典时的修改" class="headerlink" title="&gt; Modifying a dictionary while iterating over it/迭代字典时的修改"></a>&gt; Modifying a dictionary while iterating over it/迭代字典时的修改</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">x = &#123;<span class="hljs-number">0</span>: <span class="hljs-literal">None</span>&#125;<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> x:<br>    <span class="hljs-keyword">del</span> x[i]<br>    x[i+<span class="hljs-number">1</span>] = <span class="hljs-literal">None</span><br>    <span class="hljs-built_in">print</span>(i)<br></code></pre></td></tr></table></figure>
<p><strong>Output (Python 2.7- Python 3.5):</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">0<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br></code></pre></td></tr></table></figure>
<p>是的, 它运行了<strong>八次</strong>然后才停下来.</p>
<h4 id="💡-说明-29"><a href="#💡-说明-29" class="headerlink" title="💡 说明:"></a>💡 说明:</h4><ul>
<li>Python不支持对字典进行迭代的同时修改它.</li>
<li>它之所以运行8次, 是因为字典会自动扩容以容纳更多键值(我们有8次删除记录, 因此需要扩容). 这实际上是一个实现细节. (译: 应该是因为字典的初始最小值是8, 扩容会导致散列表地址发生变化而中断循环.)</li>
<li>在不同的Python实现中删除键的处理方式以及调整大小的时间可能会有所不同.(译: 就是说什么时候扩容在不同版本中可能是不同的, 在3.6及3.7的版本中到<a target="_blank" rel="noopener" href="https://github.com/python/cpython/blob/v3.6.1/Objects/dictobject.c#L103-L110">5</a>就会自动扩容了. 以后也有可能再次发生变化. 这是为了避免散列冲突. 顺带一提, 后面两次扩容会扩展为32和256. 即<code>8-&gt;32-&gt;256</code>.)</li>
<li>更多的信息, 你可以参考这个StackOverflow的<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/44763802/bug-in-python-dict">回答</a>, 它详细的解释一个类似的例子.</li>
</ul>
<hr>
<h3 id="gt-Stubborn-del-operator-坚强的-del"><a href="#gt-Stubborn-del-operator-坚强的-del" class="headerlink" title="&gt; Stubborn del operator/坚强的 del *"></a>&gt; Stubborn <code>del</code> operator/坚强的 <code>del</code> *</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SomeClass</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__del__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Deleted!&quot;</span>)<br></code></pre></td></tr></table></figure>
<p><strong>Output:</strong><br>1.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>x = SomeClass()<br><span class="hljs-meta">&gt;&gt;&gt; </span>y = x<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">del</span> x <span class="hljs-comment"># 这里应该会输出 &quot;Deleted!&quot;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">del</span> y<br>Deleted!<br></code></pre></td></tr></table></figure></p>
<p>唷, 终于删除了. 你可能已经猜到了在我们第一次尝试删除 <code>x</code> 时是什么让 <code>__del__</code> 免于被调用的. 那让我们给这个例子增加点难度.</p>
<p>2.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>x = SomeClass()<br><span class="hljs-meta">&gt;&gt;&gt; </span>y = x<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">del</span> x<br><span class="hljs-meta">&gt;&gt;&gt; </span>y <span class="hljs-comment"># 检查一下y是否存在</span><br>&lt;__main__.SomeClass instance at <span class="hljs-number">0x7f98a1a67fc8</span>&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">del</span> y <span class="hljs-comment"># 像之前一样, 这里应该会输出 &quot;Deleted!&quot;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">globals</span>() <span class="hljs-comment"># 好吧, 并没有. 让我们看一下所有的全局变量</span><br>Deleted!<br>&#123;<span class="hljs-string">&#x27;__builtins__&#x27;</span>: &lt;module <span class="hljs-string">&#x27;__builtin__&#x27;</span> (built-<span class="hljs-keyword">in</span>)&gt;, <span class="hljs-string">&#x27;SomeClass&#x27;</span>: &lt;<span class="hljs-keyword">class</span> <span class="hljs-title class_">__main__</span>.SomeClass at <span class="hljs-number">0x7f98a1a5f668</span>&gt;, <span class="hljs-string">&#x27;__package__&#x27;</span>: <span class="hljs-literal">None</span>, <span class="hljs-string">&#x27;__name__&#x27;</span>: <span class="hljs-string">&#x27;__main__&#x27;</span>, <span class="hljs-string">&#x27;__doc__&#x27;</span>: <span class="hljs-literal">None</span>&#125;<br></code></pre></td></tr></table></figure></p>
<p>好了，现在它被删除了 :confused:</p>
<h4 id="💡-说明-30"><a href="#💡-说明-30" class="headerlink" title="💡 说明:"></a>💡 说明:</h4><ul>
<li><code>del x</code> 并不会立刻调用 <code>x.__del__()</code>.</li>
<li>每当遇到 <code>del x</code>, Python 会将 <code>x</code> 的引用数减1, 当 <code>x</code> 的引用数减到0时就会调用 <code>x.__del__()</code>.</li>
<li>在第二个例子中, <code>y.__del__()</code> 之所以未被调用, 是因为前一条语句 (<code>&gt;&gt;&gt; y</code>) 对同一对象创建了另一个引用, 从而防止在执行 <code>del y</code> 后对象的引用数变为0.</li>
<li>调用 <code>globals</code> 导致引用被销毁, 因此我们可以看到 “Deleted!” 终于被输出了.</li>
<li>(译: 这其实是 Python 交互解释器的特性, 它会自动让 <code>_</code> 保存上一个表达式输出的值, 详细可以看<a target="_blank" rel="noopener" href="https://www.cnblogs.com/leisurelylicht/p/diao-pi-de-kong-zhi-tai.html">这里</a>.)</li>
</ul>
<hr>
<h3 id="gt-Deleting-a-list-item-while-iterating-迭代列表时删除元素"><a href="#gt-Deleting-a-list-item-while-iterating-迭代列表时删除元素" class="headerlink" title="&gt; Deleting a list item while iterating/迭代列表时删除元素"></a>&gt; Deleting a list item while iterating/迭代列表时删除元素</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python">list_1 = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]<br>list_2 = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]<br>list_3 = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]<br>list_4 = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]<br><br><span class="hljs-keyword">for</span> idx, item <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(list_1):<br>    <span class="hljs-keyword">del</span> item<br><br><span class="hljs-keyword">for</span> idx, item <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(list_2):<br>    list_2.remove(item)<br><br><span class="hljs-keyword">for</span> idx, item <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(list_3[:]):<br>    list_3.remove(item)<br><br><span class="hljs-keyword">for</span> idx, item <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(list_4):<br>    list_4.pop(idx)<br></code></pre></td></tr></table></figure>
<p><strong>Output:</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>list_1<br>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>list_2<br>[<span class="hljs-number">2</span>, <span class="hljs-number">4</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>list_3<br>[]<br><span class="hljs-meta">&gt;&gt;&gt; </span>list_4<br>[<span class="hljs-number">2</span>, <span class="hljs-number">4</span>]<br></code></pre></td></tr></table></figure></p>
<p>你能猜到为什么输出是 <code>[2, 4]</code> 吗?</p>
<h4 id="💡-说明-31"><a href="#💡-说明-31" class="headerlink" title="💡 说明:"></a>💡 说明:</h4><ul>
<li><p>在迭代时修改对象是一个很愚蠢的主意. 正确的做法是迭代对象的副本, <code>list_3[:]</code> 就是这么做的.</p>
   <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>some_list = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">id</span>(some_list)<br><span class="hljs-number">139798789457608</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">id</span>(some_list[:]) <span class="hljs-comment"># 注意python为切片列表创建了新对象.</span><br><span class="hljs-number">139798779601192</span><br></code></pre></td></tr></table></figure>
</li>
</ul>
<p><strong><code>del</code>, <code>remove</code> 和 <code>pop</code> 的不同:</strong></p>
<ul>
<li><code>del var_name</code> 只是从本地或全局命名空间中删除了 <code>var_name</code> (这就是为什么 <code>list_1</code> 没有受到影响).</li>
<li><code>remove</code> 会删除第一个匹配到的指定值, 而不是特定的索引, 如果找不到值则抛出 <code>ValueError</code> 异常.</li>
<li><code>pop</code> 则会删除指定索引处的元素并返回它, 如果指定了无效的索引则抛出 <code>IndexError</code> 异常.</li>
</ul>
<p><strong>为什么输出是 <code>[2, 4]</code>?</strong></p>
<ul>
<li>列表迭代是按索引进行的, 所以当我们从 <code>list_2</code> 或 <code>list_4</code> 中删除 <code>1</code> 时, 列表的内容就变成了 <code>[2, 3, 4]</code>. 剩余元素会依次位移, 也就是说, <code>2</code> 的索引会变为 0, <code>3</code> 会变为 1. 由于下一次迭代将获取索引为 1 的元素 (即 <code>3</code>), 因此 <code>2</code> 将被彻底的跳过. 类似的情况会交替发生在列表中的每个元素上.</li>
</ul>
<ul>
<li>参考这个StackOverflow的<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/45946228/what-happens-when-you-try-to-delete-a-list-element-while-iterating-over-it">回答</a>来解释这个例子</li>
<li>关于Python中字典的类似例子, 可以参考这个Stackoverflow的<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/45877614/how-to-change-all-the-dictionary-keys-in-a-for-loop-with-d-items">回答</a>.</li>
</ul>
<hr>
<h3 id="gt-Loop-variables-leaking-out-循环变量泄漏"><a href="#gt-Loop-variables-leaking-out-循环变量泄漏" class="headerlink" title="&gt; Loop variables leaking out!/循环变量泄漏!"></a>&gt; Loop variables leaking out!/循环变量泄漏!</h3><p>1.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):<br>    <span class="hljs-keyword">if</span> x == <span class="hljs-number">6</span>:<br>        <span class="hljs-built_in">print</span>(x, <span class="hljs-string">&#x27;: for x inside loop&#x27;</span>)<br><span class="hljs-built_in">print</span>(x, <span class="hljs-string">&#x27;: x in global&#x27;</span>)<br></code></pre></td></tr></table></figure></p>
<p><strong>Output:</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-number">6</span> : <span class="hljs-keyword">for</span> x inside loop<br><span class="hljs-number">6</span> : x <span class="hljs-keyword">in</span> <span class="hljs-keyword">global</span><br></code></pre></td></tr></table></figure></p>
<p>但是 <code>x</code> 从未在循环外被定义…</p>
<p>2.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 这次我们先初始化x</span><br>x = -<span class="hljs-number">1</span><br><span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):<br>    <span class="hljs-keyword">if</span> x == <span class="hljs-number">6</span>:<br>        <span class="hljs-built_in">print</span>(x, <span class="hljs-string">&#x27;: for x inside loop&#x27;</span>)<br><span class="hljs-built_in">print</span>(x, <span class="hljs-string">&#x27;: x in global&#x27;</span>)<br></code></pre></td></tr></table></figure></p>
<p><strong>Output:</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-number">6</span> : <span class="hljs-keyword">for</span> x inside loop<br><span class="hljs-number">6</span> : x <span class="hljs-keyword">in</span> <span class="hljs-keyword">global</span><br></code></pre></td></tr></table></figure></p>
<p>3.<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">x = 1<br>print([x for x in range(5)])<br>print(x, &#x27;: x in global&#x27;)<br></code></pre></td></tr></table></figure></p>
<p><strong>Output (on Python 2.x):</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">[0, 1, 2, 3, 4]<br>(4, &#x27;: x in global&#x27;)<br></code></pre></td></tr></table></figure></p>
<p><strong>Output (on Python 3.x):</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">[0, 1, 2, 3, 4]<br>1 : x in global<br></code></pre></td></tr></table></figure></p>
<h4 id="💡-说明-32"><a href="#💡-说明-32" class="headerlink" title="💡 说明:"></a>💡 说明:</h4><ul>
<li><p>在 Python 中, for 循环使用所在作用域并在结束后保留定义的循环变量. 如果我们曾在全局命名空间中定义过循环变量. 在这种情况下, 它会重新绑定现有变量.</p>
</li>
<li><p>Python 2.x 和 Python 3.x 解释器在列表推导式示例中的输出差异, 在文档 <a target="_blank" rel="noopener" href="https://docs.python.org/3/whatsnew/3.0.html">What’s New In Python 3.0</a> 中可以找到相关的解释:</p>
<blockquote>
<p>“列表推导不再支持句法形式 <code>[... for var in item1, item2, ...]</code>. 取而代之的是 <code>[... for var in (item1, item2, ...)]</code>. 另外, 注意列表推导具有不同的语义: 它们更接近于 <code>list()</code> 构造函数中生成器表达式的语法糖(译: 这一句我也不是很明白), 特别是循环控制变量不再泄漏到周围的作用域中.”</p>
</blockquote>
</li>
</ul>
<hr>
<h3 id="gt-Beware-of-default-mutable-arguments-当心默认的可变参数"><a href="#gt-Beware-of-default-mutable-arguments-当心默认的可变参数" class="headerlink" title="&gt; Beware of default mutable arguments!/当心默认的可变参数!"></a>&gt; Beware of default mutable arguments!/当心默认的可变参数!</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">some_func</span>(<span class="hljs-params">default_arg=[]</span>):<br>    default_arg.append(<span class="hljs-string">&quot;some_string&quot;</span>)<br>    <span class="hljs-keyword">return</span> default_arg<br></code></pre></td></tr></table></figure>
<p><strong>Output:</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>some_func()<br>[<span class="hljs-string">&#x27;some_string&#x27;</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>some_func()<br>[<span class="hljs-string">&#x27;some_string&#x27;</span>, <span class="hljs-string">&#x27;some_string&#x27;</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>some_func([])<br>[<span class="hljs-string">&#x27;some_string&#x27;</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>some_func()<br>[<span class="hljs-string">&#x27;some_string&#x27;</span>, <span class="hljs-string">&#x27;some_string&#x27;</span>, <span class="hljs-string">&#x27;some_string&#x27;</span>]<br></code></pre></td></tr></table></figure></p>
<h4 id="💡-说明-33"><a href="#💡-说明-33" class="headerlink" title="💡 说明:"></a>💡 说明:</h4><ul>
<li><p>Python中函数的默认可变参数并不是每次调用该函数时都会被初始化. 相反, 它们会使用最近分配的值作为默认值. 当我们明确的将 <code>[]</code> 作为参数传递给 <code>some_func</code> 的时候, 就不会使用 <code>default_arg</code> 的默认值, 所以函数会返回我们所期望的结果.</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">some_func</span>(<span class="hljs-params">default_arg=[]</span>):<br>    default_arg.append(<span class="hljs-string">&quot;some_string&quot;</span>)<br>    <span class="hljs-keyword">return</span> default_arg<br></code></pre></td></tr></table></figure>
<p>  <strong>Output:</strong></p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>some_func.__defaults__ <span class="hljs-comment"># 这里会显示函数的默认参数的值</span><br>([],)<br><span class="hljs-meta">&gt;&gt;&gt; </span>some_func()<br><span class="hljs-meta">&gt;&gt;&gt; </span>some_func.__defaults__<br>([<span class="hljs-string">&#x27;some_string&#x27;</span>],)<br><span class="hljs-meta">&gt;&gt;&gt; </span>some_func()<br><span class="hljs-meta">&gt;&gt;&gt; </span>some_func.__defaults__<br>([<span class="hljs-string">&#x27;some_string&#x27;</span>, <span class="hljs-string">&#x27;some_string&#x27;</span>],)<br><span class="hljs-meta">&gt;&gt;&gt; </span>some_func([])<br><span class="hljs-meta">&gt;&gt;&gt; </span>some_func.__defaults__<br>([<span class="hljs-string">&#x27;some_string&#x27;</span>, <span class="hljs-string">&#x27;some_string&#x27;</span>],)<br></code></pre></td></tr></table></figure>
</li>
<li><p>避免可变参数导致的错误的常见做法是将 <code>None</code> 指定为参数的默认值, 然后检查是否有值传给对应的参数. 例:</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">some_func</span>(<span class="hljs-params">default_arg=<span class="hljs-literal">None</span></span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> default_arg:<br>        default_arg = []<br>    default_arg.append(<span class="hljs-string">&quot;some_string&quot;</span>)<br>    <span class="hljs-keyword">return</span> default_arg<br></code></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h3 id="gt-Catching-the-Exceptions-捕获异常"><a href="#gt-Catching-the-Exceptions-捕获异常" class="headerlink" title="&gt; Catching the Exceptions/捕获异常"></a>&gt; Catching the Exceptions/捕获异常</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python">some_list = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]<br><span class="hljs-keyword">try</span>:<br>    <span class="hljs-comment"># 这里会抛出异常 ``IndexError``</span><br>    <span class="hljs-built_in">print</span>(some_list[<span class="hljs-number">4</span>])<br><span class="hljs-keyword">except</span> IndexError, ValueError:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Caught!&quot;</span>)<br><br><span class="hljs-keyword">try</span>:<br>    <span class="hljs-comment"># 这里会抛出异常 ``ValueError``</span><br>    some_list.remove(<span class="hljs-number">4</span>)<br><span class="hljs-keyword">except</span> IndexError, ValueError:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Caught again!&quot;</span>)<br></code></pre></td></tr></table></figure>
<p><strong>Output (Python 2.x):</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">Caught!<br><br>ValueError: <span class="hljs-built_in">list</span>.remove(x): x <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">list</span><br></code></pre></td></tr></table></figure></p>
<p><strong>Output (Python 3.x):</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">  File <span class="hljs-string">&quot;&lt;input&gt;&quot;</span>, line <span class="hljs-number">3</span><br>    <span class="hljs-keyword">except</span> IndexError, ValueError:<br>                     ^<br>SyntaxError: invalid syntax<br></code></pre></td></tr></table></figure></p>
<h4 id="💡-说明-34"><a href="#💡-说明-34" class="headerlink" title="💡 说明:"></a>💡 说明:</h4><ul>
<li><p>如果你想要同时捕获多个不同类型的异常时, 你需要将它们用括号包成一个元组作为第一个参数传递. 第二个参数是可选名称, 如果你提供, 它将与被捕获的异常实例绑定. 例,</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">some_list = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]<br><span class="hljs-keyword">try</span>:<br>   <span class="hljs-comment"># 这里会抛出异常 ``ValueError``</span><br>   some_list.remove(<span class="hljs-number">4</span>)<br><span class="hljs-keyword">except</span> (IndexError, ValueError), e:<br>   <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Caught again!&quot;</span>)<br>   <span class="hljs-built_in">print</span>(e)<br></code></pre></td></tr></table></figure>
<p><strong>Output (Python 2.x):</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">Caught again!<br>list.remove(x): x not in list<br></code></pre></td></tr></table></figure>
<p><strong>Output (Python 3.x):</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">  File <span class="hljs-string">&quot;&lt;input&gt;&quot;</span>, line <span class="hljs-number">4</span><br>    <span class="hljs-keyword">except</span> (IndexError, ValueError), e:<br>                                     ^<br>IndentationError: unindent does <span class="hljs-keyword">not</span> match <span class="hljs-built_in">any</span> outer indentation level<br></code></pre></td></tr></table></figure>
</li>
<li><p>在 Python 3 中, 用逗号区分异常与可选名称是无效的; 正确的做法是使用 <code>as</code> 关键字. 例,</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">some_list = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]<br><span class="hljs-keyword">try</span>:<br>    some_list.remove(<span class="hljs-number">4</span>)<br><br><span class="hljs-keyword">except</span> (IndexError, ValueError) <span class="hljs-keyword">as</span> e:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Caught again!&quot;</span>)<br>    <span class="hljs-built_in">print</span>(e)<br></code></pre></td></tr></table></figure>
<p><strong>Output:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">Caught again!<br>list.remove(x): x not in list<br></code></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h3 id="gt-Same-operands-different-story-同人不同命"><a href="#gt-Same-operands-different-story-同人不同命" class="headerlink" title="&gt; Same operands, different story!/同人不同命!"></a>&gt; Same operands, different story!/同人不同命!</h3><p>1.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">a = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]<br>b = a<br>a = a + [<span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>]<br></code></pre></td></tr></table></figure></p>
<p><strong>Output:</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>a<br>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>b<br>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]<br></code></pre></td></tr></table></figure></p>
<p>2.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">a = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]<br>b = a<br>a += [<span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>]<br></code></pre></td></tr></table></figure></p>
<p><strong>Output:</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>a<br>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>b<br>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>]<br></code></pre></td></tr></table></figure></p>
<h4 id="💡-说明-35"><a href="#💡-说明-35" class="headerlink" title="💡 说明:"></a>💡 说明:</h4><ul>
<li><p><code>a += b</code> 并不总是与 <code>a = a + b</code> 表现相同. 类实现 <em><code>op=</code></em> 运算符的方式 <em>也许</em> 是不同的, 列表就是这样做的.</p>
</li>
<li><p>表达式 <code>a = a + [5,6,7,8]</code> 会生成一个新列表, 并让 <code>a</code> 引用这个新列表, 同时保持 <code>b</code> 不变.</p>
</li>
<li><p>表达式 <code>a += [5,6,7,8]</code> 实际上是使用的是 “extend” 函数, 所以 <code>a</code> 和 <code>b</code> 仍然指向已被修改的同一列表.</p>
</li>
</ul>
<hr>
<h3 id="gt-The-out-of-scope-variable-外部作用域变量"><a href="#gt-The-out-of-scope-variable-外部作用域变量" class="headerlink" title="&gt; The out of scope variable/外部作用域变量"></a>&gt; The out of scope variable/外部作用域变量</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">a = <span class="hljs-number">1</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">some_func</span>():<br>    <span class="hljs-keyword">return</span> a<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">another_func</span>():<br>    a += <span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> a<br></code></pre></td></tr></table></figure>
<p><strong>Output:</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>some_func()<br><span class="hljs-number">1</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>another_func()<br>UnboundLocalError: local variable <span class="hljs-string">&#x27;a&#x27;</span> referenced before assignment<br></code></pre></td></tr></table></figure></p>
<h4 id="💡-说明-36"><a href="#💡-说明-36" class="headerlink" title="💡 说明:"></a>💡 说明:</h4><ul>
<li>当你在作用域中对变量进行赋值时, 变量会变成该作用域内的局部变量. 因此 <code>a</code> 会变成 <code>another_func</code> 函数作用域中的局部变量, 但它在函数作用域中并没有被初始化, 所以会引发错误.</li>
<li>可以阅读<a target="_blank" rel="noopener" href="http://sebastianraschka.com/Articles/2014_python_scope_and_namespaces.html">这个</a>简短却很棒的指南, 了解更多关于 Python 中命名空间和作用域的工作原理.</li>
<li><p>想要在 <code>another_func</code> 中修改外部作用域变量 <code>a</code> 的话, 可以使用 <code>global</code> 关键字.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">another_func</span>()<br>    <span class="hljs-keyword">global</span> a<br>    a += <span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> a<br></code></pre></td></tr></table></figure>
<p><strong>Output:</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>another_func()<br><span class="hljs-number">2</span><br></code></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h3 id="gt-Be-careful-with-chained-operations-小心链式操作"><a href="#gt-Be-careful-with-chained-operations-小心链式操作" class="headerlink" title="&gt; Be careful with chained operations/小心链式操作"></a>&gt; Be careful with chained operations/小心链式操作</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>(<span class="hljs-literal">False</span> == <span class="hljs-literal">False</span>) <span class="hljs-keyword">in</span> [<span class="hljs-literal">False</span>] <span class="hljs-comment"># 可以理解</span><br><span class="hljs-literal">False</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-literal">False</span> == (<span class="hljs-literal">False</span> <span class="hljs-keyword">in</span> [<span class="hljs-literal">False</span>]) <span class="hljs-comment"># 可以理解</span><br><span class="hljs-literal">False</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-literal">False</span> == <span class="hljs-literal">False</span> <span class="hljs-keyword">in</span> [<span class="hljs-literal">False</span>] <span class="hljs-comment"># 为毛?</span><br><span class="hljs-literal">True</span><br><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-literal">True</span> <span class="hljs-keyword">is</span> <span class="hljs-literal">False</span> == <span class="hljs-literal">False</span><br><span class="hljs-literal">False</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-literal">False</span> <span class="hljs-keyword">is</span> <span class="hljs-literal">False</span> <span class="hljs-keyword">is</span> <span class="hljs-literal">False</span><br><span class="hljs-literal">True</span><br><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-number">1</span> &gt; <span class="hljs-number">0</span> &lt; <span class="hljs-number">1</span><br><span class="hljs-literal">True</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>(<span class="hljs-number">1</span> &gt; <span class="hljs-number">0</span>) &lt; <span class="hljs-number">1</span><br><span class="hljs-literal">False</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-number">1</span> &gt; (<span class="hljs-number">0</span> &lt; <span class="hljs-number">1</span>)<br><span class="hljs-literal">False</span><br></code></pre></td></tr></table></figure>
<h4 id="💡-说明-37"><a href="#💡-说明-37" class="headerlink" title="💡 说明:"></a>💡 说明:</h4><p>根据 <a target="_blank" rel="noopener" href="https://docs.python.org/2/reference/expressions.html#not-in">https://docs.python.org/2/reference/expressions.html#not-in</a></p>
<blockquote>
<p>形式上, 如果 a, b, c, …, y, z 是表达式, 而 op1, op2, …, opN 是比较运算符, 那么除了每个表达式最多只出现一次以外 a op1 b op2 c … y opN z 就等于 a op1 b and b op2 c and … y opN z.</p>
</blockquote>
<p>虽然上面的例子似乎很愚蠢, 但是像 <code>a == b == c</code> 或 <code>0 &lt;= x &lt;= 100</code> 就很棒了.</p>
<ul>
<li><code>False is False is False</code> 相当于 <code>(False is False) and (False is False)</code></li>
<li><code>True is False == False</code> 相当于 <code>True is False and False == False</code>, 由于语句的第一部分 (<code>True is False</code>) 等于 <code>False</code>, 因此整个表达式的结果为 <code>False</code>.</li>
<li><code>1 &gt; 0 &lt; 1</code> 相当于 <code>1 &gt; 0 and 0 &lt; 1</code>, 所以最终结果为 <code>True</code>.</li>
<li>表达式 <code>(1 &gt; 0) &lt; 1</code> 相当于 <code>True &lt; 1</code> 且<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">int</span>(<span class="hljs-literal">True</span>)<br><span class="hljs-number">1</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-literal">True</span> + <span class="hljs-number">1</span> <span class="hljs-comment"># 与这个例子无关，只是好玩</span><br><span class="hljs-number">2</span><br></code></pre></td></tr></table></figure>
所以, <code>1 &lt; 1</code> 等于 <code>False</code></li>
</ul>
<hr>
<h3 id="gt-Name-resolution-ignoring-class-scope-忽略类作用域的名称解析"><a href="#gt-Name-resolution-ignoring-class-scope-忽略类作用域的名称解析" class="headerlink" title="&gt; Name resolution ignoring class scope/忽略类作用域的名称解析"></a>&gt; Name resolution ignoring class scope/忽略类作用域的名称解析</h3><p>1.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">x = <span class="hljs-number">5</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SomeClass</span>:<br>    x = <span class="hljs-number">17</span><br>    y = (x <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>))<br></code></pre></td></tr></table></figure></p>
<p><strong>Output:</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">list</span>(SomeClass.y)[<span class="hljs-number">0</span>]<br><span class="hljs-number">5</span><br></code></pre></td></tr></table></figure></p>
<p>2.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">x = <span class="hljs-number">5</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SomeClass</span>:<br>    x = <span class="hljs-number">17</span><br>    y = [x <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>)]<br></code></pre></td></tr></table></figure></p>
<p><strong>Output (Python 2.x):</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>SomeClass.y[<span class="hljs-number">0</span>]<br><span class="hljs-number">17</span><br></code></pre></td></tr></table></figure></p>
<p><strong>Output (Python 3.x):</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>SomeClass.y[<span class="hljs-number">0</span>]<br><span class="hljs-number">5</span><br></code></pre></td></tr></table></figure></p>
<h4 id="💡-说明-38"><a href="#💡-说明-38" class="headerlink" title="💡 说明:"></a>💡 说明:</h4><ul>
<li>类定义中嵌套的作用域会忽略类内的名称绑定.</li>
<li>生成器表达式有它自己的作用域.</li>
<li>从 Python 3.X 开始, 列表推导式也有自己的作用域.</li>
</ul>
<hr>
<h3 id="gt-Needle-in-a-Haystack-大海捞针"><a href="#gt-Needle-in-a-Haystack-大海捞针" class="headerlink" title="&gt; Needle in a Haystack/大海捞针"></a>&gt; Needle in a Haystack/大海捞针</h3><p>1.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">x, y = (<span class="hljs-number">0</span>, <span class="hljs-number">1</span>) <span class="hljs-keyword">if</span> <span class="hljs-literal">True</span> <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span>, <span class="hljs-literal">None</span><br></code></pre></td></tr></table></figure></p>
<p><strong>Output:</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&gt;&gt;&gt; x, y  # 期望的结果是 (0, 1)<br>((0, 1), None)<br></code></pre></td></tr></table></figure></p>
<p>几乎每个 Python 程序员都遇到过类似的情况.</p>
<p>2.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python">t = (<span class="hljs-string">&#x27;one&#x27;</span>, <span class="hljs-string">&#x27;two&#x27;</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> t:<br>    <span class="hljs-built_in">print</span>(i)<br><br>t = (<span class="hljs-string">&#x27;one&#x27;</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> t:<br>    <span class="hljs-built_in">print</span>(i)<br><br>t = ()<br><span class="hljs-built_in">print</span>(t)<br></code></pre></td></tr></table></figure></p>
<p><strong>Output:</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">one<br>two<br>o<br>n<br>e<br><span class="hljs-built_in">tuple</span>()<br></code></pre></td></tr></table></figure></p>
<h4 id="💡-说明-39"><a href="#💡-说明-39" class="headerlink" title="💡 说明:"></a>💡 说明:</h4><ul>
<li>对于 1, 正确的语句是 <code>x, y = (0, 1) if True else (None, None)</code>.</li>
<li>对于 2, 正确的语句是 <code>t = (&#39;one&#39;,)</code> 或者 <code>t = &#39;one&#39;,</code> (缺少逗号) 否则解释器会认为 <code>t</code> 是一个字符串, 并逐个字符对其进行迭代.</li>
<li><code>()</code> 是一个特殊的标记，表示空元组.</li>
</ul>
<hr>
<hr>
<h2 id="Section-The-Hidden-treasures-隐藏的宝藏"><a href="#Section-The-Hidden-treasures-隐藏的宝藏" class="headerlink" title="Section: The Hidden treasures!/隐藏的宝藏!"></a>Section: The Hidden treasures!/隐藏的宝藏!</h2><p>This section contains few of the lesser-known interesting things about Python that most beginners like me are unaware of (well, not anymore).</p>
<h3 id="gt-Okay-Python-Can-you-make-me-fly-Python-可否带我飞"><a href="#gt-Okay-Python-Can-you-make-me-fly-Python-可否带我飞" class="headerlink" title="&gt; Okay Python, Can you make me fly?/Python, 可否带我飞? *"></a>&gt; Okay Python, Can you make me fly?/Python, 可否带我飞? *</h3><p>好, 去吧.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> antigravity<br></code></pre></td></tr></table></figure>
<p><strong>Output:</strong><br>嘘.. 这是个超级秘密.</p>
<h4 id="💡-说明-40"><a href="#💡-说明-40" class="headerlink" title="💡 说明:"></a>💡 说明:</h4><ul>
<li><code>antigravity</code> 模块是 Python 开发人员发布的少数复活节彩蛋之一.</li>
<li><code>import antigravity</code> 会打开一个 Python 的<a target="_blank" rel="noopener" href="http://xkcd.com/353/">经典 XKCD 漫画</a>页面.</li>
<li>不止如此. 这个<strong>复活节彩蛋里还有一个复活节彩蛋</strong>. 如果你看一下<a target="_blank" rel="noopener" href="https://github.com/python/cpython/blob/master/Lib/antigravity.py#L7-L17">代码</a>, 就会发现还有一个函数实现了 <a target="_blank" rel="noopener" href="https://xkcd.com/426/">XKCD’s geohashing 算法</a>.</li>
</ul>
<hr>
<h3 id="gt-goto-but-why-goto-但为什么"><a href="#gt-goto-but-why-goto-但为什么" class="headerlink" title="&gt; goto, but why?/goto, 但为什么? *"></a>&gt; <code>goto</code>, but why?/<code>goto</code>, 但为什么? *</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> goto <span class="hljs-keyword">import</span> goto, label<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">9</span>):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">9</span>):<br>        <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">9</span>):<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;I&#x27;m trapped, please rescue!&quot;</span>)<br>            <span class="hljs-keyword">if</span> k == <span class="hljs-number">2</span>:<br>                goto .breakout <span class="hljs-comment"># 从多重循环中跳出</span><br>label .breakout<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Freedom!&quot;</span>)<br></code></pre></td></tr></table></figure>
<p><strong>Output (Python 2.3):</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">I<span class="hljs-string">&#x27;m trapped, please rescue!</span><br><span class="hljs-string">I&#x27;</span>m trapped, please rescue!<br>Freedom!<br></code></pre></td></tr></table></figure></p>
<h4 id="💡-说明-41"><a href="#💡-说明-41" class="headerlink" title="💡 说明:"></a>💡 说明:</h4><ul>
<li>2004年4月1日, Python <a target="_blank" rel="noopener" href="https://mail.python.org/pipermail/python-announce-list/2004-April/002982.html">宣布</a> 加入一个可用的 <code>goto</code> 作为愚人节礼物.</li>
<li>当前版本的 Python 并没有这个模块.</li>
<li>就算可以用, 也请不要使用它. 这里是为什么Python中没有 <code>goto</code> 的<a target="_blank" rel="noopener" href="https://docs.python.org/3/faq/design.html#why-is-there-no-goto">原因</a>.</li>
</ul>
<hr>
<h3 id="gt-Brace-yourself-做好思想准备"><a href="#gt-Brace-yourself-做好思想准备" class="headerlink" title="&gt; Brace yourself!/做好思想准备 *"></a>&gt; Brace yourself!/做好思想准备 *</h3><p>如果你不喜欢在Python中使用空格来表示作用域, 你可以导入 C 风格的 {},</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> braces<br></code></pre></td></tr></table></figure>
<p><strong>Output:</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">  File <span class="hljs-string">&quot;some_file.py&quot;</span>, line <span class="hljs-number">1</span><br>    <span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> braces<br>SyntaxError: <span class="hljs-keyword">not</span> a chance<br></code></pre></td></tr></table></figure></p>
<p>想用大括号? 没门! 觉得不爽, 请去用java.</p>
<h4 id="💡-说明-42"><a href="#💡-说明-42" class="headerlink" title="💡 说明:"></a>💡 说明:</h4><ul>
<li>通常 <code>__future__</code> 会提供 Python 未来版本的功能. 然而，这里的 “未来” 是一个讽刺.</li>
<li>这是一个表达社区对此类问题态度的复活节彩蛋.</li>
</ul>
<hr>
<h3 id="gt-Let’s-meet-Friendly-Language-Uncle-For-Life-让生活更友好"><a href="#gt-Let’s-meet-Friendly-Language-Uncle-For-Life-让生活更友好" class="headerlink" title="&gt; Let’s meet Friendly Language Uncle For Life/让生活更友好 *"></a>&gt; Let’s meet Friendly Language Uncle For Life/让生活更友好 *</h3><p><strong>Output (Python 3.x)</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> barry_as_FLUFL<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&quot;Ruby&quot;</span> != <span class="hljs-string">&quot;Python&quot;</span> <span class="hljs-comment"># 这里没什么疑问</span><br>  File <span class="hljs-string">&quot;some_file.py&quot;</span>, line <span class="hljs-number">1</span><br>    <span class="hljs-string">&quot;Ruby&quot;</span> != <span class="hljs-string">&quot;Python&quot;</span><br>              ^<br>SyntaxError: invalid syntax<br><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&quot;Ruby&quot;</span> &lt;&gt; <span class="hljs-string">&quot;Python&quot;</span><br><span class="hljs-literal">True</span><br></code></pre></td></tr></table></figure></p>
<p>这就对了.</p>
<h4 id="💡-说明-43"><a href="#💡-说明-43" class="headerlink" title="💡 说明:"></a>💡 说明:</h4><ul>
<li>相关的 <a target="_blank" rel="noopener" href="https://www.python.org/dev/peps/pep-0401/">PEP-401</a> 发布于 2009年4月1日 (所以你现在知道这意味着什么了吧).</li>
<li><p>引用 PEP-401</p>
<blockquote>
<p>意识到 Python 3.0 里的 != 运算符是一个会引起手指疼痛的恐怖错误, FLUFL 将 &lt;&gt; 运算符恢复为唯一写法.</p>
</blockquote>
</li>
<li>Uncle Barry 在 PEP 中还分享了其他东西; 你可以在<a target="_blank" rel="noopener" href="https://www.python.org/dev/peps/pep-0401/">这里</a>获得他们.</li>
<li>(译: 虽然文档中没写，但应该是只能在交互解释器中使用.)</li>
</ul>
<hr>
<h3 id="gt-Even-Python-understands-that-love-is-complicated-连Python也知道爱是难言的"><a href="#gt-Even-Python-understands-that-love-is-complicated-连Python也知道爱是难言的" class="headerlink" title="&gt; Even Python understands that love is complicated/连Python也知道爱是难言的 *"></a>&gt; Even Python understands that love is complicated/连Python也知道爱是难言的 *</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> this<br></code></pre></td></tr></table></figure>
<p>等等, <strong>this</strong> 是什么? <code>this</code> 是爱 :heart:</p>
<p><strong>Output:</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">The Zen of Python, by Tim Peters<br><br>Beautiful is better than ugly.<br>优美胜于丑陋（Python 以编写优美的代码为目标）<br>Explicit is better than implicit.<br>明了胜于晦涩（优美的代码应当是明了的，命名规范，风格相似）<br>Simple is better than complex.<br>简洁胜于复杂（优美的代码应当是简洁的，不要有复杂的内部实现）<br>Complex is better than complicated.<br>复杂胜于凌乱（如果复杂不可避免，那代码间也不能有难懂的关系，要保持接口简洁）<br>Flat is better than nested.<br>扁平胜于嵌套（优美的代码应当是扁平的，不能有太多的嵌套）<br>Sparse is better than dense.<br>间隔胜于紧凑（优美的代码有适当的间隔，不要奢望一行代码解决问题）<br>Readability counts.<br>可读性很重要（优美的代码一定是可读的）<br>Special cases aren&#x27;t special enough to break the rules.<br>没有特例特殊到需要违背这些规则（这些规则至高无上）<br>Although practicality beats purity.<br>尽管我们更倾向于实用性<br>Errors should never pass silently.<br>不要安静的包容所有错误<br>Unless explicitly silenced.<br>除非你确定需要这样做（精准地捕获异常，不写 except:pass 风格的代码）<br>In the face of ambiguity, refuse the temptation to guess.<br>拒绝诱惑你去猜测的暧昧事物<br>There should be one-- and preferably only one --obvious way to do it.<br>而是尽量找一种，最好是唯一一种明显的解决方案（如果不确定，就用穷举法）<br>Although that way may not be obvious at first unless you&#x27;re Dutch.<br>虽然这并不容易，因为你不是 Python 之父（这里的 Dutch 是指 Guido ）<br>Now is better than never.<br>现在行动好过永远不行动<br>Although never is often better than *right* now.<br>尽管不行动要好过鲁莽行动<br>If the implementation is hard to explain, it&#x27;s a bad idea.<br>如果你无法向人描述你的方案，那肯定不是一个好方案；<br>If the implementation is easy to explain, it may be a good idea.<br>如果你能轻松向人描述你的方案，那也许会是一个好方案（方案测评标准）<br>Namespaces are one honking great idea -- let&#x27;s do more of those!<br>命名空间是一种绝妙的理念，我们应当多加利用（倡导与号召）<br></code></pre></td></tr></table></figure></p>
<p>这是 Python 之禅!</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>love = this<br><span class="hljs-meta">&gt;&gt;&gt; </span>this <span class="hljs-keyword">is</span> love<br><span class="hljs-literal">True</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>love <span class="hljs-keyword">is</span> <span class="hljs-literal">True</span><br><span class="hljs-literal">False</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>love <span class="hljs-keyword">is</span> <span class="hljs-literal">False</span><br><span class="hljs-literal">False</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>love <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">True</span> <span class="hljs-keyword">or</span> <span class="hljs-literal">False</span><br><span class="hljs-literal">True</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>love <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">True</span> <span class="hljs-keyword">or</span> <span class="hljs-literal">False</span>; love <span class="hljs-keyword">is</span> love  <span class="hljs-comment"># 爱是难言的</span><br><span class="hljs-literal">True</span><br></code></pre></td></tr></table></figure>
<h4 id="💡-说明-44"><a href="#💡-说明-44" class="headerlink" title="💡 说明:"></a>💡 说明:</h4><ul>
<li><code>this</code> 模块是关于 Python 之禅的复活节彩蛋 (<a target="_blank" rel="noopener" href="https://www.python.org/dev/peps/pep-0020">PEP 20</a>).</li>
<li>如果你认为这已经够有趣的了, 可以看看 <a target="_blank" rel="noopener" href="https://hg.python.org/cpython/file/c3896275c0f6/Lib/this.py">this.py</a> 的实现. 有趣的是, Python 之禅的实现代码违反了他自己 (这可能是唯一会发生这种情况的地方).<br>*<br>至于 <code>love is not True or False; love is love</code>, 意外却又不言而喻.</li>
</ul>
<hr>
<h3 id="gt-Yes-it-exists-是的-它存在"><a href="#gt-Yes-it-exists-是的-它存在" class="headerlink" title="&gt; Yes, it exists!/是的, 它存在!"></a>&gt; Yes, it exists!/是的, 它存在!</h3><p><strong>循环的 <code>else</code>.</strong> 一个典型的例子:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">does_exists_num</span>(<span class="hljs-params">l, to_find</span>):<br>    <span class="hljs-keyword">for</span> num <span class="hljs-keyword">in</span> l:<br>        <span class="hljs-keyword">if</span> num == to_find:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Exists!&quot;</span>)<br>            <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Does not exist&quot;</span>)<br></code></pre></td></tr></table></figure>
<p><strong>Output:</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>some_list = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>does_exists_num(some_list, <span class="hljs-number">4</span>)<br>Exists!<br><span class="hljs-meta">&gt;&gt;&gt; </span>does_exists_num(some_list, -<span class="hljs-number">1</span>)<br>Does <span class="hljs-keyword">not</span> exist<br></code></pre></td></tr></table></figure></p>
<p><strong>异常的 <code>else</code> .</strong> 例,</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">try</span>:<br>    <span class="hljs-keyword">pass</span><br><span class="hljs-keyword">except</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Exception occurred!!!&quot;</span>)<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Try block executed successfully...&quot;</span>)<br></code></pre></td></tr></table></figure>
<p><strong>Output:</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">Try block executed successfully...<br></code></pre></td></tr></table></figure></p>
<h4 id="💡-说明-45"><a href="#💡-说明-45" class="headerlink" title="💡 说明:"></a>💡 说明:</h4><ul>
<li>循环后的 <code>else</code> 子句只会在循环没有触发 <code>break</code> 语句, 正常结束的情况下才会执行.</li>
<li>try 之后的 <code>else</code> 子句也被称为 “完成子句”, 因为在 <code>try</code> 语句中到达 <code>else</code> 子句意味着try块实际上已成功完成.</li>
</ul>
<hr>
<h3 id="gt-Inpinity-无限"><a href="#gt-Inpinity-无限" class="headerlink" title="&gt; Inpinity/无限 *"></a>&gt; Inpinity/无限 *</h3><p>英文拼写是有意的, 请不要为此提交补丁.<br>(译: 这里是为了突出 Python 中无限的定义与<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Pi">Pi</a>有关, 所以将两个单词拼接了.)</p>
<p><strong>Output (Python 3.x):</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>infinity = <span class="hljs-built_in">float</span>(<span class="hljs-string">&#x27;infinity&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">hash</span>(infinity)<br><span class="hljs-number">314159</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">hash</span>(<span class="hljs-built_in">float</span>(<span class="hljs-string">&#x27;-inf&#x27;</span>))<br>-<span class="hljs-number">314159</span><br></code></pre></td></tr></table></figure></p>
<h4 id="💡-说明-46"><a href="#💡-说明-46" class="headerlink" title="💡 说明:"></a>💡 说明:</h4><ul>
<li>infinity 的哈希值是 10⁵ x π.</li>
<li>有意思的是, <code>float(&#39;-inf&#39;)</code> 的哈希值在 Python 3 中是 “-10⁵ x π”  , 而在 Python 2 中是 “-10⁵ x e”.</li>
</ul>
<hr>
<h3 id="gt-Mangling-time-修饰时间"><a href="#gt-Mangling-time-修饰时间" class="headerlink" title="&gt; Mangling time!/修饰时间! *"></a>&gt; Mangling time!/修饰时间! *</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Yo</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        self.__honey = <span class="hljs-literal">True</span><br>        self.bitch = <span class="hljs-literal">True</span><br></code></pre></td></tr></table></figure>
<p><strong>Output:</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>Yo().bitch<br><span class="hljs-literal">True</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>Yo().__honey<br>AttributeError: <span class="hljs-string">&#x27;Yo&#x27;</span> <span class="hljs-built_in">object</span> has no attribute <span class="hljs-string">&#x27;__honey&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>Yo()._Yo__honey<br><span class="hljs-literal">True</span><br></code></pre></td></tr></table></figure></p>
<p>为什么 <code>Yo()._Yo__honey</code> 能运行? 只有印度人理解.(译: 这个梗可能是指印度音乐人<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Yo_Yo_Honey_Singh">Yo Yo Honey Singh</a>)</p>
<h4 id="💡-说明-47"><a href="#💡-说明-47" class="headerlink" title="💡 说明:"></a>💡 说明:</h4><ul>
<li><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Name_mangling">名字修饰</a> 用于避免不同命名空间之间名称冲突.</li>
<li>在 Python 中, 解释器会通过给类中以 <code>__</code> (双下划线)开头且结尾最多只有一个下划线的类成员名称加上<code>_NameOfTheClass</code> 来修饰(mangles)名称.</li>
<li>所以, 要访问 <code>__honey</code> 对象,我们需要加上 <code>_Yo</code> 以防止与其他类中定义的相同名称的属性发生冲突.</li>
</ul>
<hr>
<hr>
<h2 id="Section-Miscellaneous-杂项"><a href="#Section-Miscellaneous-杂项" class="headerlink" title="Section: Miscellaneous/杂项"></a>Section: Miscellaneous/杂项</h2><h3 id="gt-is-faster-更快的"><a href="#gt-is-faster-更快的" class="headerlink" title="&gt; += is faster/更快的 +="></a>&gt; <code>+=</code> is faster/更快的 <code>+=</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 用 &quot;+&quot; 连接三个字符串:</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>timeit.timeit(<span class="hljs-string">&quot;s1 = s1 + s2 + s3&quot;</span>, setup=<span class="hljs-string">&quot;s1 = &#x27; &#x27; * 100000; s2 = &#x27; &#x27; * 100000; s3 = &#x27; &#x27; * 100000&quot;</span>, number=<span class="hljs-number">100</span>)<br><span class="hljs-number">0.25748300552368164</span><br><span class="hljs-comment"># 用 &quot;+=&quot; 连接三个字符串:</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>timeit.timeit(<span class="hljs-string">&quot;s1 += s2 + s3&quot;</span>, setup=<span class="hljs-string">&quot;s1 = &#x27; &#x27; * 100000; s2 = &#x27; &#x27; * 100000; s3 = &#x27; &#x27; * 100000&quot;</span>, number=<span class="hljs-number">100</span>)<br><span class="hljs-number">0.012188911437988281</span><br></code></pre></td></tr></table></figure>
<h4 id="💡-说明-48"><a href="#💡-说明-48" class="headerlink" title="💡 说明:"></a>💡 说明:</h4><ul>
<li>连接两个以上的字符串时 <code>+=</code> 比 <code>+</code> 更快, 因为在计算过程中第一个字符串 (例如, <code>s1 += s2 + s3</code> 中的 <code>s1</code>) 不会被销毁.(译: 就是 <code>+=</code> 执行的是追加操作，少了一个销毁新建的动作.)</li>
</ul>
<hr>
<h3 id="gt-Let’s-make-a-giant-string-来做个巨大的字符串吧！"><a href="#gt-Let’s-make-a-giant-string-来做个巨大的字符串吧！" class="headerlink" title="&gt; Let’s make a giant string!/来做个巨大的字符串吧！"></a>&gt; Let’s make a giant string!/来做个巨大的字符串吧！</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">add_string_with_plus</span>(<span class="hljs-params">iters</span>):<br>    s = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(iters):<br>        s += <span class="hljs-string">&quot;xyz&quot;</span><br>    <span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(s) == <span class="hljs-number">3</span>*iters<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add_bytes_with_plus</span>(<span class="hljs-params">iters</span>):<br>    s = <span class="hljs-string">b&quot;&quot;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(iters):<br>        s += <span class="hljs-string">b&quot;xyz&quot;</span><br>    <span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(s) == <span class="hljs-number">3</span>*iters<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add_string_with_format</span>(<span class="hljs-params">iters</span>):<br>    fs = <span class="hljs-string">&quot;&#123;&#125;&quot;</span>*iters<br>    s = fs.<span class="hljs-built_in">format</span>(*([<span class="hljs-string">&quot;xyz&quot;</span>]*iters))<br>    <span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(s) == <span class="hljs-number">3</span>*iters<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add_string_with_join</span>(<span class="hljs-params">iters</span>):<br>    l = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(iters):<br>        l.append(<span class="hljs-string">&quot;xyz&quot;</span>)<br>    s = <span class="hljs-string">&quot;&quot;</span>.join(l)<br>    <span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(s) == <span class="hljs-number">3</span>*iters<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">convert_list_to_string</span>(<span class="hljs-params">l, iters</span>):<br>    s = <span class="hljs-string">&quot;&quot;</span>.join(l)<br>    <span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(s) == <span class="hljs-number">3</span>*iters<br></code></pre></td></tr></table></figure>
<p><strong>Output:</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>timeit(add_string_with_plus(<span class="hljs-number">10000</span>))<br><span class="hljs-number">1000</span> loops, best of <span class="hljs-number">3</span>: <span class="hljs-number">972</span> µs per loop<br><span class="hljs-meta">&gt;&gt;&gt; </span>timeit(add_bytes_with_plus(<span class="hljs-number">10000</span>))<br><span class="hljs-number">1000</span> loops, best of <span class="hljs-number">3</span>: <span class="hljs-number">815</span> µs per loop<br><span class="hljs-meta">&gt;&gt;&gt; </span>timeit(add_string_with_format(<span class="hljs-number">10000</span>))<br><span class="hljs-number">1000</span> loops, best of <span class="hljs-number">3</span>: <span class="hljs-number">508</span> µs per loop<br><span class="hljs-meta">&gt;&gt;&gt; </span>timeit(add_string_with_join(<span class="hljs-number">10000</span>))<br><span class="hljs-number">1000</span> loops, best of <span class="hljs-number">3</span>: <span class="hljs-number">878</span> µs per loop<br><span class="hljs-meta">&gt;&gt;&gt; </span>l = [<span class="hljs-string">&quot;xyz&quot;</span>]*<span class="hljs-number">10000</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>timeit(convert_list_to_string(l, <span class="hljs-number">10000</span>))<br><span class="hljs-number">10000</span> loops, best of <span class="hljs-number">3</span>: <span class="hljs-number">80</span> µs per loop<br></code></pre></td></tr></table></figure></p>
<p>让我们将迭代次数增加10倍.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>timeit(add_string_with_plus(<span class="hljs-number">100000</span>)) <span class="hljs-comment"># 执行时间线性增加</span><br><span class="hljs-number">100</span> loops, best of <span class="hljs-number">3</span>: <span class="hljs-number">9.75</span> ms per loop<br><span class="hljs-meta">&gt;&gt;&gt; </span>timeit(add_bytes_with_plus(<span class="hljs-number">100000</span>)) <span class="hljs-comment"># 二次增加</span><br><span class="hljs-number">1000</span> loops, best of <span class="hljs-number">3</span>: <span class="hljs-number">974</span> ms per loop<br><span class="hljs-meta">&gt;&gt;&gt; </span>timeit(add_string_with_format(<span class="hljs-number">100000</span>)) <span class="hljs-comment"># 线性增加</span><br><span class="hljs-number">100</span> loops, best of <span class="hljs-number">3</span>: <span class="hljs-number">5.25</span> ms per loop<br><span class="hljs-meta">&gt;&gt;&gt; </span>timeit(add_string_with_join(<span class="hljs-number">100000</span>)) <span class="hljs-comment"># 线性增加</span><br><span class="hljs-number">100</span> loops, best of <span class="hljs-number">3</span>: <span class="hljs-number">9.85</span> ms per loop<br><span class="hljs-meta">&gt;&gt;&gt; </span>l = [<span class="hljs-string">&quot;xyz&quot;</span>]*<span class="hljs-number">100000</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>timeit(convert_list_to_string(l, <span class="hljs-number">100000</span>)) <span class="hljs-comment"># 线性增加</span><br><span class="hljs-number">1000</span> loops, best of <span class="hljs-number">3</span>: <span class="hljs-number">723</span> µs per loop<br></code></pre></td></tr></table></figure>
<h4 id="💡-说明-49"><a href="#💡-说明-49" class="headerlink" title="💡 说明:"></a>💡 说明:</h4><ul>
<li>你可以在这获得更多 <a target="_blank" rel="noopener" href="https://docs.python.org/3/library/timeit.html">timeit</a> 的相关信息. 它通常用于衡量代码片段的执行时间.</li>
<li>不要用 <code>+</code> 去生成过长的字符串, 在 Python 中, <code>str</code> 是不可变的, 所以在每次连接中你都要把左右两个字符串复制到新的字符串中. 如果你连接四个长度为10的字符串, 你需要拷贝 (10+10) + ((10+10)+10) + (((10+10)+10)+10) = 90 个字符而不是 40 个字符. 随着字符串的数量和大小的增加, 情况会变得越发的糟糕 (就像<code>add_bytes_with_plus</code> 函数的执行时间一样)</li>
<li>因此, 更建议使用 <code>.format.</code> 或 <code>%</code> 语法 (但是, 对于短字符串, 它们比 <code>+</code> 稍慢一点).</li>
<li>又或者, 如果你所需的内容已经以可迭代对象的形式提供了, 使用 <code>&#39;&#39;.join(可迭代对象)</code> 要快多了.</li>
<li><code>add_string_with_plus</code> 的执行时间没有像 <code>add_bytes_with_plus</code> 一样出现二次增加是因为解释器会如同上一个例子所讨论的一样优化 <code>+=</code>. 用 <code>s = s + &quot;x&quot; + &quot;y&quot; + &quot;z&quot;</code> 替代 <code>s += &quot;xyz&quot;</code> 的话, 执行时间就会二次增加了.<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">add_string_with_plus</span>(<span class="hljs-params">iters</span>):<br>    s = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(iters):<br>        s = s + <span class="hljs-string">&quot;x&quot;</span> + <span class="hljs-string">&quot;y&quot;</span> + <span class="hljs-string">&quot;z&quot;</span><br>    <span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(s) == <span class="hljs-number">3</span>*iters<br><br><span class="hljs-meta">&gt;&gt;&gt; </span>timeit(add_string_with_plus(<span class="hljs-number">10000</span>))<br><span class="hljs-number">100</span> loops, best of <span class="hljs-number">3</span>: <span class="hljs-number">9.87</span> ms per loop<br><span class="hljs-meta">&gt;&gt;&gt; </span>timeit(add_string_with_plus(<span class="hljs-number">100000</span>)) <span class="hljs-comment"># 执行时间二次增加</span><br><span class="hljs-number">1</span> loops, best of <span class="hljs-number">3</span>: <span class="hljs-number">1.09</span> s per loop<br></code></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h3 id="gt-Explicit-typecast-of-strings-字符串的显式类型转换"><a href="#gt-Explicit-typecast-of-strings-字符串的显式类型转换" class="headerlink" title="&gt; Explicit typecast of strings/字符串的显式类型转换"></a>&gt; Explicit typecast of strings/字符串的显式类型转换</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">a = <span class="hljs-built_in">float</span>(<span class="hljs-string">&#x27;inf&#x27;</span>)<br>b = <span class="hljs-built_in">float</span>(<span class="hljs-string">&#x27;nan&#x27;</span>)<br>c = <span class="hljs-built_in">float</span>(<span class="hljs-string">&#x27;-iNf&#x27;</span>)  <span class="hljs-comment"># 这些字符串不区分大小写</span><br>d = <span class="hljs-built_in">float</span>(<span class="hljs-string">&#x27;nan&#x27;</span>)<br></code></pre></td></tr></table></figure>
<p><strong>Output:</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>a<br>inf<br><span class="hljs-meta">&gt;&gt;&gt; </span>b<br>nan<br><span class="hljs-meta">&gt;&gt;&gt; </span>c<br>-inf<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">float</span>(<span class="hljs-string">&#x27;some_other_string&#x27;</span>)<br>ValueError: could <span class="hljs-keyword">not</span> convert string to <span class="hljs-built_in">float</span>: some_other_string<br><span class="hljs-meta">&gt;&gt;&gt; </span>a == -c <span class="hljs-comment">#inf==inf</span><br><span class="hljs-literal">True</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-literal">None</span> == <span class="hljs-literal">None</span> <span class="hljs-comment"># None==None</span><br><span class="hljs-literal">True</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>b == d <span class="hljs-comment">#但是 nan!=nan</span><br><span class="hljs-literal">False</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-number">50</span>/a<br><span class="hljs-number">0.0</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>a/a<br>nan<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-number">23</span> + b<br>nan<br></code></pre></td></tr></table></figure></p>
<h4 id="💡-说明-50"><a href="#💡-说明-50" class="headerlink" title="💡 说明:"></a>💡 说明:</h4><p><code>&#39;inf&#39;</code> 和 <code>&#39;nan&#39;</code> 是特殊的字符串(不区分大小写), 当显示转换成 <code>float</code> 型时, 它们分别用于表示数学意义上的 “无穷大” 和 “非数字”.</p>
<hr>
<h3 id="gt-Minor-Ones-小知识点"><a href="#gt-Minor-Ones-小知识点" class="headerlink" title="&gt; Minor Ones/小知识点"></a>&gt; Minor Ones/小知识点</h3><ul>
<li><p><code>join()</code> 是一个字符串操作而不是列表操作. (第一次接触会觉得有点违反直觉)</p>
<p><strong>💡 说明:</strong><br>如果 <code>join()</code> 是字符串方法 那么它就可以处理任何可迭代的对象(列表，元组，迭代器). 如果它是列表方法, 则必须在每种类型中单独实现. 另外, 在 <code>list</code> 对象的通用API中实现一个专用于字符串的方法没有太大的意义.</p>
</li>
<li><p>看着奇怪但能正确运行的语句:</p>
<ul>
<li><code>[] = ()</code> 语句在语义上是正确的 (解包一个空的 <code>tuple</code> 并赋值给 <code>list</code>)</li>
<li><code>&#39;a&#39;[0][0][0][0][0]</code> 在语义上也是正确的, 因为在 Python 中字符串同时也是<a target="_blank" rel="noopener" href="https://docs.python.org/3/glossary.html#term-sequence">序列</a>(可迭代对象支持使用整数索引访问元素).</li>
<li><code>3 --0-- 5 == 8</code> 和 <code>--5 == 5</code> 在语义上都是正确的, 且结果等于 <code>True</code>.(译: 3减负0等于3，再减负5相当于加5等于8；负的负5等于5.)</li>
</ul>
</li>
<li><p>鉴于 <code>a</code> 是一个数字, <code>++a</code> 和 <code>--a</code> 都是有效的 Python 语句, 但其效果与 C, C++ 或 Java 等不一样.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>a = <span class="hljs-number">5</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>a<br><span class="hljs-number">5</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>++a<br><span class="hljs-number">5</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>--a<br><span class="hljs-number">5</span><br></code></pre></td></tr></table></figure>
<p><strong>💡 说明:</strong></p>
<ul>
<li>python 里没有 <code>++</code> 操作符. 这其实是两个 <code>+</code> 操作符.</li>
<li><code>++a</code> 被解析为 <code>+(+a)</code> 最后等于 <code>a</code>. <code>--a</code> 同理.</li>
<li>这个 StackOverflow <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/3654830/why-are-there-no-and-operators-in-python">回答</a> 讨论了为什么 Python 中缺少增量和减量运算符.</li>
</ul>
</li>
<li><p>Python 使用 2个字节存储函数中的本地变量. 理论上, 这意味着函数中只能定义65536个变量. 但是，Python 内置了一个方便的解决方案，可用于存储超过2^16个变量名. 下面的代码演示了当定义了超过65536个局部变量时堆栈中发生的情况 (警告: 这段代码会打印大约2^18行文本, 请做好准备!):</p>
   <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> dis<br><span class="hljs-built_in">exec</span>(<span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">def f():</span><br><span class="hljs-string">    &quot;&quot;&quot;</span> + <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    &quot;&quot;&quot;</span>.join([<span class="hljs-string">&quot;X&quot;</span>+<span class="hljs-built_in">str</span>(x)+<span class="hljs-string">&quot;=&quot;</span> + <span class="hljs-built_in">str</span>(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">65539</span>)]))<br><br>f()<br><br><span class="hljs-built_in">print</span>(dis.dis(f))<br></code></pre></td></tr></table></figure>
</li>
<li><p>你的 <em>Python 代码</em> 并不会多线程同时运行 (是的, 你没听错!). 虽然你觉得会产生多个线程并让它们同时执行你的代码, 但是, 由于 <a target="_blank" rel="noopener" href="https://wiki.python.org/moin/GlobalInterpreterLock">全局解释锁</a>的存在, 你所做的只是让你的线程依次在同一个核心上执行. Python 多线程适用于IO密集型的任务, 但如果想要并行处理CPU密集型的任务, 你应该会想使用 <a target="_blank" rel="noopener" href="https://docs.python.org/2/library/multiprocessing.html">multiprocessing</a> 模块.</p>
</li>
<li><p>列表切片超出索引边界而不引发任何错误</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>some_list = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>some_list[<span class="hljs-number">111</span>:]<br>[]<br></code></pre></td></tr></table></figure>
</li>
<li><p><code>int(&#39;١٢٣٤٥٦٧٨٩&#39;)</code> 在 Python 3 中会返回 <code>123456789</code>. 在 Python 中, 十进制字符包括数字字符, 以及可用于形成十进制数字的所有字符, 例如: U+0660, ARABIC-INDIC DIGIT ZERO. 这有一个关于此的 <a target="_blank" rel="noopener" href="http://chris.improbable.org/2014/8/25/adventures-in-unicode-digits/">有趣故事</a>.</p>
</li>
<li><p><code>&#39;abc&#39;.count(&#39;&#39;) == 4</code>. 这有一个 <code>count</code> 方法的相近实现, 能更好的说明问题</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">count</span>(<span class="hljs-params">s, sub</span>):<br>    result = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(s) + <span class="hljs-number">1</span> - <span class="hljs-built_in">len</span>(sub)):<br>        result += (s[i:i + <span class="hljs-built_in">len</span>(sub)] == sub)<br>    <span class="hljs-keyword">return</span> result<br></code></pre></td></tr></table></figure>
<p>这个行为是由于空子串(<code>&#39;&#39;</code>)与原始字符串中长度为0的切片相匹配导致的.</p>
</li>
</ul>
<hr>
<h1 id="Contributing-贡献"><a href="#Contributing-贡献" class="headerlink" title="Contributing/贡献"></a>Contributing/贡献</h1><p>欢迎各种补丁! 详情请看<a target="_blank" rel="noopener" href="https://github.com/satwikkansal/wtfpython/blob/master/CONTRIBUTING.md">CONTRIBUTING.md</a>.(译: 这是给原库提贡献的要求模版)</p>
<p>你可以通过新建 <a target="_blank" rel="noopener" href="https://github.com/satwikkansal/wtfpython/issues/new">issue</a> 或者在上 <a target="_blank" rel="noopener" href="https://gitter.im/wtfpython/Lobby">Gitter</a> 与我们进行讨论.</p>
<p>(译: 如果你想对这个翻译项目提供帮助, 请看<a target="_blank" rel="noopener" href="https://github.com/leisurelicht/wtfpython-cn/blob/master/CONTRIBUTING.md">这里</a>)</p>
<h1 id="Acknowledgements-致谢"><a href="#Acknowledgements-致谢" class="headerlink" title="Acknowledgements/致谢"></a>Acknowledgements/致谢</h1><p>这个系列最初的想法和设计灵感来自于 Denys Dovhan 的项目 <a target="_blank" rel="noopener" href="https://github.com/denysdovhan/wtfjs">wtfjs</a>. 社区的强大支持让它成长为现在的模样.</p>
<h4 id="Some-nice-Links-一些不错的资源"><a href="#Some-nice-Links-一些不错的资源" class="headerlink" title="Some nice Links!/一些不错的资源"></a>Some nice Links!/一些不错的资源</h4><ul>
<li><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=sH4XF6pKKmk">https://www.youtube.com/watch?v=sH4XF6pKKmk</a></li>
<li><a target="_blank" rel="noopener" href="https://www.reddit.com/r/Python/comments/3cu6ej/what_are_some_wtf_things_about_python">https://www.reddit.com/r/Python/comments/3cu6ej/what_are_some_wtf_things_about_python</a></li>
<li><a target="_blank" rel="noopener" href="https://sopython.com/wiki/Common_Gotchas_In_Python">https://sopython.com/wiki/Common_Gotchas_In_Python</a></li>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/530530/python-2-x-gotchas-and-landmines">https://stackoverflow.com/questions/530530/python-2-x-gotchas-and-landmines</a></li>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/1011431/common-pitfalls-in-python">https://stackoverflow.com/questions/1011431/common-pitfalls-in-python</a></li>
<li><a target="_blank" rel="noopener" href="https://www.python.org/doc/humor/">https://www.python.org/doc/humor/</a></li>
<li><a target="_blank" rel="noopener" href="https://www.codementor.io/satwikkansal/python-practices-for-efficient-code-performance-memory-and-usability-aze6oiq65">https://www.codementor.io/satwikkansal/python-practices-for-efficient-code-performance-memory-and-usability-aze6oiq65</a></li>
</ul>
<h1 id="🎓-License-许可"><a href="#🎓-License-许可" class="headerlink" title="🎓 License/许可"></a>🎓 License/许可</h1><p><a target="_blank" rel="noopener" href="http://www.wtfpl.net"><img src="https://img.shields.io/badge/License-WTFPL%202.0-lightgrey.svg?style=flat-square" alt="CC 4.0"></a></p>
<p>&copy; <a target="_blank" rel="noopener" href="https://satwikkansal.xyz">Satwik Kansal</a></p>
<h2 id="Help-帮助"><a href="#Help-帮助" class="headerlink" title="Help/帮助"></a>Help/帮助</h2><p>如果您有任何想法或建议，欢迎分享.</p>
<h2 id="Surprise-your-geeky-pythonist-friends-想给你的极客朋友一个惊喜"><a href="#Surprise-your-geeky-pythonist-friends-想给你的极客朋友一个惊喜" class="headerlink" title="Surprise your geeky pythonist friends?/想给你的极客朋友一个惊喜?"></a>Surprise your geeky pythonist friends?/想给你的极客朋友一个惊喜?</h2><p>您可以使用这些快链向 Twitter 和 Linkedin 上的朋友推荐 wtfpython,</p>
<p><a target="_blank" rel="noopener" href="https://twitter.com/intent/tweet?url=https://github.com/satwikkansal/wtfpython&amp;hastags=python,wtfpython">Twitter</a><br> | <a target="_blank" rel="noopener" href="https://www.linkedin.com/shareArticle?url=https://github.com/satwikkansal&amp;title=What%20the%20f*ck%20Python!&amp;summary=An%20interesting%20collection%20of%20subtle%20and%20tricky%20Python%20snippets.">Linkedin</a></p>
<h2 id="Need-a-pdf-version-需要来一份pdf版的"><a href="#Need-a-pdf-version-需要来一份pdf版的" class="headerlink" title="Need a pdf version?/需要来一份pdf版的?"></a>Need a pdf version?/需要来一份pdf版的?</h2><p>我收到一些想要pdf版本的需求. 你可以快速在<a target="_blank" rel="noopener" href="https://satwikkansal.xyz/wtfpython-pdf/">这</a>获得.</p>
<h2 id="Follow-Commit-追踪Commit"><a href="#Follow-Commit-追踪Commit" class="headerlink" title="Follow Commit/追踪Commit"></a>Follow Commit/追踪Commit</h2><p>这是中文版 fork 时所处的原库 Commit, 当原库更新时我会跟随更新.</p>
<p><a target="_blank" rel="noopener" href="https://github.com/satwikkansal/wtfpython/commit/30e05a5973930c38cdb59f1c02b85b19b22ac531"><img src="https://img.shields.io/badge/Commit-30e05a-yellow.svg" alt="Commit id"></a></p>
<h2 id="996-icu"><a href="#996-icu" class="headerlink" title="996.icu"></a>996.icu</h2><p><a target="_blank" rel="noopener" href="https://996.icu"><img src="https://img.shields.io/badge/link-996.icu-red.svg" alt="996.icu"></a></p>
</div><div class="article-licensing box"><div class="licensing-title"><p>（转）What the Fuck Python！ 一些python特性</p><p><a href="http://aikenh.cn/cn/PythonTips/">http://aikenh.cn/cn/PythonTips/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>AikenH</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2021-11-28</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2023-10-30</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><hr style="height:1px;margin:1rem 0"><div class="level is-mobile is-flex"><div class="article-tags is-size-7 is-uppercase"><i class="fas fa-tags has-text-grey"></i> <a class="link-muted" rel="tag" href="/tags/Python/">Python, </a><a class="link-muted" rel="tag" href="/tags/Langs/">Langs </a></div></div><!--!--></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">Like this article? Support the author with</h3><div class="buttons is-centered"><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>Alipay</span><span class="qrcode"><img src="/img/alipay.jpg" alt="Alipay"></span></a><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>Wechat</span><span class="qrcode"><img src="/img/wechat.jpg" alt="Wechat"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/cn/CPP%E8%A6%81%E7%82%B9%E8%BE%A8%E6%9E%90%E4%B8%8E%E8%A1%A5%E5%85%85/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">C++的常见数据类型和操作</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/cn/Linux/"><span class="level-item">Linux 基础操作 01</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_config = function () {
            this.page.url = 'http://aikenh.cn/cn/PythonTips/';
            this.page.identifier = 'cn/PythonTips/';
        };
        (function() {
            var d = document, s = d.createElement('script');  
            s.src = '//' + 'my-tech-blog-3' + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/title.jpg" alt="AikenH"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">AikenH</p><p class="is-size-6 is-block">Future Full-Stack Developer</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>ShenZhen</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">134</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">42</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">100</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/AikenH" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="ZhiHu" href="https://www.zhihu.com/people/Aiken-h"><i class="fab fa-zhihu"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Weibo" href="https://weibo.com/u/1788200627"><i class="fab fa-weibo"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Steam" href="https://steamcommunity.com/id/AikenH/"><i class="fab fa-steam"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/AikenH"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/atom.xml"><i class="fas fa-rss"></i></a></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">1</span><span class="level-item">What the f*ck Python! 🐍</span></span></a></li><li><a class="level is-mobile" href="#Table-of-Contents-目录"><span class="level-left"><span class="level-item">2</span><span class="level-item">Table of Contents/目录</span></span></a></li><li><a class="level is-mobile" href="#Structure-of-the-Examples-示例结构"><span class="level-left"><span class="level-item">3</span><span class="level-item">Structure of the Examples/示例结构</span></span></a><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#gt-一个精选的标题"><span class="level-left"><span class="level-item">3.1.1</span><span class="level-item">&gt; 一个精选的标题 *</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明"><span class="level-left"><span class="level-item">3.1.1.1</span><span class="level-item">💡 说明:</span></span></a></li></ul></li></ul></ul></li><li><a class="level is-mobile" href="#Usage-用法"><span class="level-left"><span class="level-item">4</span><span class="level-item">Usage/用法</span></span></a></li><li><a class="level is-mobile" href="#👀-Examples-示例"><span class="level-left"><span class="level-item">5</span><span class="level-item">👀 Examples/示例</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Section-Strain-your-brain-大脑运动"><span class="level-left"><span class="level-item">5.1</span><span class="level-item">Section: Strain your brain!/大脑运动!</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#gt-Strings-can-be-tricky-sometimes-微妙的字符串"><span class="level-left"><span class="level-item">5.1.1</span><span class="level-item">&gt; Strings can be tricky sometimes/微妙的字符串 *</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明-1"><span class="level-left"><span class="level-item">5.1.1.1</span><span class="level-item">💡 说明:</span></span></a></li></ul></li><li><a class="level is-mobile" href="#gt-Time-for-some-hash-brownies-是时候来点蛋糕了"><span class="level-left"><span class="level-item">5.1.2</span><span class="level-item">&gt; Time for some hash brownies!/是时候来点蛋糕了!</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明-2"><span class="level-left"><span class="level-item">5.1.2.1</span><span class="level-item">💡 说明:</span></span></a></li></ul></li><li><a class="level is-mobile" href="#gt-Return-return-everywhere-到处返回！"><span class="level-left"><span class="level-item">5.1.3</span><span class="level-item">&gt; Return return everywhere!/到处返回！</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明-3"><span class="level-left"><span class="level-item">5.1.3.1</span><span class="level-item">💡 说明:</span></span></a></li></ul></li><li><a class="level is-mobile" href="#gt-Deep-down-we’re-all-the-same-本质上-我们都一样"><span class="level-left"><span class="level-item">5.1.4</span><span class="level-item">&gt; Deep down, we’re all the same./本质上,我们都一样. *</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明-4"><span class="level-left"><span class="level-item">5.1.4.1</span><span class="level-item">💡 说明:</span></span></a></li></ul></li><li><a class="level is-mobile" href="#gt-For-what-为什么"><span class="level-left"><span class="level-item">5.1.5</span><span class="level-item">&gt; For what?/为什么?</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明-5"><span class="level-left"><span class="level-item">5.1.5.1</span><span class="level-item">💡 说明:</span></span></a></li></ul></li><li><a class="level is-mobile" href="#gt-Evaluation-time-discrepancy-执行时机差异"><span class="level-left"><span class="level-item">5.1.6</span><span class="level-item">&gt; Evaluation time discrepancy/执行时机差异</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明-6"><span class="level-left"><span class="level-item">5.1.6.1</span><span class="level-item">💡 说明</span></span></a></li></ul></li><li><a class="level is-mobile" href="#gt-is-is-not-what-it-is-出人意料的is"><span class="level-left"><span class="level-item">5.1.7</span><span class="level-item">&gt; is is not what it is!/出人意料的is!</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明-7"><span class="level-left"><span class="level-item">5.1.7.1</span><span class="level-item">💡 说明:</span></span></a></li></ul></li><li><a class="level is-mobile" href="#gt-A-tic-tac-toe-where-X-wins-in-the-first-attempt-一蹴即至"><span class="level-left"><span class="level-item">5.1.8</span><span class="level-item">&gt; A tic-tac-toe where X wins in the first attempt!/一蹴即至!</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明-8"><span class="level-left"><span class="level-item">5.1.8.1</span><span class="level-item">💡 说明:</span></span></a></li></ul></li><li><a class="level is-mobile" href="#gt-The-sticky-output-function-麻烦的输出"><span class="level-left"><span class="level-item">5.1.9</span><span class="level-item">&gt; The sticky output function/麻烦的输出</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明-9"><span class="level-left"><span class="level-item">5.1.9.1</span><span class="level-item">💡 说明:</span></span></a></li></ul></li><li><a class="level is-mobile" href="#gt-is-not-is-not-is-not-is-not-不是-is-not"><span class="level-left"><span class="level-item">5.1.10</span><span class="level-item">&gt; is not ... is not is (not ...)/is not ... 不是 is (not ...)</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明-10"><span class="level-left"><span class="level-item">5.1.10.1</span><span class="level-item">💡 说明:</span></span></a></li></ul></li><li><a class="level is-mobile" href="#gt-The-surprising-comma-意外的逗号"><span class="level-left"><span class="level-item">5.1.11</span><span class="level-item">&gt; The surprising comma/意外的逗号</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明-11"><span class="level-left"><span class="level-item">5.1.11.1</span><span class="level-item">💡 说明:</span></span></a></li></ul></li><li><a class="level is-mobile" href="#gt-Backslashes-at-the-end-of-string-字符串末尾的反斜杠"><span class="level-left"><span class="level-item">5.1.12</span><span class="level-item">&gt; Backslashes at the end of string/字符串末尾的反斜杠</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明-12"><span class="level-left"><span class="level-item">5.1.12.1</span><span class="level-item">💡 说明:</span></span></a></li></ul></li><li><a class="level is-mobile" href="#gt-not-knot-别纠结"><span class="level-left"><span class="level-item">5.1.13</span><span class="level-item">&gt; not knot!/别纠结!</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明-13"><span class="level-left"><span class="level-item">5.1.13.1</span><span class="level-item">💡 说明:</span></span></a></li></ul></li><li><a class="level is-mobile" href="#gt-Half-triple-quoted-strings-三个引号"><span class="level-left"><span class="level-item">5.1.14</span><span class="level-item">&gt; Half triple-quoted strings/三个引号</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明-14"><span class="level-left"><span class="level-item">5.1.14.1</span><span class="level-item">💡 说明:</span></span></a></li></ul></li><li><a class="level is-mobile" href="#gt-Midnight-time-doesn’t-exist-不存在的午夜"><span class="level-left"><span class="level-item">5.1.15</span><span class="level-item">&gt; Midnight time doesn’t exist?/不存在的午夜?</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明-15"><span class="level-left"><span class="level-item">5.1.15.1</span><span class="level-item">💡 说明:</span></span></a></li></ul></li><li><a class="level is-mobile" href="#gt-What’s-wrong-with-booleans-布尔你咋了"><span class="level-left"><span class="level-item">5.1.16</span><span class="level-item">&gt; What’s wrong with booleans?/布尔你咋了?</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明-16"><span class="level-left"><span class="level-item">5.1.16.1</span><span class="level-item">💡 说明:</span></span></a></li></ul></li><li><a class="level is-mobile" href="#gt-Class-attributes-and-instance-attributes-类属性和实例属性"><span class="level-left"><span class="level-item">5.1.17</span><span class="level-item">&gt; Class attributes and instance attributes/类属性和实例属性</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明-17"><span class="level-left"><span class="level-item">5.1.17.1</span><span class="level-item">💡 说明:</span></span></a></li></ul></li><li><a class="level is-mobile" href="#gt-yielding-None-生成-None"><span class="level-left"><span class="level-item">5.1.18</span><span class="level-item">&gt; yielding None/生成 None</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明-18"><span class="level-left"><span class="level-item">5.1.18.1</span><span class="level-item">💡 说明:</span></span></a></li></ul></li><li><a class="level is-mobile" href="#gt-Mutating-the-immutable-强人所难"><span class="level-left"><span class="level-item">5.1.19</span><span class="level-item">&gt; Mutating the immutable!/强人所难</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明-19"><span class="level-left"><span class="level-item">5.1.19.1</span><span class="level-item">💡 说明:</span></span></a></li></ul></li><li><a class="level is-mobile" href="#gt-The-disappearing-variable-from-outer-scope-消失的外部变量"><span class="level-left"><span class="level-item">5.1.20</span><span class="level-item">&gt; The disappearing variable from outer scope/消失的外部变量</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明-20"><span class="level-left"><span class="level-item">5.1.20.1</span><span class="level-item">💡 说明:</span></span></a></li></ul></li><li><a class="level is-mobile" href="#gt-When-True-is-actually-False-真亦假"><span class="level-left"><span class="level-item">5.1.21</span><span class="level-item">&gt; When True is actually False/真亦假</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明-21"><span class="level-left"><span class="level-item">5.1.21.1</span><span class="level-item">💡 说明:</span></span></a></li></ul></li><li><a class="level is-mobile" href="#gt-From-filled-to-None-in-one-instruction…-从有到无…"><span class="level-left"><span class="level-item">5.1.22</span><span class="level-item">&gt; From filled to None in one instruction…/从有到无…</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明-22"><span class="level-left"><span class="level-item">5.1.22.1</span><span class="level-item">💡 说明:</span></span></a></li></ul></li><li><a class="level is-mobile" href="#gt-Subclass-relationships-子类关系"><span class="level-left"><span class="level-item">5.1.23</span><span class="level-item">&gt; Subclass relationships/子类关系 *</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明-23"><span class="level-left"><span class="level-item">5.1.23.1</span><span class="level-item">💡 说明:</span></span></a></li></ul></li><li><a class="level is-mobile" href="#gt-The-mysterious-key-type-conversion-神秘的键型转换"><span class="level-left"><span class="level-item">5.1.24</span><span class="level-item">&gt; The mysterious key type conversion/神秘的键型转换 *</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明-24"><span class="level-left"><span class="level-item">5.1.24.1</span><span class="level-item">💡 说明:</span></span></a></li></ul></li><li><a class="level is-mobile" href="#gt-Let’s-see-if-you-can-guess-this-看看你能否猜到这一点"><span class="level-left"><span class="level-item">5.1.25</span><span class="level-item">&gt; Let’s see if you can guess this?/看看你能否猜到这一点?</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明-25"><span class="level-left"><span class="level-item">5.1.25.1</span><span class="level-item">💡 说明:</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#Section-Appearances-are-deceptive-外表是靠不住的"><span class="level-left"><span class="level-item">5.2</span><span class="level-item">Section: Appearances are deceptive!/外表是靠不住的!</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#gt-Skipping-lines-跳过一行"><span class="level-left"><span class="level-item">5.2.1</span><span class="level-item">&gt; Skipping lines?/跳过一行?</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明-26"><span class="level-left"><span class="level-item">5.2.1.1</span><span class="level-item">💡 说明:</span></span></a></li></ul></li><li><a class="level is-mobile" href="#gt-Teleportation-空间移动"><span class="level-left"><span class="level-item">5.2.2</span><span class="level-item">&gt; Teleportation/空间移动 *</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明-27"><span class="level-left"><span class="level-item">5.2.2.1</span><span class="level-item">💡 说明:</span></span></a></li></ul></li><li><a class="level is-mobile" href="#gt-Well-something-is-fishy…-嗯，有些可疑…"><span class="level-left"><span class="level-item">5.2.3</span><span class="level-item">&gt; Well, something is fishy…/嗯，有些可疑…</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明-28"><span class="level-left"><span class="level-item">5.2.3.1</span><span class="level-item">💡 说明:</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#Section-Watch-out-for-the-landmines-小心地雷"><span class="level-left"><span class="level-item">5.3</span><span class="level-item">Section: Watch out for the landmines!/小心地雷!</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#gt-Modifying-a-dictionary-while-iterating-over-it-迭代字典时的修改"><span class="level-left"><span class="level-item">5.3.1</span><span class="level-item">&gt; Modifying a dictionary while iterating over it/迭代字典时的修改</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明-29"><span class="level-left"><span class="level-item">5.3.1.1</span><span class="level-item">💡 说明:</span></span></a></li></ul></li><li><a class="level is-mobile" href="#gt-Stubborn-del-operator-坚强的-del"><span class="level-left"><span class="level-item">5.3.2</span><span class="level-item">&gt; Stubborn del operator/坚强的 del *</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明-30"><span class="level-left"><span class="level-item">5.3.2.1</span><span class="level-item">💡 说明:</span></span></a></li></ul></li><li><a class="level is-mobile" href="#gt-Deleting-a-list-item-while-iterating-迭代列表时删除元素"><span class="level-left"><span class="level-item">5.3.3</span><span class="level-item">&gt; Deleting a list item while iterating/迭代列表时删除元素</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明-31"><span class="level-left"><span class="level-item">5.3.3.1</span><span class="level-item">💡 说明:</span></span></a></li></ul></li><li><a class="level is-mobile" href="#gt-Loop-variables-leaking-out-循环变量泄漏"><span class="level-left"><span class="level-item">5.3.4</span><span class="level-item">&gt; Loop variables leaking out!/循环变量泄漏!</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明-32"><span class="level-left"><span class="level-item">5.3.4.1</span><span class="level-item">💡 说明:</span></span></a></li></ul></li><li><a class="level is-mobile" href="#gt-Beware-of-default-mutable-arguments-当心默认的可变参数"><span class="level-left"><span class="level-item">5.3.5</span><span class="level-item">&gt; Beware of default mutable arguments!/当心默认的可变参数!</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明-33"><span class="level-left"><span class="level-item">5.3.5.1</span><span class="level-item">💡 说明:</span></span></a></li></ul></li><li><a class="level is-mobile" href="#gt-Catching-the-Exceptions-捕获异常"><span class="level-left"><span class="level-item">5.3.6</span><span class="level-item">&gt; Catching the Exceptions/捕获异常</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明-34"><span class="level-left"><span class="level-item">5.3.6.1</span><span class="level-item">💡 说明:</span></span></a></li></ul></li><li><a class="level is-mobile" href="#gt-Same-operands-different-story-同人不同命"><span class="level-left"><span class="level-item">5.3.7</span><span class="level-item">&gt; Same operands, different story!/同人不同命!</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明-35"><span class="level-left"><span class="level-item">5.3.7.1</span><span class="level-item">💡 说明:</span></span></a></li></ul></li><li><a class="level is-mobile" href="#gt-The-out-of-scope-variable-外部作用域变量"><span class="level-left"><span class="level-item">5.3.8</span><span class="level-item">&gt; The out of scope variable/外部作用域变量</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明-36"><span class="level-left"><span class="level-item">5.3.8.1</span><span class="level-item">💡 说明:</span></span></a></li></ul></li><li><a class="level is-mobile" href="#gt-Be-careful-with-chained-operations-小心链式操作"><span class="level-left"><span class="level-item">5.3.9</span><span class="level-item">&gt; Be careful with chained operations/小心链式操作</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明-37"><span class="level-left"><span class="level-item">5.3.9.1</span><span class="level-item">💡 说明:</span></span></a></li></ul></li><li><a class="level is-mobile" href="#gt-Name-resolution-ignoring-class-scope-忽略类作用域的名称解析"><span class="level-left"><span class="level-item">5.3.10</span><span class="level-item">&gt; Name resolution ignoring class scope/忽略类作用域的名称解析</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明-38"><span class="level-left"><span class="level-item">5.3.10.1</span><span class="level-item">💡 说明:</span></span></a></li></ul></li><li><a class="level is-mobile" href="#gt-Needle-in-a-Haystack-大海捞针"><span class="level-left"><span class="level-item">5.3.11</span><span class="level-item">&gt; Needle in a Haystack/大海捞针</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明-39"><span class="level-left"><span class="level-item">5.3.11.1</span><span class="level-item">💡 说明:</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#Section-The-Hidden-treasures-隐藏的宝藏"><span class="level-left"><span class="level-item">5.4</span><span class="level-item">Section: The Hidden treasures!/隐藏的宝藏!</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#gt-Okay-Python-Can-you-make-me-fly-Python-可否带我飞"><span class="level-left"><span class="level-item">5.4.1</span><span class="level-item">&gt; Okay Python, Can you make me fly?/Python, 可否带我飞? *</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明-40"><span class="level-left"><span class="level-item">5.4.1.1</span><span class="level-item">💡 说明:</span></span></a></li></ul></li><li><a class="level is-mobile" href="#gt-goto-but-why-goto-但为什么"><span class="level-left"><span class="level-item">5.4.2</span><span class="level-item">&gt; goto, but why?/goto, 但为什么? *</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明-41"><span class="level-left"><span class="level-item">5.4.2.1</span><span class="level-item">💡 说明:</span></span></a></li></ul></li><li><a class="level is-mobile" href="#gt-Brace-yourself-做好思想准备"><span class="level-left"><span class="level-item">5.4.3</span><span class="level-item">&gt; Brace yourself!/做好思想准备 *</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明-42"><span class="level-left"><span class="level-item">5.4.3.1</span><span class="level-item">💡 说明:</span></span></a></li></ul></li><li><a class="level is-mobile" href="#gt-Let’s-meet-Friendly-Language-Uncle-For-Life-让生活更友好"><span class="level-left"><span class="level-item">5.4.4</span><span class="level-item">&gt; Let’s meet Friendly Language Uncle For Life/让生活更友好 *</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明-43"><span class="level-left"><span class="level-item">5.4.4.1</span><span class="level-item">💡 说明:</span></span></a></li></ul></li><li><a class="level is-mobile" href="#gt-Even-Python-understands-that-love-is-complicated-连Python也知道爱是难言的"><span class="level-left"><span class="level-item">5.4.5</span><span class="level-item">&gt; Even Python understands that love is complicated/连Python也知道爱是难言的 *</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明-44"><span class="level-left"><span class="level-item">5.4.5.1</span><span class="level-item">💡 说明:</span></span></a></li></ul></li><li><a class="level is-mobile" href="#gt-Yes-it-exists-是的-它存在"><span class="level-left"><span class="level-item">5.4.6</span><span class="level-item">&gt; Yes, it exists!/是的, 它存在!</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明-45"><span class="level-left"><span class="level-item">5.4.6.1</span><span class="level-item">💡 说明:</span></span></a></li></ul></li><li><a class="level is-mobile" href="#gt-Inpinity-无限"><span class="level-left"><span class="level-item">5.4.7</span><span class="level-item">&gt; Inpinity/无限 *</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明-46"><span class="level-left"><span class="level-item">5.4.7.1</span><span class="level-item">💡 说明:</span></span></a></li></ul></li><li><a class="level is-mobile" href="#gt-Mangling-time-修饰时间"><span class="level-left"><span class="level-item">5.4.8</span><span class="level-item">&gt; Mangling time!/修饰时间! *</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明-47"><span class="level-left"><span class="level-item">5.4.8.1</span><span class="level-item">💡 说明:</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#Section-Miscellaneous-杂项"><span class="level-left"><span class="level-item">5.5</span><span class="level-item">Section: Miscellaneous/杂项</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#gt-is-faster-更快的"><span class="level-left"><span class="level-item">5.5.1</span><span class="level-item">&gt; += is faster/更快的 +=</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明-48"><span class="level-left"><span class="level-item">5.5.1.1</span><span class="level-item">💡 说明:</span></span></a></li></ul></li><li><a class="level is-mobile" href="#gt-Let’s-make-a-giant-string-来做个巨大的字符串吧！"><span class="level-left"><span class="level-item">5.5.2</span><span class="level-item">&gt; Let’s make a giant string!/来做个巨大的字符串吧！</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明-49"><span class="level-left"><span class="level-item">5.5.2.1</span><span class="level-item">💡 说明:</span></span></a></li></ul></li><li><a class="level is-mobile" href="#gt-Explicit-typecast-of-strings-字符串的显式类型转换"><span class="level-left"><span class="level-item">5.5.3</span><span class="level-item">&gt; Explicit typecast of strings/字符串的显式类型转换</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#💡-说明-50"><span class="level-left"><span class="level-item">5.5.3.1</span><span class="level-item">💡 说明:</span></span></a></li></ul></li><li><a class="level is-mobile" href="#gt-Minor-Ones-小知识点"><span class="level-left"><span class="level-item">5.5.4</span><span class="level-item">&gt; Minor Ones/小知识点</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#Contributing-贡献"><span class="level-left"><span class="level-item">6</span><span class="level-item">Contributing/贡献</span></span></a></li><li><a class="level is-mobile" href="#Acknowledgements-致谢"><span class="level-left"><span class="level-item">7</span><span class="level-item">Acknowledgements/致谢</span></span></a><ul class="menu-list"><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#Some-nice-Links-一些不错的资源"><span class="level-left"><span class="level-item">7.1.1.1</span><span class="level-item">Some nice Links!/一些不错的资源</span></span></a></li></ul></ul></ul></li><li><a class="level is-mobile" href="#🎓-License-许可"><span class="level-left"><span class="level-item">8</span><span class="level-item">🎓 License/许可</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Help-帮助"><span class="level-left"><span class="level-item">8.1</span><span class="level-item">Help/帮助</span></span></a></li><li><a class="level is-mobile" href="#Surprise-your-geeky-pythonist-friends-想给你的极客朋友一个惊喜"><span class="level-left"><span class="level-item">8.2</span><span class="level-item">Surprise your geeky pythonist friends?/想给你的极客朋友一个惊喜?</span></span></a></li><li><a class="level is-mobile" href="#Need-a-pdf-version-需要来一份pdf版的"><span class="level-left"><span class="level-item">8.3</span><span class="level-item">Need a pdf version?/需要来一份pdf版的?</span></span></a></li><li><a class="level is-mobile" href="#Follow-Commit-追踪Commit"><span class="level-left"><span class="level-item">8.4</span><span class="level-item">Follow Commit/追踪Commit</span></span></a></li><li><a class="level is-mobile" href="#996-icu"><span class="level-left"><span class="level-item">8.5</span><span class="level-item">996.icu</span></span></a></li></ul></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><figure class="media-left"><a class="image" href="/cn/%E6%A0%91%E8%8E%93%E6%B4%BE%E5%AE%B6%E5%BA%AD%E5%BD%B1%E9%9F%B3%E4%B8%AD%E5%BF%832/"><img src="/img/header_img/lml_bg1.jpg" alt="树莓派家庭影音中心2"></a></figure><div class="media-content"><p class="date"><time dateTime="2023-11-11T04:08:37.000Z">2023-11-11</time></p><p class="title"><a href="/cn/%E6%A0%91%E8%8E%93%E6%B4%BE%E5%AE%B6%E5%BA%AD%E5%BD%B1%E9%9F%B3%E4%B8%AD%E5%BF%832/">树莓派家庭影音中心2</a></p><p class="categories"><a href="/categories/Dev/">Dev</a> / <a href="/categories/Dev/Raspberry-pie/">Raspberry-pie</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/cn/emby_localhost_crack_by_nginx/"><img src="/img/header_img/lml_bg2.jpg" alt="破解本地自托管Emby服务"></a></figure><div class="media-content"><p class="date"><time dateTime="2023-11-10T06:05:15.000Z">2023-11-10</time></p><p class="title"><a href="/cn/emby_localhost_crack_by_nginx/">破解本地自托管Emby服务</a></p><p class="categories"><a href="/categories/NAS/">NAS</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/cn/deploy_server_byipv6_03_ddnsgo/"><img src="/img/header_img/lml_bg12.jpg" alt="使用Ipv6部署服务03 DDNS-go 动态域名解析"></a></figure><div class="media-content"><p class="date"><time dateTime="2023-11-07T05:40:13.000Z">2023-11-07</time></p><p class="title"><a href="/cn/deploy_server_byipv6_03_ddnsgo/">使用Ipv6部署服务03 DDNS-go 动态域名解析</a></p><p class="categories"><a href="/categories/NAS/">NAS</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/cn/deploy_server_byipv6_02_nginx/"><img src="/img/header_img/lml_bg14.jpg" alt="使用Ipv6部署服务02 Nginx和Https"></a></figure><div class="media-content"><p class="date"><time dateTime="2023-11-06T12:49:16.000Z">2023-11-06</time></p><p class="title"><a href="/cn/deploy_server_byipv6_02_nginx/">使用Ipv6部署服务02 Nginx和Https</a></p><p class="categories"><a href="/categories/NAS/">NAS</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/cn/Windows%E7%AB%AF%E5%8F%A3%E5%BC%82%E5%B8%B8%E5%8D%A0%E7%94%A8/"><img src="/img/header_img/lml_bg9.jpg" alt="Windows端口异常占用"></a></figure><div class="media-content"><p class="date"><time dateTime="2023-11-05T15:46:54.000Z">2023-11-05</time></p><p class="title"><a href="/cn/Windows%E7%AB%AF%E5%8F%A3%E5%BC%82%E5%B8%B8%E5%8D%A0%E7%94%A8/">Windows端口异常占用</a></p><p class="categories"><a href="/categories/Windows/">Windows</a></p></div></article></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">Aiken&#039;s Blog</a><p class="is-size-7"><span>&copy; 2023 AikenH</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_pv">Visited by <span id="busuanzi_value_site_uv">0</span> users</span> and <span id="busuanzi_container2_site_uv"><span id="busuanzi_value_site_pv">0</span>&nbsp;visits</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.9/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><script src="/js/night.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>