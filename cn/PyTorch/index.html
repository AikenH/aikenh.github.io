<!doctype html>
<html lang="cn"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>PyTorch Handbook 00 ï¼ˆArchiveï¼‰ - AikenH Blogs</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Aiken Hong"><meta name="msapplication-TileImage" content="/img/pokemon.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Aiken Hong"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="Basic PartåŸºç¡€è®¾å®šéƒ¨åˆ†@AikenH 2020 + 2021 this part is about pytorch basic unit, help me to code deep learning better. Tensorå¼ é‡è®¡ç®—ä¸¤ä¸ªtensorçš„æ•°ä¹˜"><meta property="og:type" content="blog"><meta property="og:title" content="PyTorch Handbook 00 ï¼ˆArchiveï¼‰"><meta property="og:url" content="http://aikenh.cn/cn/PyTorch/"><meta property="og:site_name" content="AikenH Blogs"><meta property="og:description" content="Basic PartåŸºç¡€è®¾å®šéƒ¨åˆ†@AikenH 2020 + 2021 this part is about pytorch basic unit, help me to code deep learning better. Tensorå¼ é‡è®¡ç®—ä¸¤ä¸ªtensorçš„æ•°ä¹˜"><meta property="og:locale" content="cn"><meta property="og:image" content="http://aikenh.cn/img/header_img/lml_bg31.jpg"><meta property="article:published_time" content="2021-12-15T00:00:57.000Z"><meta property="article:modified_time" content="2023-10-30T09:27:38.000Z"><meta property="article:author" content="AikenH"><meta property="article:tag" content="Python"><meta property="article:tag" content="Pytorch"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://aikenh.cn/img/header_img/lml_bg31.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://aikenh.cn/cn/PyTorch/"},"headline":"PyTorch Handbook 00 ï¼ˆArchiveï¼‰","image":["http://aikenh.cn/img/header_img/lml_bg31.jpg"],"datePublished":"2021-12-15T00:00:57.000Z","dateModified":"2023-10-30T09:27:38.000Z","author":{"@type":"Person","name":"AikenH"},"publisher":{"@type":"Organization","name":"AikenH Blogs","logo":{"@type":"ImageObject","url":{"text":"Aiken's Blog"}}},"description":"Basic PartåŸºç¡€è®¾å®šéƒ¨åˆ†@AikenH 2020 + 2021 this part is about pytorch basic unit, help me to code deep learning better. Tensorå¼ é‡è®¡ç®—ä¸¤ä¸ªtensorçš„æ•°ä¹˜"}</script><link rel="canonical" href="http://aikenh.cn/cn/PyTorch/"><link rel="icon" href="/img/pokemon.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-dark.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css" title="default"><link rel="alternate stylesheet" href="/css/cyberpunk.css" title="cyberpunk"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="AikenH Blogs" type="application/atom+xml">
</head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">Aiken&#039;s Blog</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/AikenH"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a><a class="navbar-item night" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-lightbulb" id="night-icon"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-9-widescreen"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="/img/header_img/lml_bg31.jpg" alt="PyTorch Handbook 00 ï¼ˆArchiveï¼‰"></span></div><article class="card-content article" role="article"><h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal"><i class="fas fa-angle-double-right"></i>PyTorch Handbook 00 ï¼ˆArchiveï¼‰</h1><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><i class="far fa-calendar-alt">Â </i><time dateTime="2021-12-15T00:00:57.000Z" title="2021-12-15T00:00:57.000Z">2021-12-15</time></span><span class="level-item">Updated&nbsp;<time dateTime="2023-10-30T09:27:38.000Z" title="2023/10/30 17:27:38">2023-10-30</time></span><span class="level-item"><a class="link-muted" href="/categories/Langs/">Langs</a><span>Â /Â </span><a class="link-muted" href="/categories/Langs/Pytorch/">Pytorch</a></span><span class="level-item">an hour read (About 9491 words)</span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>&nbsp;visits</span></div></div><div class="content"><h1 id="Basic-PartåŸºç¡€è®¾å®šéƒ¨åˆ†"><a href="#Basic-PartåŸºç¡€è®¾å®šéƒ¨åˆ†" class="headerlink" title="Basic PartåŸºç¡€è®¾å®šéƒ¨åˆ†"></a>Basic PartåŸºç¡€è®¾å®šéƒ¨åˆ†</h1><p>@AikenH 2020 + 2021</p>
<p>this part is about pytorch basic unit, help me to code deep learning better.</p>
<h2 id="Tensorå¼ é‡è®¡ç®—"><a href="#Tensorå¼ é‡è®¡ç®—" class="headerlink" title="Tensorå¼ é‡è®¡ç®—"></a>Tensorå¼ é‡è®¡ç®—</h2><h3 id="ä¸¤ä¸ªtensorçš„æ•°ä¹˜"><a href="#ä¸¤ä¸ªtensorçš„æ•°ä¹˜" class="headerlink" title="ä¸¤ä¸ªtensorçš„æ•°ä¹˜"></a>ä¸¤ä¸ªtensorçš„æ•°ä¹˜</h3><span id="more"></span>
<p>è®¡ç®—ä¸¤ä¸ªtensorçš„çŸ©é˜µä¹˜æ³•ï¼Œæ³¨æ„å…¶ä¸­çš„batchè¦ç›¸äº’å¯¹åº”ï¼Œå¦‚æœä¸è€ƒè™‘batchï¼Œå°±æ˜¯å¦ä¸€ä¸ªå‡½æ•°</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ç®€å•çš„åˆ†æä¸€ä¸‹ç®—æ³•çš„é€»è¾‘</span><br><span class="hljs-comment"># è¿™æ˜¯å‰²è£‚å‡ºæ¥batchçš„çŸ©é˜µç›¸ä¹˜å½¢å¼</span><br>batch1 = torch.randn(<span class="hljs-number">10</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>)<br>batch2 = torch.randn(<span class="hljs-number">10</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>)<br>out = torch.bmm(batch1, batch2)<br>out.size()<br><br><span class="hljs-string">&#x27;&#x27;&#x27;output ans is</span><br><span class="hljs-string">torch.size([10,3,5])&#x27;&#x27;&#x27;</span><br><br><span class="hljs-comment"># æŒ‰ä½ç›¸ä¹˜</span><br>res = torch.mul(batch1,batch2)<br></code></pre></td></tr></table></figure>
<p><strong>viewå’Œpermute</strong>çš„ä½¿ç”¨å®é™…ä¸Šéƒ½æ˜¯ä¸æ”¹å˜åŸå€¼ï¼Œè¦ç”¨èµ‹å€¼çš„æ–¹å¼å»åšï¼Œä¸»è¦æ˜¯ä½¿ç”¨æ–¹å¼è¦å¯¹ï¼Œä¸€ä¸ªæ˜¯æŒ‰ç…§é¡ºåºå»åšã€‚</p>
<h3 id="å¼ é‡å‘½å"><a href="#å¼ é‡å‘½å" class="headerlink" title="å¼ é‡å‘½å"></a>å¼ é‡å‘½å</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">NCHW = [â€˜Nâ€™, â€˜Câ€™, â€˜Hâ€™, â€˜Wâ€™]<br>images = torch.randn(<span class="hljs-number">32</span>, <span class="hljs-number">3</span>, <span class="hljs-number">56</span>, <span class="hljs-number">56</span>, names=NCHW)<br>images.<span class="hljs-built_in">sum</span>(<span class="hljs-string">&#x27;C&#x27;</span>)<br>images.select(<span class="hljs-string">&#x27;C&#x27;</span>, index=<span class="hljs-number">0</span>)<br></code></pre></td></tr></table></figure>
<h3 id="ç±»å‹è½¬æ¢"><a href="#ç±»å‹è½¬æ¢" class="headerlink" title="ç±»å‹è½¬æ¢"></a>ç±»å‹è½¬æ¢</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># tensor ä¸ nd.arrayè¿›è¡Œäº’æ¢</span><br>ndarray = tensor.cpu().numpy()<br>tensor = torch.from_numpy(ndarray).<span class="hljs-built_in">float</span>()<br><br><span class="hljs-comment"># tensorä¸PIL.IMAGEè¿›è¡Œäº’æ¢</span><br>image = torchvision.transforms.functional.to_pil_image(tensor)<br>path = <span class="hljs-string">r&#x27;./figure.jpg&#x27;</span><br>tensor = torchvision.transforms.functional.to_tensor(PIL.Image.<span class="hljs-built_in">open</span>(path))<br><br><span class="hljs-comment"># np.ndarray ä¸ PIL.Imageçš„äº’æ¢</span><br>image = PIL.Image.fromarray(nd.array.astype(np.uint8))<br>ndarray = np.asarray(PIL.Image.<span class="hljs-built_in">open</span>(path))<br></code></pre></td></tr></table></figure>
<h3 id="ç»´åº¦å †å "><a href="#ç»´åº¦å †å " class="headerlink" title="ç»´åº¦å †å "></a>ç»´åº¦å †å </h3><p>Stackï¼Œ<strong>æ™®é€šçš„ç»´åº¦å †å çš„æµ‹è¯•ä»£ç å¦‚ä¸‹</strong></p>
<p>æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼Œå®é™…ä¸Šdim=0å°±æ˜¯åŸºæœ¬çš„å †èµ·æ¥ï¼Œdim=1å°±æ˜¯æŒ‰ç…§è¡Œæ¥å †ï¼Œdim=2å°±æ˜¯æŒ‰ç…§åˆ—æ¥å †</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python">a = torch.arange(<span class="hljs-number">1</span>,<span class="hljs-number">10</span>).reshape(<span class="hljs-number">3</span>,<span class="hljs-number">3</span>)<br>b = torch.arange(<span class="hljs-number">10</span>,<span class="hljs-number">100</span>,<span class="hljs-number">10</span>).reshape(<span class="hljs-number">3</span>,<span class="hljs-number">3</span>)<br>c = torch.arange(<span class="hljs-number">100</span>,<span class="hljs-number">1000</span>,<span class="hljs-number">100</span>).reshape(<span class="hljs-number">3</span>,<span class="hljs-number">3</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;-----------------a----------------&#x27;</span>)<br><span class="hljs-built_in">print</span>(a)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;-----------------b----------------&#x27;</span>)<br><span class="hljs-built_in">print</span>(b)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;-----------------c----------------&#x27;</span>)<br><span class="hljs-built_in">print</span>(c)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;-----------------dim =0----------------&#x27;</span>)<br>d = torch.stack((a,b,c),dim = <span class="hljs-number">0</span>)<br><span class="hljs-built_in">print</span>(d.shape)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;the value of d:-    &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(d[<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>]))<br><span class="hljs-built_in">print</span>(d)<br><span class="hljs-comment"># ä¹Ÿå°±æ˜¯è¯´ï¼ŒæŠŠå•ä¸ªå½“æˆæ•´ä½“ç›´æ¥ä»ä¸Šå¾€ä¸‹å †å </span><br><span class="hljs-comment"># ä»¥x[:][:]ä¸ºæ„æˆå•å…ƒ</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;-----------------dim =1----------------&#x27;</span>)<br>d = torch.stack((a,b,c),dim = <span class="hljs-number">1</span>)<br><span class="hljs-built_in">print</span>(d.shape)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;the value of d:-    &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(d[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>]))<br><span class="hljs-built_in">print</span>(d)<br><span class="hljs-comment"># å°†æ¯ä¸ªçš„ç¬¬ä¸€ä¸ªç»´åº¦ï¼ŒæŒ‰æ¬¡åºçº³å‡ºæ¥ï¼ŒåŒvalueçš„å †åœ¨ä¸€èµ·</span><br><span class="hljs-comment"># for exampleï¼š[a[i][:],b[i][:],c[i][:] ]ç»„æˆæ–°çš„å•å…ƒå—</span><br><span class="hljs-comment"># ä¸ï¼Œå¦ä¸€ç§ç†è§£ï¼Œä»¥x[i][:] ä¸ºå•å…ƒ</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;-----------------dim =2----------------&#x27;</span>)<br>d = torch.stack((a,b,c),dim = <span class="hljs-number">2</span>)<br><span class="hljs-built_in">print</span>(d.shape)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;the value of d:-    &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(d[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>]))<br><span class="hljs-built_in">print</span>(d)<br><span class="hljs-comment"># ç›¸åº”çš„ä»¥x[i][j]ä¸ºå•å…ƒæ„æˆ</span><br></code></pre></td></tr></table></figure>
<p><strong>listçš„æƒ…å†µä¸‹çš„ç»´åº¦å †å æµ‹è¯•ä»£ç å¦‚ä¸‹</strong></p>
<p>ç›¸åº”çš„æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼Œå®é™…ä¸Šä¸€èˆ¬æ˜¯æŒ‰ç…§dim=1æ¥è¿›è¡Œå †å </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python">A = torch.randn([<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">2</span>])<br>B = [A[:,i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(A.size(<span class="hljs-number">1</span>))]<br><span class="hljs-comment"># è¿™æ ·ç”Ÿæˆçš„æ˜¯ä¸€ä¸ªlist,æŒ‰ç…§æˆ‘ä»¬indexçš„æ’åº</span><br><span class="hljs-built_in">print</span>(A)<br><span class="hljs-built_in">print</span>(B)<br>C = torch.stack(B,dim=<span class="hljs-number">1</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;---------------------result-----------------------&#x27;</span>)<br><span class="hljs-built_in">print</span>(C)<br></code></pre></td></tr></table></figure>
<p><strong>Cat</strong></p>
<p>å®é™…ä¸Šåº”è¯¥ä¹Ÿæ˜¯ç±»ä¼¼çš„å †å æ€è·¯</p>
<h2 id="åŸºæœ¬çš„å¼ é‡å‡½æ•°"><a href="#åŸºæœ¬çš„å¼ é‡å‡½æ•°" class="headerlink" title="åŸºæœ¬çš„å¼ é‡å‡½æ•°"></a>åŸºæœ¬çš„å¼ é‡å‡½æ•°</h2><p>torch.split() åˆ’åˆ†tensor</p>
<p>torch.randpermè¿›è¡Œlistçš„ä¹±åºå¤„ç†</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å’ŒshuffleåŒºåˆ†ï¼Œè¿™æ˜¯å¦ä¸€ç§ä¹±åºçš„æ“ä½œ</span><br><span class="hljs-comment"># catæ“ä½œ</span><br>a = []<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>):<br>    a.append(torch.tensor([i,i]))<br>all_inputs = torch.cat(a)<br><span class="hljs-comment"># randpermçš„æ•ˆæœ test1</span><br>idx = torch.randperm(all_inputs.size(<span class="hljs-number">0</span>))<br><span class="hljs-built_in">print</span>(idx)<br>a1, b = all_inputs, all_inputs[idx]<br><span class="hljs-built_in">print</span>(a1,b)<br><span class="hljs-comment"># test2 ï¼Œ</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;-------------------------&#x27;</span>)<br><span class="hljs-comment"># randperm è¿›è¡Œlistçš„shuffle</span><br>tensor_a = torch.randint(<span class="hljs-number">0</span>,<span class="hljs-number">10</span>,[<span class="hljs-number">8</span>])<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;origin version &#x27;</span>, tensor_a)<br>idx = torch.randperm(tensor_a.size(<span class="hljs-number">0</span>))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;shuffle idx &#x27;</span>, idx)<br>tensor_b = tensor_a[idx]<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;after operation &#x27;</span>, tensor_b)<br></code></pre></td></tr></table></figure>
<p>.fill_()æŒ‰ç…§è¾“å…¥çš„å€¼å¯¹å¼ é‡è¿›è¡Œå¡«å……</p>
<h3 id="é€‰å–åˆ’çª—"><a href="#é€‰å–åˆ’çª—" class="headerlink" title="é€‰å–åˆ’çª—"></a>é€‰å–åˆ’çª—</h3><p><code>nn.unfold</code>æ‹†è§£å·ç§¯ä¸­çš„åˆ’çª—æ­¥éª¤</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br>inputs = torch.randn(<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">224</span>,<span class="hljs-number">224</span>)<br>unfold = torch.nn.Unfold(<span class="hljs-number">4</span>,stride=<span class="hljs-number">4</span>)<br>output = unfold(inputs)<br><span class="hljs-comment"># res output</span><br>output.size()<br>$ [<span class="hljs-number">1</span>,<span class="hljs-number">4</span>,<span class="hljs-number">3136</span>]<br><span class="hljs-comment"># 3136 = (224/4) * (224/4)</span><br></code></pre></td></tr></table></figure>
<h2 id="Torchç¯å¢ƒè®¾ç½®"><a href="#Torchç¯å¢ƒè®¾ç½®" class="headerlink" title="Torchç¯å¢ƒè®¾ç½®"></a>Torchç¯å¢ƒè®¾ç½®</h2><h3 id="pytorchä¸­çš„éšæœºç§å­åˆå§‹åŒ–"><a href="#pytorchä¸­çš„éšæœºç§å­åˆå§‹åŒ–" class="headerlink" title="pytorchä¸­çš„éšæœºç§å­åˆå§‹åŒ–"></a>pytorchä¸­çš„éšæœºç§å­åˆå§‹åŒ–</h3><p>yTorch å’Œ Pythonçš„éšæœºæ•°ç”Ÿæˆå™¨å°±ç®—éšæœºç§å­ä¸€æ ·ä¹Ÿä¸ä¼šäº§ç”Ÿä¸€æ ·çš„ç»“æœã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥è¿™æ ·æ¥è®¾ç½®Pytorchçš„éšæœºæ•°ç§å­ï¼šï¼ˆé€šå¸¸å’ŒGPUä¸€èµ·ä½¿ç”¨ï¼‰</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">torch.manual_seed(seed)<br><br></code></pre></td></tr></table></figure>
<h3 id="nn-parameter"><a href="#nn-parameter" class="headerlink" title="nn.parameter()"></a>nn.parameter()</h3><ol>
<li>Main ideaï¼š<strong>parameterçš„ä½œç”¨ï¼Œä¸»è¦æ˜¯å°†å‚æ•°å’Œmodelç»‘å®šåœ¨ä¸€èµ·</strong>ï¼Œæˆ‘ä»¬å°±çŸ¥é“è¿™ä¸ªæ¨¡å‹ä¸­ï¼Œå¯èƒ½éœ€<strong>è¦è®­ç»ƒçš„å‚æ•°</strong>æœ‰å“ªäº›ï¼Œå¯ä»¥éœ€è¦è¿›è¡Œè®­ç»ƒçš„å‚æ•°åŠ è¿›å»ï¼Œä½†æ˜¯å½“æˆ‘ä»¬æƒ³è¦freeze itçš„æ—¶å€™å°±ä½¿ç”¨detachæˆ–è€…ç›´æ¥ä¿®æ”¹require_gradæ¥è®©å‚æ•°ä¸åœ¨æ¥å—è®­ç»ƒå°±å¥½äº†ï¼Œ require_gradæ˜¯å…¶ä¸­çš„ä¸€ä¸ªå±æ€§ã€‚å¯ä»¥ç»“åˆä¸Šé¢çš„ä»£ç åˆ†æã€‚</li>
<li>tensorå˜é‡æ˜¯ä¸å¯è®­ç»ƒçš„ï¼Œåªæœ‰ä¿®æ”¹æˆparameteræ‰èƒ½è¿›è¡Œè®­ç»ƒã€‚</li>
<li>è‡ªå¸¦çš„ç½‘ç»œç»“æ„ä¸­çš„ä¸€äº›weightå’Œbiasåº”è¯¥éƒ½æ˜¯parameterçš„å˜é‡</li>
</ol>
<h3 id="nn-Softmaxä¸­çš„dim"><a href="#nn-Softmaxä¸­çš„dim" class="headerlink" title="nn.Softmaxä¸­çš„dim"></a>nn.Softmaxä¸­çš„dim</h3><p>å…¶å®æ²¡é‚£ä¹ˆå¤æ‚ï¼Œå°±å’Œæ•°æ®çš„ç»´åº¦æ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬éœ€è¦æŠŠé‚£ä¸€ä¸ªç»´åº¦çš„æ•°æ®ä¹‹åçš„æ•°æ®å…¨éƒ¨åŠ èµ·æ¥å¤„ç†å°±ç”¨å“ªä¸ªç»´åº¦å»åšã€‚</p>
<p>IMAGE = N* DATAï¼Œdim=1 è¯´æ˜dim = 0 çš„Channel æ˜¯éœ€è¦è¢«æ’å¤–çš„ã€‚ä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„softmaxæ˜¯åŸºäºdataè¿›è¡Œçš„ã€‚å¯ä»¥æ‰¾å¯»æºç è¿›è¡Œè¿›ä¸€æ­¥åˆ†æè§£é‡Šã€‚</p>
<h2 id="æµ‹è¯•ã€éªŒè¯æ¨¡å—"><a href="#æµ‹è¯•ã€éªŒè¯æ¨¡å—" class="headerlink" title="æµ‹è¯•ã€éªŒè¯æ¨¡å—"></a>æµ‹è¯•ã€éªŒè¯æ¨¡å—</h2><h3 id="åŸºæœ¬ç¼–å†™"><a href="#åŸºæœ¬ç¼–å†™" class="headerlink" title="åŸºæœ¬ç¼–å†™"></a>åŸºæœ¬ç¼–å†™</h3><h3 id="model-eval-å’Œmodel-train-çš„åŒºåˆ«"><a href="#model-eval-å’Œmodel-train-çš„åŒºåˆ«" class="headerlink" title="model.eval()å’Œmodel.train()çš„åŒºåˆ«"></a>model.eval()å’Œmodel.train()çš„åŒºåˆ«</h3><p>é€šå¸¸åœ¨æ¨¡å‹æµ‹è¯•çš„æ—¶å€™ä¼šæ‰§è¡Œ<code>model.eval()</code>åˆ‡æ¢æ¨¡å‹çš„çŠ¶æ€ï¼Œè€Œåœ¨è®­ç»ƒçš„æ—¶å€™ä¼šæ‰§è¡Œ<code>model.train()</code>ï¼Œmodelåœ¨è¿™ä¸¤ä¸ªçŠ¶æ€ä¸‹çš„åŒºåˆ«ä¸»è¦æœ‰ï¼š</p>
<p>åœ¨<strong>train</strong>çŠ¶æ€ä¸‹ä¼šå¯ç”¨BNå’ŒDropoutï¼Œè€Œåœ¨<strong>eval</strong>ä¸å¯ç”¨è¿™ä¸¤ä¸ªæ¨¡å—ï¼›</p>
<ul>
<li>å¯ç”¨BNæŒ‡çš„æ˜¯ï¼šç”¨åˆ°æ¯ä¸€ä¸ªBatchæ•°æ®çš„å‡å€¼å’Œæ–¹å·®ï¼›ä¸å¯ç”¨åˆ™æŒ‡çš„æ˜¯ä½¿ç”¨æ•´ä½“çš„å‡å€¼å’Œæ–¹å·®ï¼ˆåŒæ—¶åœæ­¢æ›´æ–°meanå’Œvarï¼‰</li>
<li>è€Œå¯¹äºDropoutæ¥è¯´ï¼šå¯ç”¨çš„æ—¶å€™æŒ‡çš„æ˜¯ä¼šéšæœºè¿›è¡Œdropoutï¼Œè€Œå…³é—­çš„è¯å°±ä¼šç”¨åˆ°å…¨éƒ¨çš„ç½‘ç»œé“¾æ¥</li>
</ul>
<h3 id="with-torch-no-grad"><a href="#with-torch-no-grad" class="headerlink" title="with torch.no_grad()"></a>with torch.no_grad()</h3><p>ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œwrapèµ·æ¥çš„éƒ¨åˆ†ä¸ä¼štrack grade</p>
<p>ä¸»è¦ç”¨äºåœæ­¢autogradæ¨¡å—çš„å·¥ä½œï¼Œè¢«<code>with</code>åŒ…è£¹èµ·æ¥çš„éƒ¨åˆ†ä¼šåœæ­¢æ¢¯åº¦çš„æ›´æ–°ï¼Œå¾—åˆ°è¿›ä¸€æ­¥çš„åŠ é€ŸæŠŠï¼Œå› ä¸ºæˆ‘ä»¬å®é™…ä¸Šåœ¨éªŒè¯çš„æ—¶å€™ä¸ä¼šæ‰§è¡Œ<code>step()</code>ç­‰æ“ä½œï¼Œæ‰€ä»¥èƒ½å¤ŸèŠ‚çœè®¡ç®—æ¨¡å‹æ¢¯åº¦çš„æ—¶é—´ã€‚</p>
<h3 id="æ¨¡å‹çš„ä¿å­˜å’Œè¯»å–ä¸“é¢˜"><a href="#æ¨¡å‹çš„ä¿å­˜å’Œè¯»å–ä¸“é¢˜" class="headerlink" title="æ¨¡å‹çš„ä¿å­˜å’Œè¯»å–ä¸“é¢˜"></a>æ¨¡å‹çš„ä¿å­˜å’Œè¯»å–ä¸“é¢˜</h3><p>@Aiken 2020</p>
<p>åŸºäºonenoteç¬”è®°ï¼Œæˆ‘ä»¬çŸ¥é“å…³é”®åœ¨äºå¦‚ä½•è‡ªç”±çš„è¯»å–æ¨¡å‹ä¸­çš„å‚æ•°ï¼Œå¹¶é€‰æ‹©æ€§çš„å–å‡ºæ¥ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/LXX516/article/details/80124768">pytorch æ¨¡å‹éƒ¨åˆ†å‚æ•°çš„åŠ è½½_LXX516çš„åšå®¢-CSDNåšå®¢_pytorch åŠ è½½éƒ¨åˆ†å‚æ•°</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-comment"># è‡³å°‘åŸºäºè¿™æ ·çš„æ–¹å¼æˆ‘ä»¬èƒ½æŠŠæ¨¡å‹ä¸­å‚æ•°çš„stringå–å‡ºæ¥ã€‚</span><br>pretrained_dict=torch.load(model_weight)<br>model_dict=myNet.state_dict()<br><br><span class="hljs-comment"># 1. filter out unnecessary keys</span><br>pretrained_dict = &#123;k: v <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> pretrained_dict.items() <span class="hljs-keyword">if</span> k <span class="hljs-keyword">in</span> model_dict&#125;<br><br><span class="hljs-comment"># 2. overwrite entries in the existing state dict</span><br>model_dict.update(pretrained_dict)<br>myNet.load_state_dict(model_dict)<br><br></code></pre></td></tr></table></figure>
<h1 id="GPUç›¸å…³çš„è®¾ç½®"><a href="#GPUç›¸å…³çš„è®¾ç½®" class="headerlink" title="GPUç›¸å…³çš„è®¾ç½®"></a>GPUç›¸å…³çš„è®¾ç½®</h1><p>@written by Aiken, 2020  this document is about Pytorchâ€˜s CUDA, &amp; GPU setting.</p>
<h2 id="æŸ¥çœ‹GPUçŠ¶æ€"><a href="#æŸ¥çœ‹GPUçŠ¶æ€" class="headerlink" title="æŸ¥çœ‹GPUçŠ¶æ€"></a>æŸ¥çœ‹GPUçŠ¶æ€</h2><h3 id="è®¾ç½®é»˜è®¤GPUè®¾å¤‡"><a href="#è®¾ç½®é»˜è®¤GPUè®¾å¤‡" class="headerlink" title="è®¾ç½®é»˜è®¤GPUè®¾å¤‡"></a>è®¾ç½®é»˜è®¤GPUè®¾å¤‡</h3><p>ä¸€èˆ¬ä½¿ç”¨GPUä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ç³»ç»Ÿä¸­æœ‰å¤šå°‘GPUè®¾å¤‡ï¼Œå› ä¸ºé»˜è®¤çš„GPUè®¾å¤‡æ˜¯0ï¼Œè€Œä¸”ï¼Œå¤§å®¶ä¸€èˆ¬éƒ½ç›´æ¥ä½¿ç”¨è¿™å¼ å¡ï¼Œæ‰€ä»¥æˆ‘ä»¬å¦‚æœåªä½¿ç”¨å•å¡çš„è¯ï¼Œåˆ‡æ¢ä¸€ä¸‹é»˜è®¤çš„GPUè®¾å¤‡ï¼Œèƒ½å¤Ÿé¿å…ä¸€å®šçš„å†²çªã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æŸ¥çœ‹GPUä½¿ç”¨çŠ¶æ€</span><br>$ nvidia-smi<br><span class="hljs-comment"># or</span><br>$ gpustat [--watch]<br><br></code></pre></td></tr></table></figure>
<h3 id="è®¾å¤‡åŸºæœ¬ä¿¡æ¯"><a href="#è®¾å¤‡åŸºæœ¬ä¿¡æ¯" class="headerlink" title="è®¾å¤‡åŸºæœ¬ä¿¡æ¯"></a><strong>è®¾å¤‡åŸºæœ¬ä¿¡æ¯</strong></h3><ol>
<li><p>æŸ¥çœ‹æ˜¯å¦å­˜åœ¨GPUï¼Œæ•°é‡ï¼Œç±»å‹</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br><span class="hljs-comment"># æŸ¥çœ‹æ˜¯å¦å­˜åœ¨GPUï¼Œæ•°é‡ï¼Œç±»å‹</span><br>torch.cuda.is_available()<br>torch.cuda.device_count()<br>torch.cuda.get_device_name(<span class="hljs-number">0</span>)<br></code></pre></td></tr></table></figure>
</li>
<li><p>æŸ¥çœ‹æŒ‡å®šçš„GPUçš„å®¹é‡å’Œåç§°</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">torch.cuda.get_device_capability(device)<br>torch.cuda.get_device_name(device)<br></code></pre></td></tr></table></figure>
</li>
<li><p>è®¾ç½®å½“å‰ç³»ç»Ÿçš„é»˜è®¤gpu_devicesï¼Œæ¨èä½¿ç”¨osæ¥è®¾ç½®ï¼ˆå®é™…ä¸Šæ˜¯å‘½ä»¤è¡Œä¸­çš„æ“ä½œï¼‰å®é™…ä¸Šæ˜¯ç³»ç»Ÿè®¾å®šé’ˆå¯¹å½“å‰è¿›ç¨‹çš„å¯è§GPUï¼Œå…¶ä»–çš„GPUä¼šå¯¹å½“å‰çš„ç¨‹åºéšè—ï¼Œæ‰€ä»¥é»˜è®¤çš„0</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">os.environ[<span class="hljs-string">&#x27;CUDA_VISIBLE_DEVICES&#x27;</span>] = <span class="hljs-string">&quot;id&quot;</span> <span class="hljs-comment">#æ¨èç”¨æ³•</span><br><span class="hljs-comment"># å¯ä»¥åœ¨vscodeçš„launch.jsonä¸­è®¾ç½®env</span><br></code></pre></td></tr></table></figure>
<p> <strong>æ³¨æ„äº‹é¡¹ï¼šè¯¥å‘½ä»¤éœ€è¦åœ¨æ‰€æœ‰è°ƒç”¨äº†CUDAçš„ä»£ç ã€å­ç¨‹åºä¹‹å‰ï¼ŒåŒ…æ‹¬<code>import</code>ï¼Œæ‰€ä»¥å¾ˆå¤šä»£ç çš„importéƒ½æ˜¯åœ¨main()ä¸­çš„ã€‚</strong></p>
</li>
</ol>
<h2 id="GPUä½¿ç”¨ç‡ä¼˜åŒ–ï¼ˆæ³¨æ„äº‹é¡¹ï¼‰"><a href="#GPUä½¿ç”¨ç‡ä¼˜åŒ–ï¼ˆæ³¨æ„äº‹é¡¹ï¼‰" class="headerlink" title="GPUä½¿ç”¨ç‡ä¼˜åŒ–ï¼ˆæ³¨æ„äº‹é¡¹ï¼‰"></a>GPUä½¿ç”¨ç‡ä¼˜åŒ–ï¼ˆæ³¨æ„äº‹é¡¹ï¼‰</h2><h3 id="ç¼“å­˜çˆ†ç‚¸é—®é¢˜"><a href="#ç¼“å­˜çˆ†ç‚¸é—®é¢˜" class="headerlink" title="ç¼“å­˜çˆ†ç‚¸é—®é¢˜"></a>ç¼“å­˜çˆ†ç‚¸é—®é¢˜</h3><p>GPUä½¿ç”¨é€”ä¸­éœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼Œåœ¨æ¯æ¬¡iterationä¹‹åè®°å¾—<strong>æ¸…é™¤åœ¨GPUä¸­å ç”¨</strong>çš„memoryï¼Œcacheç­‰ï¼Œä¸ç„¶æœ‰æ—¶å€™ä¼šå¯¼è‡´ç¼“å­˜å’Œå†…å­˜çš„é€’å¢å’Œçˆ†ç‚¸ã€‚</p>
<p>å…·ä½“æ“ä½œï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">torch.cuda.empty_cache()<br><span class="hljs-comment"># after every iteration</span><br><br></code></pre></td></tr></table></figure>
<h3 id="è¿è¡Œæ•ˆç‡ä¼˜åŒ–"><a href="#è¿è¡Œæ•ˆç‡ä¼˜åŒ–" class="headerlink" title="è¿è¡Œæ•ˆç‡ä¼˜åŒ–"></a>è¿è¡Œæ•ˆç‡ä¼˜åŒ–</h3><p><code>cudnn.benchmark</code>ã€<a target="_blank" rel="noopener" href="https://discuss.pytorch.org/t/what-does-torch-backends-cudnn-benchmark-do/5936">pytorchè®ºå›</a> <a target="_blank" rel="noopener" href="https://www.pytorchtutorial.com/when-should-we-set-cudnn-benchmark-to-true/">pytorchä¸­æ–‡ç½‘</a>ã€<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/73711222">zhihuç©¶æåˆ†ææ–‡</a></p>
<p><strong>åŸºæœ¬ä½¿ç”¨æ€è·¯</strong>ï¼š</p>
<p>åœ¨ç¨‹åºçš„å¼€å§‹ï¼Œè®©cudnnèŠ±è´¹ä¸€ç‚¹é¢å¤–çš„æ—¶é—´ï¼Œæ‰¾åˆ°é€‚ç”¨äºå½“å‰é…ç½®çš„æœ€ä½³ç®—æ³•ï¼Œä»è€Œä¼˜åŒ–è¿è¡Œæ•ˆç‡ã€‚</p>
<p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong></p>
<p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬çš„input_sizeåœ¨æ¯ä¸ªiterationéƒ½å­˜åœ¨å˜åŒ–çš„è¯ï¼Œé‚£ä¹ˆæ¯ä¸€ä¸ªiterationéƒ½è¦æ‰§è¡Œä¸€æ¬¡æœç´¢ï¼Œåè€Œå¾—ä¸å¿å¤±ã€‚</p>
<p><strong>å…·ä½“æ“ä½œ</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">torch.backends.cudnn.benchmark = true<br></code></pre></td></tr></table></figure>
<h3 id="è®¾ç½®ä½¿ç”¨GPUçš„æ–¹å¼"><a href="#è®¾ç½®ä½¿ç”¨GPUçš„æ–¹å¼" class="headerlink" title="è®¾ç½®ä½¿ç”¨GPUçš„æ–¹å¼"></a>è®¾ç½®ä½¿ç”¨GPUçš„æ–¹å¼</h3><h3 id="è®¾ç½®ç›¸åº”çš„éšæœºç§å­"><a href="#è®¾ç½®ç›¸åº”çš„éšæœºç§å­" class="headerlink" title="è®¾ç½®ç›¸åº”çš„éšæœºç§å­"></a>è®¾ç½®ç›¸åº”çš„éšæœºç§å­</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">torch.cuda.empty_cache()<br><span class="hljs-comment"># part2 è®¾ç½®éšæœºç§å­</span><br>torch.cuda.manual_seed(seed)<br>torch.cuda.manual_seed_all(seed)<br><br></code></pre></td></tr></table></figure>
<h3 id="CUDAè½¬æ¢"><a href="#CUDAè½¬æ¢" class="headerlink" title="CUDAè½¬æ¢"></a>CUDAè½¬æ¢</h3><p>ä½¿ç”¨<code>.cuda()</code>æ¥å¯¹<code>æ¨¡å‹</code>ï¼Œ<code>æ•°æ®</code>ï¼Œ<code>Loss</code>è¿›è¡Œèµ‹å€¼ï¼Œæˆ–è€…ä½¿ç”¨<code>to_devices()</code>æ¥è®¾ç½®åˆ°ç›¸åº”çš„GPUè®¾å¤‡</p>
<p>å°†æ¨¡å‹è½¬åŒ–åˆ°cudaä¸­è¦åœ¨ä¼˜åŒ–å™¨çš„å»ºç«‹ä¹‹å‰æ‰§è¡Œï¼Œå› ä¸ºoptimizeræ˜¯å¯¹äºæ¨¡å‹å»ºç«‹çš„ï¼Œå¯¹æ¨¡å‹æ‰§è¡Œcudaåå·²ç»å’ŒåŸæœ¬çš„å‚æ•°å’Œæ¨¡å‹éƒ½ä¸æ˜¯åŒä¸€ä¸ªäº†ï¼Œæ‰€ä»¥ä¸€å®š<strong>è¦åœ¨å»ºç«‹ä¼˜åŒ–å™¨ä¹‹å‰å°±å¯¹æ¨¡å‹è¿›è¡ŒCuda çš„è½¬åŒ–</strong>ã€‚</p>
<p>æ˜¯å¦è¦å¯¹lossè½¬æ¢åˆ°CUDAï¼Œå–å†³äºä¸€ä¸‹çš„ä¸¤ç§æƒ…å†µï¼š</p>
<ul>
<li>æŸå¤±å‡½æ•°æ˜¯Functionalï¼šè¿™æ ·çš„è¯åªè¦ä¼ å…¥çš„å‚æ•°æ˜¯CUDAçš„å°±ä¼šå†CUDAä¸Šè®¡ç®—</li>
<li>æŸå¤±å‡½æ•°æ˜¯Class with paramsï¼šå¦‚æœç±»å†…æœ‰å‚æ•°çš„è¯ï¼Œä¹Ÿè¦è½¬æ¢åˆ°CUDAæ‰èƒ½ä¸€èµ·åœ¨CUDAä¸Šè®¡ç®—</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">if</span> torch.cuda.is_available():<br>	<span class="hljs-keyword">try</span>:<br>		loss = loss.cuda()<br>	<span class="hljs-keyword">except</span> AttributeError:<br>		<span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;the loss is not cuda-able &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">type</span>(loss)))<br></code></pre></td></tr></table></figure>
<h3 id="å¤šGPUå¹¶è¡Œ"><a href="#å¤šGPUå¹¶è¡Œ" class="headerlink" title="å¤šGPUå¹¶è¡Œ"></a>å¤šGPUå¹¶è¡Œ</h3><p>ä¸»è¦ä½¿ç”¨çš„å‘½ä»¤<code>nn.DataParallel()</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">model = nn.DataParaller(model,device_ids=<span class="hljs-literal">None</span>)<br><span class="hljs-comment"># å¦‚æœä¸è®¾å®šidçš„è¯ï¼Œåº”è¯¥æ˜¯è‡ªåŠ¨æŒ‡å®šå…¨éƒ¨å¯è§çš„GPUçš„</span><br><br></code></pre></td></tr></table></figure>
<h1 id="CPU"><a href="#CPU" class="headerlink" title="CPU"></a>CPU</h1><p>å¶ç„¶ä¼šç”±äº<code>pin_memory</code> çš„è®¾ç½®æ¥è‡´ä½¿CPUçš„ä¸æ­£å¸¸è¿è¡Œï¼ˆæ»¡è½½ç­‰ç­‰ï¼‰ï¼Œå¹¶éæ€»æ˜¯è¿™æ ·ã€‚</p>
<h2 id="æ ¸å¿ƒå’Œçº¿ç¨‹æ•°è®¾ç½®"><a href="#æ ¸å¿ƒå’Œçº¿ç¨‹æ•°è®¾ç½®" class="headerlink" title="æ ¸å¿ƒå’Œçº¿ç¨‹æ•°è®¾ç½®"></a>æ ¸å¿ƒå’Œçº¿ç¨‹æ•°è®¾ç½®</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/lei_qi/article/details/115358703">é™åˆ¶æˆ–å¢åŠ pytorchçš„çº¿ç¨‹ä¸ªæ•°ï¼æŒ‡å®šæ ¸æ•°æˆ–è€…æ»¡æ ¸è¿è¡ŒPytorchï¼ï¼ï¼_lei_qiçš„åšå®¢-CSDNåšå®¢</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">from</span> multiprocessing <span class="hljs-keyword">import</span> cpu_count<br><span class="hljs-comment"># è®¾ç½®ç¯å¢ƒå˜é‡æ¥æ§åˆ¶çº¿ç¨‹å¤šå‘çš„æƒ…å†µ</span><br>cpu_num = cpu_count()<br><span class="hljs-comment"># æ ¸å¿ƒä»£ç </span><br>os.environ[<span class="hljs-string">&#x27;OMP_NUM_THREADS&#x27;</span>] = <span class="hljs-built_in">str</span>(cpu_num)<br><span class="hljs-comment"># ä¸‹é¢è¿™äº›åº”è¯¥æ˜¯ä¸ä¸€å®šè¯æœ‰</span><br>os.environ [<span class="hljs-string">&#x27;OPENBLAS_NUM_THREADS&#x27;</span>] = <span class="hljs-built_in">str</span>(cpu_num)<br>os.environ [<span class="hljs-string">&#x27;MKL_NUM_THREADS&#x27;</span>] = <span class="hljs-built_in">str</span>(cpu_num)<br>os.environ [<span class="hljs-string">&#x27;VECLIB_MAXIMUM_THREADS&#x27;</span>] = <span class="hljs-built_in">str</span>(cpu_num)<br>os.environ [<span class="hljs-string">&#x27;NUMEXPR_NUM_THREADS&#x27;</span>] = <span class="hljs-built_in">str</span>(cpu_num)<br><br><span class="hljs-comment"># ä»å…¶ä»–èµ„æ–™ä¸­å¯ä»¥æ„Ÿè§‰è¿™æ¡ä»£ç åº”è¯¥æ˜¯å’Œæ ¸å¿ƒä»£ç ä¸€æ ·çš„åŠŸèƒ½ï¼Œæ‰€ä»¥ä¸¤ä¸ªå†™ä¸€ä¸ªåº”è¯¥å°±å¯ä»¥äº†</span><br>torch.set_num_threds(cpu_num)<br></code></pre></td></tr></table></figure>
<h1 id="ç½‘ç»œå®šä¹‰æ¨¡å—"><a href="#ç½‘ç»œå®šä¹‰æ¨¡å—" class="headerlink" title="ç½‘ç»œå®šä¹‰æ¨¡å—"></a>ç½‘ç»œå®šä¹‰æ¨¡å—</h1><h2 id="æ•°æ®å®šä¹‰æ¨¡å—"><a href="#æ•°æ®å®šä¹‰æ¨¡å—" class="headerlink" title="æ•°æ®å®šä¹‰æ¨¡å—"></a>æ•°æ®å®šä¹‰æ¨¡å—</h2><h3 id="åˆ©ç”¨TorchVisionè¯»å–æœ¬åœ°æ•°æ®"><a href="#åˆ©ç”¨TorchVisionè¯»å–æœ¬åœ°æ•°æ®" class="headerlink" title="åˆ©ç”¨TorchVisionè¯»å–æœ¬åœ°æ•°æ®"></a>åˆ©ç”¨TorchVisionè¯»å–æœ¬åœ°æ•°æ®</h3><p><code>torchvision.datasets.imagefolder()</code> è¿™ä¸ªå‡½æ•°å®é™…ä¸Šèƒ½ä»£æ›¿æˆ‘ä»¬ä¹‹å‰å†™çš„å‡½æ•°ï¼Œä½†æ˜¯ç”±äºè‡ªå·±å†™çš„æœ‰ä¸€éƒ¨åˆ†ç»Ÿä¸€è§„åˆ™å¯ä»¥ä½¿å¾—æˆ‘ä»¬çš„è‡ªå®šä¹‰ç¨‹åº¦å¾ˆé«˜ï¼Œæ‰€ä»¥ç›®å‰æˆ‘ä»¬åœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹ä¸ä½¿ç”¨è¯¥æ–¹æ³•æ¥è¿›è¡Œæ›¿ä»£ã€‚</p>
<p>ä½†æ˜¯ç”±äºæ˜¯ä¸€ä¸ªé‡è¦çš„å‡½æ•°ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œè¿˜æ˜¯ä»‹ç»ä¸€ä¸‹è¯¥å·¥å…·çš„ä½¿ç”¨æ–¹å¼ï¼š</p>
<h3 id="torch-è‡ªå®šä¹‰Datasetåçš„ä½¿ç”¨"><a href="#torch-è‡ªå®šä¹‰Datasetåçš„ä½¿ç”¨" class="headerlink" title="torch è‡ªå®šä¹‰Datasetåçš„ä½¿ç”¨"></a>torch è‡ªå®šä¹‰Datasetåçš„ä½¿ç”¨</h3><ol>
<li>è‡ªå®šä¹‰datasetçš„ç»§æ‰¿ä»¥åŠåç»­è°ƒç”¨éœ€è¦æ³¨æ„çš„æ˜¯ä¸èƒ½å¿˜è®°å°†å…¶è½¬æ¢æˆdataloaerï¼Œç„¶åè¿›è¡Œiterå‘½ä»¤çš„æ‰§è¡Œã€‚</li>
<li>ä¹Ÿå¯ä»¥ç”¨enumerateå‡½æ•°æ¥è¿›è¡Œè°ƒç”¨ï¼Œå°±æ˜¯è®°å¾—è°ƒç”¨çš„æ ¼å¼æ˜¯ä»€ä¹ˆå°±å¥½</li>
<li>å¯ä»¥å‚è€ƒbasicunitä¸­çš„å¯¹shuffleçš„è®¤çŸ¥å¯¹è¯¥å‡½æ•°è¿›è¡Œè¿›ä¸€æ­¥çš„ç†è§£ã€‚</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å®šä¹‰datasetçš„éƒ¨åˆ†</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">RL_AET_Dataset</span>(torch.utils.data.Dataset):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">super</span>(RL_AET_Dataset,self).__init__()<br>        <span class="hljs-keyword">pass</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__len__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">pass</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__getitem</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">pass</span><br><span class="hljs-comment"># å£°æ˜å’Œæ„å»ºéƒ¨åˆ† è¦è®°å¾—ä½¿ç”¨dataloader</span><br>train_l_dataset = RL_AET_Dataset(x_l, y_l, args)<br>train_l_dataloader =torch.utils.data.DataLoader(train_l_dataset,batch_size=args[<span class="hljs-string">&#x27;b_s&#x27;</span>],shuffle=<span class="hljs-literal">True</span>,num_workers=args[<span class="hljs-string">&#x27;num_workers&#x27;</span>],drop_last=<span class="hljs-literal">True</span>,pin_memory=<span class="hljs-literal">True</span>)<br><br><span class="hljs-comment">#è°ƒç”¨è¿­ä»£éƒ¨åˆ†</span><br>labeled_loader = <span class="hljs-built_in">iter</span>(train_l_dataloader)<br><span class="hljs-comment">#all_label_info =  [*next(labeled_loader)]</span><br><br></code></pre></td></tr></table></figure>
<h3 id="Dataloaderä¸­çš„transformerï¼ˆï¼‰ï¼š"><a href="#Dataloaderä¸­çš„transformerï¼ˆï¼‰ï¼š" class="headerlink" title="Dataloaderä¸­çš„transformerï¼ˆï¼‰ï¼š"></a>Dataloaderä¸­çš„transformerï¼ˆï¼‰ï¼š</h3><p><strong>ç–‘æƒ‘è§£ç­”  ç”¨composeé›†æˆçš„æ‰€æœ‰transformï¼Œéƒ½ä¼šåº”ç”¨ï¼Œæœ‰ä¸ªto_tensorï¼Œåˆ‡to_tensorä¼šè‡ªåŠ¨è½¬æ¢PILä¸­çš„channelå’Œæ•°å€¼èŒƒå›´ã€‚</strong></p>
<ol>
<li>composeä¸­çš„å˜æ¢ç»„åˆçš„é¡ºåºå…³ç³»<ul>
<li>PILå¤„ç†çš„å›¾åƒå˜æ¢ï¼ˆæ¯”å¦‚æ•°æ®å¢å¼ºä¹‹ç±»çš„æ–¹æ³•ï¼‰</li>
<li><code>to_tensor()</code></li>
<li>å¤„ç†tensorçš„æ–¹æ³•ï¼š<code>normalize</code></li>
</ul>
</li>
<li><p>ç¤ºä¾‹ä»£ç </p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python">data_transforms = transforms.Compose([<br>                        transforms.RandomResizedCrop(<span class="hljs-number">224</span>),<br>                        transforms.RandomHorizontalFlip().<br>                        transforms.ToTensor(),<br>                        transforms.Normalize([a,b,c],[A,B,C])])<br><span class="hljs-comment"># ç„¶åç›´æ¥åŠ å…¥datasetä¸­çš„å‚æ•°ï¼Œæˆ–è€…æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„éƒ¨åˆ†</span><br><span class="hljs-comment"># åœ¨datasetä¸­çš„å†™æ³•å¦‚ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è‡ªå·±çš„datasetä¸­è¿›è¡Œå®šä¹‰</span><br><span class="hljs-keyword">if</span> self.transformer <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>        img = self.transform(img)<br><span class="hljs-comment"># å…·ä½“çš„æºç ç»†èŠ‚è¡¨ç°å¦‚ä¸‹</span><br><span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> self.transforms:<br>        img = t(img)<br><span class="hljs-keyword">return</span> img<br></code></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="Dataloaderä¸­çš„å‚æ•°"><a href="#Dataloaderä¸­çš„å‚æ•°" class="headerlink" title="Dataloaderä¸­çš„å‚æ•°"></a>Dataloaderä¸­çš„å‚æ•°</h3><p>shuffleæœºåˆ¶</p>
<p>ä¸»è¦è§£å†³é—®é¢˜ï¼š</p>
<ol>
<li>æ˜¯å¦æ¯æ¬¡è°ƒç”¨çš„æ—¶å€™éƒ½è¿›è¡Œéšæœºçš„æ“ä½œï¼Œè¿˜æ˜¯åªæœ‰åœ¨åˆå§‹åŒ–çš„æ—¶å€™æ‰è¿›è¡Œéšæœº</li>
<li>ä¸¤ç§ä¸åŒä½¿ç”¨Dataloaderçš„æ–¹å¼æ˜¯å¦ä¼šå¯¹shuffleçš„æ–¹å¼è¿›è¡ŒåŒºåˆ†</li>
</ol>
<p>ç»“è®ºï¼š</p>
<ol>
<li>æ¯æ¬¡å¯¹dataloaderè¿›è¡Œé‡æ–°è°ƒç”¨ï¼ˆé‡æ–°æ”¾åˆ°enumerateï¼‰ï¼Œæˆ–è€…é‡æ–°å®šä¹‰iterï¼Œéƒ½ä¼šé‡æ–°è¿›è¡Œshuffleã€‚</li>
</ol>
<p>num_worker</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/hesse-summer/p/11343870.html">å‚è€ƒèµ„æ–™1</a>  å‚è€ƒèµ„æ–™2ï¼špytorchä¸­æ–‡æ–‡æ¡£ğŸ‘‡</p>
<p><strong>num_workers</strong> (<em>int</em>, optional) â€“ ç”¨å¤šå°‘ä¸ªå­è¿›ç¨‹åŠ è½½æ•°æ®ã€‚0è¡¨ç¤ºæ•°æ®å°†åœ¨ä¸»è¿›ç¨‹ä¸­åŠ è½½(é»˜è®¤: 0)<br>ç”¨num_workerä¸ªå­è¿›ç¨‹åŠ è½½æ•°æ®ï¼Œæ‰€ä»¥èƒ½å¤Ÿå°†æ•°æ®åœ¨ä¸»è¿›ç¨‹å±•ç¤ºè¿˜æ²¡æœ‰è°ƒç”¨åˆ°è¯¥æ•°æ®ä¹‹å‰å°±å°†åç»­çš„æ•°æ®å­˜å…¥RAMï¼Œæ‰€ä»¥åœ¨æ•°æ®è¯»å–ä¸Šä¼šæ¯”è¾ƒå¿«ï¼Œä½†æ˜¯å ç”¨çš„RAMå’ŒCPUèµ„æºä¼šæ¯”è¾ƒå¤§ã€‚</p>
<p>samples:</p>
<p><a target="_blank" rel="noopener" href="https://pytorch.org/docs/stable/data.html?highlight=dataloader#torch.utils.data.DataLoader">torch.utils.data - PyTorch 1.9.0 documentation</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/marsggbo/p/11308889.html">ä¸€æ–‡å¼„æ‡‚Pytorchçš„DataLoader, DataSet, Samplerä¹‹é—´çš„å…³ç³»</a></p>
<p>å®˜æ–¹çš„è§£é‡Šæ˜¯ï¼š</p>
<p>sampler (Sampler or Iterable, optional) â€“ defines the strategy to draw samples from the dataset. Can be any Iterable with <strong>len</strong> implemented. If specified, shuffle must not be specified.</p>
<p>å®šä¹‰ä»æ•°æ®é›†ï¼ˆè¿˜æ˜¯æœ€å¼€å§‹çš„å“ªä¸ªæ•°æ®é›†ï¼Œä¸èƒ½æ˜¯é¢å¤–çš„æ•°æ®é›†ï¼‰ä¸­æå–æ ·æœ¬çš„ç­–ç•¥ï¼šæ˜¯å¦èƒ½é€šè¿‡è¯¥Methodå»å®ç°Hard-Taskæˆ–è€…åƒMeta-Taskä¸€æ ·çš„é‡‡æ ·è¿‡ç¨‹å‘¢ï¼Ÿä»Meta-Transfer-Learningä¸­çœ‹æ¥æ˜¯å¯ä»¥çš„ï¼Œå¯ä»¥å­¦ä¹ ä¸€ä¸‹å®ƒçš„å†™æ³•ã€‚</p>
<h4 id="collate-fn"><a href="#collate-fn" class="headerlink" title="collate_fn()"></a>collate_fn()</h4><p>collate<em>fnçš„ä½œç”¨å°±æ˜¯å°†ä¸€ä¸ªbatchçš„æ•°æ®è¿›è¡Œåˆå¹¶æ“ä½œã€‚é»˜è®¤çš„collate<em>fnæ˜¯å°†imgå’Œlabelåˆ†åˆ«åˆå¹¶æˆimgså’Œlabelsï¼Œæ‰€ä»¥å¦‚æœä½ çš„__getitem</em></em>æ–¹æ³•åªæ˜¯è¿”å› img, label,é‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨é»˜è®¤çš„collate_fnæ–¹æ³•,<br>ä½†æ˜¯å¦‚æœä½ æ¯æ¬¡è¯»å–çš„æ•°æ®æœ‰img, box, labelç­‰ç­‰ï¼Œé‚£ä¹ˆä½ å°±éœ€è¦è‡ªå®šä¹‰collate_fnæ¥å°†å¯¹åº”çš„æ•°æ®åˆå¹¶æˆä¸€ä¸ªbatchæ•°æ®ï¼Œè¿™æ ·æ–¹ä¾¿åç»­çš„è®­ç»ƒæ­¥éª¤ã€‚</p>
<ul>
<li>ç¼–å†™collate_fnå¯ä»¥å‚è€ƒqidongçš„æ–‡ç« ä¸»è¦æ˜¯æ¥å—æ•°æ®å’Œæ ‡ç­¾åˆ—è¡¨ï¼Œå°†å…¶æ•´åˆæˆä¸€ä¸ªçŸ©é˜µçš„å½¢å¼;</li>
<li>å¦‚æœå¯¹ä¼ å‚æœ‰éœ€æ±‚,å¯ä»¥å‚è€ƒ<code>lambda</code>çš„å½¢å¼æˆ–è€…æ˜¯ç±»å®šä¹‰çš„å½¢å¼å»ä¼ å…¥</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python">dataload = DataLoader(dataset, <span class="hljs-keyword">lambda</span> x: collate_fn(x, **params))<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">collater</span>():<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">**params</span>):<br>        self.params = ...<br>    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__call</span>(<span class="hljs-params">self,datas</span>):<br>        <span class="hljs-comment"># make it a batch in this function, then we will instance this class</span><br>        ...<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_helpful_fn</span>(<span class="hljs-params">self</span>):<br>        ...<br></code></pre></td></tr></table></figure>
<p>using collate_fn, we can augment the dataset more flexible.</p>
<h2 id="ç¼–å†™æ¨¡å‹"><a href="#ç¼–å†™æ¨¡å‹" class="headerlink" title="ç¼–å†™æ¨¡å‹"></a>ç¼–å†™æ¨¡å‹</h2><h3 id="æ¨¡å‹åŸºæœ¬å•å…ƒ"><a href="#æ¨¡å‹åŸºæœ¬å•å…ƒ" class="headerlink" title="æ¨¡å‹åŸºæœ¬å•å…ƒ"></a>æ¨¡å‹åŸºæœ¬å•å…ƒ</h3><p>nn.conv2Dï¼š</p>
<ul>
<li>kernel_size[1]åº”è¯¥æŒ‡çš„æ˜¯å·ç§¯æ ¸çš„å®½ï¼ˆä¸ä¸€å®šéƒ½æ˜¯æ­£æ–¹å½¢çš„ï¼‰</li>
</ul>
<h3 id="æ¨¡å‹å‚æ•°å…±äº«ï¼š"><a href="#æ¨¡å‹å‚æ•°å…±äº«ï¼š" class="headerlink" title="æ¨¡å‹å‚æ•°å…±äº«ï¼š"></a>æ¨¡å‹å‚æ•°å…±äº«ï¼š</h3><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/wwzone/articles/12917333.html">pytorchï¼šå¯¹æ¯”cloneã€detachä»¥åŠcopy_ç­‰å¼ é‡å¤åˆ¶æ“ä½œ</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å‡è®¾æœ‰modelaå’Œmodelbï¼Œæˆ‘ä»¬éœ€è¦åœ¨è¿›è¡Œä¸‹é™çš„æ—¶å€™æ‰§è¡Œå‚æ•°ç»Ÿä¸€ï¼Œ</span><br><span class="hljs-keyword">for</span> a_para,b_para <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(modela.parameters(),modelb.parameters()):<br>        b_para.data.copy_(a_para.data)<br></code></pre></td></tr></table></figure>
<h3 id="ç½‘ç»œå®šä¹‰çš„æ–¹å¼å¯¹æ¯”åˆ†æ"><a href="#ç½‘ç»œå®šä¹‰çš„æ–¹å¼å¯¹æ¯”åˆ†æ" class="headerlink" title="ç½‘ç»œå®šä¹‰çš„æ–¹å¼å¯¹æ¯”åˆ†æ"></a>ç½‘ç»œå®šä¹‰çš„æ–¹å¼å¯¹æ¯”åˆ†æ</h3><p>@Aiken 2021 ä¸»è¦å¯¹æ¯”çš„æ˜¯ModuleListå’ŒSequtial</p>
<p><strong>ç»“è®ºï¼š</strong>é€šå¸¸ä½¿ç”¨çš„è¯ï¼Œè¿™é‡Œæˆ‘ä¸ªäººæ¨èä½¿ç”¨çš„æ˜¯<code>sequtial</code>ç»“åˆ<code>collection</code>ä¸­çš„<code>orderdict</code>æ¥æ„å»ºçš„æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•é›†æˆäº†å†…éƒ¨çš„<code>forward</code>ï¼ŒåŒæ—¶é€šè¿‡<code>`orderdict</code>ä¹Ÿèƒ½ç»™printå¸¦æ¥æ›´å¥½çš„å¯è§†åŒ–æ•ˆæœã€‚</p>
<p>ä½†æ˜¯è¿˜æ˜¯æœ‰ä¸€äº›ç‰¹æ®Šçš„ä½¿ç”¨åœºæ™¯æˆ‘ä»¬ä¼šç”¨åˆ°<code>ModuleList</code></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/75206669">è¯¦è§£PyTorchä¸­çš„ModuleListå’ŒSequential</a></p>
<p>ä¸»è¦åŒºåˆ«ï¼š</p>
<ol>
<li>nn.Sequentialå†…éƒ¨å®ç°äº†forwardå‡½æ•°ï¼Œå› æ­¤å¯ä»¥ä¸ç”¨å†™forwardå‡½æ•°ã€‚è€Œnn.ModuleListåˆ™æ²¡æœ‰å®ç°å†…éƒ¨forwardå‡½æ•°ã€‚</li>
<li>nn.Sequentialå¯ä»¥ä½¿ç”¨OrderedDictå¯¹æ¯å±‚è¿›è¡Œå‘½åï¼Œä¸Šé¢å·²ç»é˜è¿°è¿‡äº†ï¼›</li>
<li>nn.Sequentialé‡Œé¢çš„æ¨¡å—æŒ‰ç…§é¡ºåºè¿›è¡Œæ’åˆ—çš„ï¼Œæ‰€ä»¥å¿…é¡»ç¡®ä¿å‰ä¸€ä¸ªæ¨¡å—çš„è¾“å‡ºå¤§å°å’Œä¸‹ä¸€ä¸ªæ¨¡å—çš„è¾“å…¥å¤§å°æ˜¯ä¸€è‡´çš„ã€‚è€Œnn.ModuleList å¹¶æ²¡æœ‰å®šä¹‰ä¸€ä¸ªç½‘ç»œï¼Œå®ƒåªæ˜¯å°†ä¸åŒçš„æ¨¡å—å‚¨å­˜åœ¨ä¸€èµ·ï¼Œè¿™äº›æ¨¡å—ä¹‹é—´å¹¶æ²¡æœ‰ä»€ä¹ˆå…ˆåé¡ºåºå¯è¨€ã€‚<strong>ç½‘ç»œçš„æ‰§è¡Œé¡ºåºæŒ‰ç…§æˆ‘ä»¬åœ¨forwardä¸­æ€ä¹ˆç¼–å†™æ¥å†³å®šçš„</strong></li>
<li><p>æœ‰çš„æ—¶å€™ç½‘ç»œä¸­æœ‰å¾ˆå¤šç›¸ä¼¼æˆ–è€…é‡å¤çš„å±‚ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šè€ƒè™‘ç”¨ for å¾ªç¯æ¥åˆ›å»ºå®ƒä»¬ï¼Œè€Œä¸æ˜¯ä¸€è¡Œä¸€è¡Œåœ°å†™ï¼Œè¿™ç§æ—¶å€™å°±ä½¿ç”¨ModuleListï¼š</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">net4</span>(nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">super</span>(net4, self).__init__()<br>        layers = [nn.Linear(<span class="hljs-number">10</span>, <span class="hljs-number">10</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>)]<br>        self.linears = nn.ModuleList(layers)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):<br>        <span class="hljs-keyword">for</span> layer <span class="hljs-keyword">in</span> self.linears:<br>            x = layer(x)<br>        <span class="hljs-keyword">return</span> x<br><br>net = net4()<br><span class="hljs-built_in">print</span>(net)<br><span class="hljs-comment"># net4(</span><br><span class="hljs-comment">#   (linears): ModuleList(</span><br><span class="hljs-comment">#     (0): Linear(in_features=10, out_features=10, bias=True)</span><br><span class="hljs-comment">#     (1): Linear(in_features=10, out_features=10, bias=True)</span><br><span class="hljs-comment">#     (2): Linear(in_features=10, out_features=10, bias=True)</span><br><span class="hljs-comment">#   )</span><br><span class="hljs-comment"># )</span><br><br></code></pre></td></tr></table></figure>
</li>
</ol>
<p>åŸºæœ¬ä½¿ç”¨ï¼š</p>
<ol>
<li><p>nn.sequential</p>
<p> å¯ä»¥é€šè¿‡listå’Œ*ä»¥åŠadd moudleæ¥è¿›è¡Œè¿­ä»£çš„å®šä¹‰ï¼ŒåŒæ—¶è¿™ç§å®šä¹‰æ–¹å¼ï¼Œä¼šæ–¹ä¾¿æˆ‘ä»¬çš„é‡å¤æ³¨å†Œ</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> OrderedDict<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">net_seq</span>(nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">super</span>(net_seq, self).__init__()<br>        self.seq = nn.Sequential(OrderedDict([<br>                        (<span class="hljs-string">&#x27;conv1&#x27;</span>, nn.Conv2d(<span class="hljs-number">1</span>,<span class="hljs-number">20</span>,<span class="hljs-number">5</span>)),<br>                         (<span class="hljs-string">&#x27;relu1&#x27;</span>, nn.ReLU()),<br>                          (<span class="hljs-string">&#x27;conv2&#x27;</span>, nn.Conv2d(<span class="hljs-number">20</span>,<span class="hljs-number">64</span>,<span class="hljs-number">5</span>)),<br>                       (<span class="hljs-string">&#x27;relu2&#x27;</span>, nn.ReLU())<br>                       ]))<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):<br>        <span class="hljs-keyword">return</span> self.seq(x)<br>net_seq = net_seq()<br><span class="hljs-built_in">print</span>(net_seq)<br><span class="hljs-comment">#net_seq(</span><br><span class="hljs-comment">#  (seq): Sequential(</span><br><span class="hljs-comment">#    (conv1): Conv2d(1, 20, kernel_size=(5, 5), stride=(1, 1))</span><br><span class="hljs-comment">#    (relu1): ReLU()</span><br><span class="hljs-comment">#    (conv2): Conv2d(20, 64, kernel_size=(5, 5), stride=(1, 1))</span><br><span class="hljs-comment">#    (relu2): ReLU()</span><br><span class="hljs-comment">#  )</span><br><span class="hljs-comment">#)</span><br><br></code></pre></td></tr></table></figure>
</li>
<li><p>nn.ModuleList:ä¸pythonè‡ªå¸¦çš„Listä¸åŒçš„åœ°æ–¹åœ¨äºä»–ä¼šè‡ªåŠ¨å°†ç½‘ç»œæ³¨å†Œåˆ°Parameterä¸­ï¼Œæˆä¸ºç½‘ç»œï¼Œä½†æ˜¯éœ€è¦è‡ªå·±å»ç¼–å†™forwardè¿‡ç¨‹</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">net_modlist</span>(nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">super</span>(net_modlist, self).__init__()<br>        self.modlist = nn.ModuleList([<br>                       nn.Conv2d(<span class="hljs-number">1</span>, <span class="hljs-number">20</span>, <span class="hljs-number">5</span>),<br>                       nn.ReLU(),<br>                        nn.Conv2d(<span class="hljs-number">20</span>, <span class="hljs-number">64</span>, <span class="hljs-number">5</span>),<br>                        nn.ReLU()<br>                        ])<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):<br>        <span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> self.modlist:<br>            x = m(x)<br>        <span class="hljs-keyword">return</span> x<br><br>net_modlist = net_modlist()<br><span class="hljs-built_in">print</span>(net_modlist)<br><span class="hljs-comment">#net_modlist(</span><br><span class="hljs-comment">#  (modlist): ModuleList(</span><br><span class="hljs-comment">#    (0): Conv2d(1, 20, kernel_size=(5, 5), stride=(1, 1))</span><br><span class="hljs-comment">#    (1): ReLU()</span><br><span class="hljs-comment">#    (2): Conv2d(20, 64, kernel_size=(5, 5), stride=(1, 1))</span><br><span class="hljs-comment">#    (3): ReLU()</span><br><span class="hljs-comment">#  )</span><br><span class="hljs-comment">#)</span><br><br><span class="hljs-keyword">for</span> param <span class="hljs-keyword">in</span> net_modlist.parameters():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(param.data), param.size())<br><span class="hljs-comment">#&lt;class &#x27;torch.Tensor&#x27;&gt; torch.Size([20, 1, 5, 5])</span><br><span class="hljs-comment">#&lt;class &#x27;torch.Tensor&#x27;&gt; torch.Size([20])</span><br><span class="hljs-comment">#&lt;class &#x27;torch.Tensor&#x27;&gt; torch.Size([64, 20, 5, 5])</span><br><span class="hljs-comment">#&lt;class &#x27;torch.Tensor&#x27;&gt; torch.Size([64])</span><br><br></code></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="Detach-amp-detach"><a href="#Detach-amp-detach" class="headerlink" title="Detach &amp; detach_"></a>Detach &amp; detach_</h3><p>è¿™ä¸ªæ¨¡å—åœ¨åç»­è¿›è¡Œpretrainæˆ–è€…transferçš„æ—¶å€™åº”è¯¥ä¼šç»å¸¸è¢«ç”¨åˆ°ï¼Œæ‰€ä»¥è¿™ç§æ–¹æ³•è¿˜æ˜¯éœ€è¦ç†Ÿç»ƒæŒæ¡çš„</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/wanghui-garcia/p/10677071.html">è¯¦ç»†çš„åˆ†æä»‹ç»</a></p>
<p><code>detach</code>æ˜¯äº§ç”Ÿä¸€ç»„ä¸éœ€è¦ä¸‹é™çš„â€œ<code>Copy</code>â€ï¼šå¦‚æœè¦ä¿®æ”¹åŸå€¼çš„è¯å°±è¦è¿›è¡Œèµ‹å€¼æ“ä½œã€‚</p>
<p><code>detach_</code>åˆ™æ˜¯ä¿®æ”¹æœ¬èº«å‚æ•°çš„å±æ€§ï¼ˆ<code>require_grad</code>etc.ï¼‰æ‰§è¡Œå‡½æ•°å°±èƒ½å°†å‚æ•°ä¿®æ”¹ä¸ºä¸éœ€è¦ä¸‹é™çš„æƒ…å†µï¼Œä¸éœ€è¦æ‰§è¡Œèµ‹å€¼å¤„ç†ã€‚</p>
<h3 id="æ¨¡å‹è°ƒç”¨çš„Tips"><a href="#æ¨¡å‹è°ƒç”¨çš„Tips" class="headerlink" title="æ¨¡å‹è°ƒç”¨çš„Tips"></a>æ¨¡å‹è°ƒç”¨çš„Tips</h3><p><strong>ä½¿ç”¨listè¿›è¡Œå¤šæ¨¡å‹çš„æ··åˆè°ƒç”¨</strong></p>
<p>ç”±äºpythoné»˜è®¤çš„æ˜¯å¼•ç”¨èµ‹å€¼ï¼Œä¹Ÿå°±æ˜¯æµ…æ‹·è´çš„æ–¹å¼ï¼Ÿ<br>é€šè¿‡listæ¥è¿›è¡Œæ¨¡å‹çš„æ‰¹é‡æ„å»ºï¼Œé€šè¿‡listæ¥å°†æ¨¡å‹æ•´åˆèµ·æ¥ï¼Œæ˜¯<strong>ä¸ä¼š</strong>ä½¿ç”¨<strong>é¢å¤–çš„å­˜å‚¨ç©ºé—´</strong>çš„ï¼Œå®ƒä»¬æŒ‡å‘åŒä¸€ä¸ªåœ°å€ã€‚åŸºäºè¿™æ ·çš„å‡è®¾ï¼Œæˆ‘ä»¬å¯ä»¥åŸºäºlistæ¥ç®€åŒ–ä»£ç ï¼Œé€šè¿‡LOOPæ¥æ‰§è¡Œï¼Œç›¸å…³çš„è°ƒç”¨æ“ä½œï¼Œæ¯”å¦‚ç”Ÿæˆå™¨æˆ–è€…é¢„æµ‹ä¹‹ç±»çš„ï¼Œæ¥<strong>ç®€åŒ–</strong>ä»£ç ç»“æ„ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python">model1 = AET_model(<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,**kwargs)<br>model2 = AET_model(<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,**kwargs)<br>model_list = [model1,model2]<br><span class="hljs-keyword">if</span> <span class="hljs-built_in">id</span>(model1)==<span class="hljs-built_in">id</span>(model2):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;the address of those model is same, so donot need extra space&#x27;</span>)<br><span class="hljs-comment"># å…·ä½“å¯ä»¥ç®€åŒ–ä»€ä¹ˆç±»å‹çš„æ“ä½œï¼š</span><br>optimizer_list = []<br><span class="hljs-keyword">for</span> _, models_t <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(model_list):<br>    optimizer_list.append(optim.SGD(<br>                            models_t.parameters(),<br>                            lr,momï¼Œwd))<br>optimizer1 = _[<span class="hljs-number">0</span>]<br>optimizer2 = _[<span class="hljs-number">1</span>]<br><span class="hljs-comment"># like this</span><br><br></code></pre></td></tr></table></figure>
<h3 id="Warm-up-factor"><a href="#Warm-up-factor" class="headerlink" title="Warm-up factor"></a>Warm-up factor</h3><p>å¯¹äºè¿™ä¸€éƒ¨åˆ†çš„æ¦‚å¿µæˆ‘è¿˜æ˜¯æœ‰äº›ä¸äº†è§£ï¼Œæ˜¯å¦å’Œå†·å¯åŠ¨å’Œçƒ­å¯åŠ¨çš„æ¦‚å¿µæ˜¯ç›¸å…³çš„ï¼Œå¦‚æœä¸æ˜¯çš„è¯ï¼Œé¡ºä¾¿å°±å­¦ä¹ ä¸€ä¸‹å†·å¯åŠ¨å’Œçƒ­å¯åŠ¨çš„æ¦‚å¿µã€‚</p>
<p>å…·ä½“è§£æï¼š</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/55933867/what-does-learning-rate-warm-up-mean">neural network - What does â€œlearning rate warm-upâ€ mean? - Stack Overflow</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_36387683/article/details/97265084">å…³äºwarm<em>upå­¦ä¹ ç‡</em>äº‘ä¸­å¯»é›¾çš„åšå®¢-CSDNåšå®¢</a></li>
</ol>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/xys430381_1/article/details/107468446">pytorchå­¦ä¹ ç‡è°ƒæ•´æ–¹æ³•ï¼ˆwarm upï¼‰ ï¼Œlabel smoothã€apexæ··åˆç²¾åº¦è®­ç»ƒã€æ¢¯åº¦ç´¯åŠ _xys430381_1çš„ä¸“æ -CSDNåšå®¢</a></p>
<p><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/338066667">ç¥ç»ç½‘ç»œä¸­ warmup ç­–ç•¥ä¸ºä»€ä¹ˆæœ‰æ•ˆï¼›æœ‰ä»€ä¹ˆç†è®ºè§£é‡Šä¹ˆï¼Ÿ</a></p>
<h3 id="Weight-decayï¼ˆL2ï¼‰"><a href="#Weight-decayï¼ˆL2ï¼‰" class="headerlink" title="Weight decayï¼ˆL2ï¼‰"></a>Weight decayï¼ˆL2ï¼‰</h3><p>å®é™…ä¸Šå°±æ˜¯å¯¹æƒé‡è¿›è¡ŒL2æ­£åˆ™åŒ–ï¼Œè®©æƒé‡è¡°å‡åˆ°æ›´å°çš„å€¼ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šå‡å°‘æ¨¡å‹çš„è¿‡æ‹Ÿåˆé—®é¢˜ï¼Œæ‰€ä»¥æƒé‡è¡°å‡å®é™…ä¸Šä¹Ÿå«L2æ­£åˆ™åŒ–ã€‚</p>
<p>å…·ä½“çš„æ•°å­¦æ¨å¯¼åç»­å°†é›†æˆåˆ°<strong>GoodNoteç¬”è®°</strong>ä¸Šï¼Œå°†æ­£åˆ™åŒ–å•ç‹¬ä½œä¸ºä¸€ä¸ªæ¨¡å—å»æ•´ç†ã€‚</p>
<p><strong>æƒé‡è¡°å‡ï¼ˆL2æ­£åˆ™åŒ–ï¼‰çš„ä½œç”¨</strong></p>
<p><strong>ä½œç”¨ï¼š</strong> æƒé‡è¡°å‡ï¼ˆL2æ­£åˆ™åŒ–ï¼‰å¯ä»¥é¿å…æ¨¡å‹è¿‡æ‹Ÿåˆé—®é¢˜ã€‚</p>
<p><strong>æ€è€ƒï¼š</strong> L2æ­£åˆ™åŒ–é¡¹æœ‰è®©wå˜å°çš„æ•ˆæœï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆwå˜å°å¯ä»¥é˜²æ­¢è¿‡æ‹Ÿåˆå‘¢ï¼Ÿ</p>
<p><strong>åŸç†ï¼š</strong> ï¼ˆ1ï¼‰ä»æ¨¡å‹çš„å¤æ‚åº¦ä¸Šè§£é‡Šï¼šæ›´å°çš„æƒå€¼wï¼Œä»æŸç§æ„ä¹‰ä¸Šè¯´ï¼Œè¡¨ç¤ºç½‘ç»œçš„å¤æ‚åº¦æ›´ä½ï¼Œå¯¹æ•°æ®çš„æ‹Ÿåˆæ›´å¥½ï¼ˆè¿™ä¸ªæ³•åˆ™ä¹Ÿå«åšå¥¥å¡å§†å‰ƒåˆ€ï¼‰ï¼Œè€Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œä¹ŸéªŒè¯äº†è¿™ä¸€ç‚¹ï¼ŒL2æ­£åˆ™åŒ–çš„æ•ˆæœå¾€å¾€å¥½äºæœªç»æ­£åˆ™åŒ–çš„æ•ˆæœã€‚ï¼ˆ2ï¼‰ä»æ•°å­¦æ–¹é¢çš„è§£é‡Šï¼šè¿‡æ‹Ÿåˆçš„æ—¶å€™ï¼Œæ‹Ÿåˆå‡½æ•°çš„ç³»æ•°å¾€å¾€éå¸¸å¤§ï¼Œä¸ºä»€ä¹ˆï¼Ÿå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¿‡æ‹Ÿåˆï¼Œå°±æ˜¯æ‹Ÿåˆå‡½æ•°éœ€è¦é¡¾å¿Œæ¯ä¸€ä¸ªç‚¹ï¼Œæœ€ç»ˆå½¢æˆçš„æ‹Ÿåˆå‡½æ•°æ³¢åŠ¨å¾ˆå¤§ã€‚åœ¨æŸäº›å¾ˆå°çš„åŒºé—´é‡Œï¼Œå‡½æ•°å€¼çš„å˜åŒ–å¾ˆå‰§çƒˆã€‚è¿™å°±æ„å‘³ç€å‡½æ•°åœ¨æŸäº›å°åŒºé—´é‡Œçš„å¯¼æ•°å€¼ï¼ˆç»å¯¹å€¼ï¼‰éå¸¸å¤§ï¼Œç”±äºè‡ªå˜é‡å€¼å¯å¤§å¯å°ï¼Œæ‰€ä»¥åªæœ‰ç³»æ•°è¶³å¤Ÿå¤§ï¼Œæ‰èƒ½ä¿è¯å¯¼æ•°å€¼å¾ˆå¤§ã€‚è€Œæ­£åˆ™åŒ–æ˜¯é€šè¿‡çº¦æŸå‚æ•°çš„èŒƒæ•°ä½¿å…¶ä¸è¦å¤ªå¤§ï¼Œæ‰€ä»¥å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šå‡å°‘è¿‡æ‹Ÿåˆæƒ…å†µã€‚</p>
<p><img src="https://raw.githubusercontent.com/AikenH/md-image/master/img/image-20201205175236273.png" alt="https://raw.githubusercontent.com/AikenH/md-image/master/img/image-20201205175236273.png"></p>
<p>image-20201205175236273</p>
<p>å†…å®¹æ¥è‡ªï¼š <a target="_blank" rel="noopener" href="https://blog.csdn.net/u012162613/article/details/44261657">æ­£åˆ™åŒ–æ–¹æ³•ï¼šL1å’ŒL2 regularizationã€æ•°æ®é›†æ‰©å¢ã€dropout</a></p>
<h3 id="Learning-Rate-Decay"><a href="#Learning-Rate-Decay" class="headerlink" title="Learning Rate Decay"></a>Learning Rate Decay</h3><p>å½“æˆ‘ä»¬é€‰æ‹©äº†ä¸€ä¸ªåˆé€‚çš„lrï¼Œä½†æ˜¯æŸå¤±è®­ç»ƒåˆ°ä¸€å®šç¨‹åº¦ä»¥åå°±ä¸å†ä¸‹é™äº†ï¼Œå°±åœ¨ä¸€ä¸ªåŒºé—´ä¸­æ¥å›åŠ¨è¡ï¼Œå¯èƒ½æ˜¯å‡ºç°äº†ä¸€ä¸‹çš„é—®é¢˜ï¼š</p>
<p><img src="https://raw.githubusercontent.com/AikenH/md-image/master/img/image-20201205175605729.png" alt="https://raw.githubusercontent.com/AikenH/md-image/master/img/image-20201205175605729.png"></p>
<p>image-20201205175605729</p>
<p>å¯¹è¿™ç§é—®é¢˜çš„è§£å†³å°±æ˜¯é€šè¿‡å­¦ä¹ ç‡è¡°å‡æ¥å®ç°çš„ï¼šå°†å­¦ä¹ ç‡éšç€è®­ç»ƒçš„è¿›è¡Œæ¥è¿›è¡Œè¡°å‡ï¼Œè¿™ä¸ªæ–¹æ³•å°±æ¯”è¾ƒç›´è§‚äº†ã€‚å…·ä½“çš„æ–¹æ³•æè¿°å¯ä»¥åœ¨ <code>../project_note/è®­ç»ƒå‚æ•°è°ƒæ•´ç­–ç•¥.md</code>ä¸­æ‰¾åˆ°ã€‚</p>
<p>ä¹Ÿå¯ä»¥å‚è€ƒå¦‚ä¸‹è¿æ¥ï¼š<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_42662358/article/details/93732852">è¯¦ç»†ç†è§£pytorchçš„å…­ç§å­¦ä¹ ç‡pytorch</a></p>
<h2 id="æŸå¤±å‡½æ•°"><a href="#æŸå¤±å‡½æ•°" class="headerlink" title="æŸå¤±å‡½æ•°"></a>æŸå¤±å‡½æ•°</h2><p>nnä¸­è‡ªå¸¦çš„Loss Functionæ¯”å¦‚è¯´MSEä¹‹ç±»çš„ï¼Œè®¡ç®—å‡ºæ¥çš„å€¼æœ¬èº«å°±å·²ç»å¯¹batchå–äº†å¹³å‡å€¼ï¼ŒåŒæ—¶æˆ‘ä»¬è¿›è¡Œäº¤å‰ç†µçš„è®¡ç®—çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸éœ€è¦å®ç°å¯¹ä»–è¿›è¡Œsoftmaxï¼Œå› ä¸ºå†CEä¸­å·²ç»é›†æˆäº†softmaxçš„æ“ä½œã€‚</p>
<h3 id="CrossEntropyäº¤å‰ç†µ"><a href="#CrossEntropyäº¤å‰ç†µ" class="headerlink" title="CrossEntropyäº¤å‰ç†µ"></a>CrossEntropyäº¤å‰ç†µ</h3><p>è¿™é‡Œä¼šä»‹ç»ä¸€ä¸‹Pytorchä¸­çš„CEæŸå¤±çš„å…·ä½“å®ç°çš„æ–¹æ³•ï¼Œè¿™é‡Œç»™å‡ºä¸‰ç§æ–¹å¼çš„å¯¹æ¯”ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br><span class="hljs-comment"># initial data and calculate method</span><br>input_x = torch.randn((<span class="hljs-number">4</span>,<span class="hljs-number">5</span>))<br>label = torch.tensor((<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>))<br>cri = torch.nn.CrossEntropyLoss()<br>nll_f = torch.nn.NLLLoss()<br><br><span class="hljs-comment"># output softmax and logsoftmax and pred</span><br>softamx_x = torch.softmax(input_x,dim=<span class="hljs-number">1</span>)<br>logsoftmax_x = torch.log(softamx_x)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;softamx_x \n&quot;</span>, softamx_x)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;pre_res \n&quot;</span>, softamx_x.argmax(axis=<span class="hljs-number">1</span>))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;log_softamx_x \n&quot;</span>, logsoftmax_x)<br><br><span class="hljs-comment"># calculate official ce and NLL</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;torch ce \n&quot;</span>,cri(input_x,label))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;nll_cal \n&quot;</span>, nll_f(logsoftmax_x,label))<br><br><span class="hljs-comment"># calculate the manual ce loss we cal</span><br>res = [-logsoftmax_x[i][label[i]] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(label))]<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;manual cal \n&quot;</span>,<span class="hljs-built_in">sum</span>(res)/<span class="hljs-built_in">len</span>(label))<br><br></code></pre></td></tr></table></figure>
<p>å¯ä»¥å‘ç°ä¸‰ç§æ–¹å¼è®¡ç®—å‡ºæ¥çš„æŸå¤±æ˜¯ä¸€æ ·çš„ï¼Œè¿™å°±è¯´æ˜äº†æˆ‘ä»¬åœ¨è®¡ç®—çš„æ—¶å€™è¦è®°ä½ï¼Œceä¸­æ˜¯è‡ªå·±é›†æˆäº†softmaxçš„æ“ä½œï¼ŒåŒæ—¶åœ¨Nllä¸­æ˜¯å­˜åœ¨äº†å–negativeçš„æ“ä½œçš„ã€‚æŒ‰ç…§è¿™ä¸ªæ“ä½œæ‰‹å†Œå»å®ç°è‡ªå·±ç›¸åº”çš„æŸå¤±å‡½æ•°è®¾è®¡</p>
<h2 id="ä¼˜åŒ–å™¨è®¾è®¡"><a href="#ä¼˜åŒ–å™¨è®¾è®¡" class="headerlink" title="ä¼˜åŒ–å™¨è®¾è®¡"></a>ä¼˜åŒ–å™¨è®¾è®¡</h2><p>è¿™ä¸€éƒ¨åˆ†ä¸»è¦æ·»åŠ ä¸€äº›å¸¸è§çš„ä¼˜åŒ–å™¨å‚æ•°çš„è®¾ç½®åŒ…æ‹¬SGDå’ŒAdamçš„å¯¹åº”è®¾ç½®ï¼Œä¸»è¦ä»‹ç»ä¸€ä¸‹è®¾ç½®Adam<br>å®é™…ä¸ŠAdamçš„è®¾ç½®å¯¹äºå­¦ä¹ ç‡æ¥è¯´æ²¡æœ‰é‚£ä¹ˆæ•æ„Ÿï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯è¦äº†è§£å‚æ•°çš„æ„æ€æ‰çŸ¥é“æ€ä¹ˆå»è®¾ç½®è¯¥ä¼˜åŒ–å™¨</p>
<h2 id="æ¨¡å‹å‚æ•°åˆå§‹åŒ–å’Œæ¶æ„æŸ¥çœ‹æ–¹æ³•"><a href="#æ¨¡å‹å‚æ•°åˆå§‹åŒ–å’Œæ¶æ„æŸ¥çœ‹æ–¹æ³•" class="headerlink" title="æ¨¡å‹å‚æ•°åˆå§‹åŒ–å’Œæ¶æ„æŸ¥çœ‹æ–¹æ³•"></a>æ¨¡å‹å‚æ•°åˆå§‹åŒ–å’Œæ¶æ„æŸ¥çœ‹æ–¹æ³•</h2><p>å®é™…ä¸Šå¯¹å‚æ•°åˆå§‹åŒ–ä¹Ÿå°±æ˜¯éœ€è¦å¯¹æ•´ä½“çš„æ¶æ„è¿›è¡Œéå†ï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªä¼šå½’ä¸ºä¸€ä¸ªå­è¯¾é¢˜</p>
<p>å‚æ•°çš„åˆå§‹åŒ–æ–¹æ³•åªè¦ä½¿ç”¨å¦‚ä¸‹çš„æ–¹å¼ï¼Œæ— è®ºæˆ‘ä»¬é‡‡å–é‚£ç§å®šä¹‰çš„æ–¹å¼ï¼Œï¼Œéƒ½èƒ½éå†åˆ°å…¶ä¸­æ‰€åŒ…å«çš„æ‰€æœ‰ç½‘ç»œå±‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å¦‚æœç›´æ¥åœ¨ç½‘ç»œå®šä¹‰çš„æ—¶å€™ç›´æ¥è¿›è¡Œåˆå§‹åŒ–</span><br><span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> self.modules():<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(m,nn.Conv2d):<br>        nn.init.kaiming_normal_(m.weight,mode=<span class="hljs-string">&#x27;fan_out&#x27;</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(m,nn.BatchNorm2d):<br>        nn.init.constant_(m.weight,<span class="hljs-number">1</span>)<br>        nn.init.constant_(m.bias,<span class="hljs-number">1</span>)<br><span class="hljs-comment"># å¦‚æœæ˜¯åœ¨æ¨¡å‹å®šä¹‰çš„å¤–éƒ¨çš„è¯</span><br><span class="hljs-keyword">for</span> layer <span class="hljs-keyword">in</span> model.modules():<br>  <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(layer, torch.nn.Conv2d):<br>      torch.nn.init.kaiming_normal_(layer.weight,mode=<span class="hljs-string">&#x27;fan_out&#x27;</span>, nonlinearity=<span class="hljs-string">&#x27;relu&#x27;</span>)<br>  <span class="hljs-keyword">if</span> layer.bias isnotNone:<br>      torch.nn.init.constant_(layer.bias, val=<span class="hljs-number">0.0</span>)<br>  <span class="hljs-keyword">elif</span> <span class="hljs-built_in">isinstance</span>(layer, torch.nn.BatchNorm2d):<br>      torch.nn.init.constant_(layer.weight, val=<span class="hljs-number">1.0</span>) torch.nn.init.constant_(layer.bias, val=<span class="hljs-number">0.0</span>)<br>  <span class="hljs-keyword">elif</span> <span class="hljs-built_in">isinstance</span>(layer, torch.nn.Linear):<br>      torch.nn.init.xavier_normal_(layer.weight)<br>  <span class="hljs-keyword">if</span> layer.bias isnotNone:<br>      torch.nn.init.constant_(layer.bias, val=<span class="hljs-number">0.0</span>)<br>      layer.weight = torch.nn.Parameter(tensor)<br><span class="hljs-comment"># ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–çš„æ–¹æ³•æ¯”å¦‚parametersï¼Œchildren</span><br><br></code></pre></td></tr></table></figure>
<h3 id="childrenã€modulesã€parametersï¼š"><a href="#childrenã€modulesã€parametersï¼š" class="headerlink" title="childrenã€modulesã€parametersï¼š"></a>childrenã€modulesã€parametersï¼š</h3><p><code>model.modules</code>ä¼šéå†modelä¸­æ‰€æœ‰çš„å­å±‚ï¼Œè€Œ<code>children</code>åªä¼šéå†å½“å‰å±‚ï¼Œä¹Ÿå°±æ˜¯æœ€å¤–å±‚çš„æƒ…å†µï¼Œæ‰€ä»¥å¦‚æœè¦è¿›è¡Œå‚æ•°çš„åˆå§‹åŒ–çš„è¯ï¼Œæœ€å¥½æ˜¯ç”¨ç±»å†…æˆ–è€…ç±»å¤–çš„ä¸¤ç§æ–¹æ³•æ¥å®ç°åˆå§‹åŒ–</p>
<p><code>parameter</code>è¿”å›çš„æ˜¯æ¨¡å‹çš„æ‰€æœ‰å‚æ•°ï¼Œæ‰€ä»¥åˆå§‹åŒ–æœ€å¥½ä½¿ç”¨çš„æ˜¯<code>`modules</code>ï¼Œè€Œparameterä¸€èˆ¬ç”¨æ¥åˆå§‹åŒ–å‚æ•°</p>
<p><strong>ç”¨numelä¸parametersè®¡ç®—å‚æ•°çš„ä¸ªæ•°</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#å¯ä»¥ç®€æ´çš„å†™æˆä¸‹é¢çš„å½¢å¼</span><br><span class="hljs-comment">#numel()å‡½æ•°æœ¬èº«çš„ä½œç”¨æ˜¯è¿”å›æ•°ç»„ä¸­å…ƒç´ çš„ä¸ªæ•°</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">count_parameters</span>(<span class="hljs-params">model</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">sum</span>(P.numel() <span class="hljs-keyword">for</span> P <span class="hljs-keyword">in</span> model.parameters() <span class="hljs-keyword">if</span> P.requires_grad)<br><br><span class="hljs-comment">#å¸®åŠ©ç†è§£çš„ç»“æ„å½¢å¼å¯ä»¥è¡¨è¾¾å¦‚ä¸‹ï¼š</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">count_parameters</span>(<span class="hljs-params">model</span>):<br>    <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> model.parameters():<br>        <span class="hljs-keyword">if</span> p.requires_grad:<br>            ans += p.numel()<br><br></code></pre></td></tr></table></figure>
<h3 id="åˆå§‹åŒ–åŸåˆ™ï¼šï¼ˆç»§ç»­è°ƒç ”ï¼‰"><a href="#åˆå§‹åŒ–åŸåˆ™ï¼šï¼ˆç»§ç»­è°ƒç ”ï¼‰" class="headerlink" title="åˆå§‹åŒ–åŸåˆ™ï¼šï¼ˆç»§ç»­è°ƒç ”ï¼‰"></a>åˆå§‹åŒ–åŸåˆ™ï¼šï¼ˆç»§ç»­è°ƒç ”ï¼‰</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/ys1305/article/details/94332007">pytorchä¸­çš„å‚æ•°åˆå§‹åŒ–æ–¹æ³•æ€»ç»“_ys1305çš„åšå®¢-CSDNåšå®¢_pytorch å‚æ•°åˆå§‹åŒ–</a></p>
<p><strong>Batch-Normalization</strong>ï¼š<a target="_blank" rel="noopener" href="https://www.cnblogs.com/shine-lee/p/11989612.html">Batch Normalizationè¯¦è§£ - shine-lee - åšå®¢å›­ (cnblogs.com)</a></p>
<ul>
<li>convï¼š<code>kaming_normal_</code></li>
<li>fcï¼š<code>constan_,xvaier</code></li>
<li>bnï¼š<code>normal_\constant|</code></li>
</ul>
<h3 id="å…¸å‹çš„å‚æ•°åˆå§‹åŒ–æ–¹æ³•"><a href="#å…¸å‹çš„å‚æ•°åˆå§‹åŒ–æ–¹æ³•" class="headerlink" title="å…¸å‹çš„å‚æ•°åˆå§‹åŒ–æ–¹æ³•"></a>å…¸å‹çš„å‚æ•°åˆå§‹åŒ–æ–¹æ³•</h3><p>EnAETä¸­å¯ä»¥çœ‹åˆ°å‚è€ƒçš„æºç å¦‚ä¸‹ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒBNä¸­åªæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œæ‰€ä»¥ä¸éœ€è¦è¿›è¡Œå‚æ•°çš„åˆå§‹åŒ–ï¼Œæˆ–è€…ç›´æ¥ç½®0ã€1å³å¯.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> self.modules():<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(m,nn.Conv2d):<br>        <span class="hljs-comment"># è®¡ç®—å‚æ•°</span><br>        n = m.kernel_size[<span class="hljs-number">0</span>] * m.kernel_size[<span class="hljs-number">1</span>] * m.out_channels<br>        m.weight.data.normal_(<span class="hljs-number">0</span>,math.sqrt(<span class="hljs-number">2.</span> / n))<br>    <span class="hljs-keyword">elif</span> <span class="hljs-built_in">isinstance</span>(m,nn.BatchNorm2d):<br>        m.weight.data.fill_(<span class="hljs-number">1</span>)<br>        m.bias.data.zero_()<br>    <span class="hljs-keyword">elif</span> <span class="hljs-built_in">isinstance</span>(m, nn.Linear):<br>        nn.init.xavier_normal_(m.weight.data)    <span class="hljs-comment"># what&#x27;s this method</span><br>        m.bias.data.zero_()<br><br></code></pre></td></tr></table></figure>
<h2 id="æ•°æ®ç±»å‹å’Œç»´åº¦"><a href="#æ•°æ®ç±»å‹å’Œç»´åº¦" class="headerlink" title="æ•°æ®ç±»å‹å’Œç»´åº¦"></a>æ•°æ®ç±»å‹å’Œç»´åº¦</h2><p>åœ¨ç®—æ³•ç¼–å†™çš„è¿‡ç¨‹ä¸­ï¼Œæ•°æ®çš„ç±»å‹å’Œç»´åº¦çš„å¯¹é½å’Œchannelæ˜¯å¾ˆé‡è¦çš„ï¼Œåœ¨è¿™é‡Œä¹Ÿå¾ˆå®¹æ˜“å‡ºç°å¾ˆå¤šçš„bugï¼Œåœ¨è¿™é‡Œåšä¸€ä¸ªä¿¡æ¯çš„æ±‡æ€»</p>
<h3 id="è¾“å…¥æ•°æ®çš„é€šé“"><a href="#è¾“å…¥æ•°æ®çš„é€šé“" class="headerlink" title="è¾“å…¥æ•°æ®çš„é€šé“"></a>è¾“å…¥æ•°æ®çš„é€šé“</h3><p>ç»“è®ºï¼špytorchç½‘ç»œè¾“å…¥å›¾ç‰‡çš„shapeè¦æ±‚é€šé“æ˜¯<strong>channel_first</strong>ï¼ˆé€šé“åœ¨å‰ï¼‰çš„ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬çš„å›¾ç‰‡ä¸æ˜¯è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å°±éœ€è¦æ‰§è¡Œç›¸åº”çš„å˜åŒ–ã€‚</p>
<p>TODOï¼šæ•´ç†å„ç§æ•°æ®è¯»å–æ–¹å¼è¯»å…¥çš„channel first æˆ–æ˜¯ last : skimage,PIL,numpy</p>
<p>æ•´ç†ç›¸åº”çš„å„ç§æ•°æ®ç±»å‹è¿›è¡Œtransposeï¼ˆnumpyï¼‰çš„æ–¹å¼</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ä¹Ÿå¯ä»¥ä½¿ç”¨viewå‡½æ•°ï¼Œä½†æ˜¯ç›¸åº”çš„ï¼Œviewéœ€è¦è®¡ç®—å‡ºå„ä¸ªç»´åº¦ç›¸åº”çš„æ•°å€¼</span><br><span class="hljs-comment"># viewï¼ˆï¼‰ç›´æ¥ä½¿ç”¨çš„æ—¶å€™ä¸æ”¹å˜åŸå€¼çš„å¤§å°ï¼Œpermuteä¹Ÿä¸æ”¹å˜ï¼Œä½¿ç”¨çš„æ–¹æ³•ä¸åŒè€Œå·²</span><br><span class="hljs-keyword">if</span> img.shape[-<span class="hljs-number">1</span>] == <span class="hljs-number">3</span>:<br>    img = img.permute(<span class="hljs-number">0</span>,<span class="hljs-number">3</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>)<br><br></code></pre></td></tr></table></figure>
<h3 id="æ ‡ç­¾çš„å½¢å¼è½¬æ¢one-hot"><a href="#æ ‡ç­¾çš„å½¢å¼è½¬æ¢one-hot" class="headerlink" title="æ ‡ç­¾çš„å½¢å¼è½¬æ¢one-hot"></a>æ ‡ç­¾çš„å½¢å¼è½¬æ¢one-hot</h3><p>è¿›è¡Œè®­ç»ƒä¹‹å‰è¦å°†æ•°æ®è½¬åŒ–ä¸ºonehotçš„å½¢å¼ï¼Œæ‰èƒ½è¾“å…¥è®­ç»ƒï¼Œè€Œä¸”ä¸€èˆ¬å› ä¸ºæ˜¯batch_sizeçš„å½¢å¼ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è½¬åŒ–ä¸ºçŸ©é˜µå½¢å¼çš„onehotï¼Œä¸èƒ½ç”¨å•ä¸ªlabelçš„è½¬åŒ–æ–¹æ³•ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">make_onehot_single</span>(<span class="hljs-params">num,index</span>):<br>    <span class="hljs-string">&#x27;&#x27;&#x27;æ ¹æ®ç±»åˆ«æ•°é‡å’Œindexç”Ÿæˆsingleï¼Œonehot&#x27;&#x27;&#x27;</span><br>    <span class="hljs-comment"># BTWï¼šscatteræ–¹æ³•ä¹Ÿèƒ½ç”Ÿæˆone-hot</span><br>    onehot = torch.zeros(num)<br>    onehot[index] = <span class="hljs-number">1.0</span><br><br>    <span class="hljs-keyword">return</span> onehot<br><br><span class="hljs-comment"># ä¸»è¦æ˜¯ä¸‹é¢è¿™ç§æ–¹æ³•éœ€è¦æŒæ¡ï¼Œ</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">make_onehot_array</span>(<span class="hljs-params">width,target</span>):<br>    <span class="hljs-string">&#x27;&#x27;&#x27;æ ¹æ®labelç”ŸæˆonehotçŸ©é˜µã€‚</span><br><span class="hljs-string">    widthï¼šç±»åˆ«æ•° targetï¼šå…·ä½“çš„labeldata&#x27;&#x27;&#x27;</span><br>    <span class="hljs-keyword">try</span>:<br>        length = <span class="hljs-built_in">len</span>(target.view(-<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))<br>    <span class="hljs-keyword">except</span> ValueError:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;the type of target is &#123;&#125; &#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">type</span>(target)))<br>        <span class="hljs-built_in">print</span>(target)<br>        <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&#x27;break down&#x27;</span>)<br>    onehot = torch.zeros(length, width).scatter_(<span class="hljs-number">1</span>,target.view(-<span class="hljs-number">1</span>,<span class="hljs-number">1</span>),<span class="hljs-number">1</span>)<br><br>    <span class="hljs-keyword">return</span> onehot<br><br></code></pre></td></tr></table></figure>
<h1 id="Visualize-å¯è§†åŒ–éƒ¨åˆ†"><a href="#Visualize-å¯è§†åŒ–éƒ¨åˆ†" class="headerlink" title="Visualize å¯è§†åŒ–éƒ¨åˆ†"></a>Visualize å¯è§†åŒ–éƒ¨åˆ†</h1><h2 id="Tensorboard-in-Pytorch"><a href="#Tensorboard-in-Pytorch" class="headerlink" title="Tensorboard in Pytorch"></a>Tensorboard in Pytorch</h2><p>@Aiken H 2021 review  ä¹‹å‰è¿™ä¸€éƒ¨åˆ†çš„projectionå’Œmodeléƒ½æ²¡æœ‰æˆåŠŸæ˜¾ç¤ºï¼Œè¿™æ¬¡åœ¨æ–°æ¡†æ¶ä¸­å±•ç¤ºä¸€ä¸‹ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://pytorch.org/tutorials/intermediate/tensorboard_tutorial.html">Visualizing Models, Data, and Training with TensorBoard - PyTorch Tutorials 1.8.1+cu102 documentation</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/bigbennyguo/article/details/87956434">è¯¦è§£PyTorché¡¹ç›®ä½¿ç”¨TensorboardXè¿›è¡Œè®­ç»ƒå¯è§†åŒ–_æµ…åº¦å¯º-CSDNåšå®¢_tensorboardx</a></p>
<p><a target="_blank" rel="noopener" href="https://pytorch.apachecn.org/#/docs/1.7/17?id=ä½¿ç”¨-tensorboard-å¯è§†åŒ–æ¨¡å‹ï¼Œæ•°æ®å’Œè®­ç»ƒ">ä½¿ç”¨ TensorBoard å¯è§†åŒ–æ¨¡å‹ï¼Œæ•°æ®å’Œè®­ç»ƒ (apachecn.org)</a></p>
<p>åœ¨pytorchæ•™ç¨‹ä¸­çš„Projectionå¯ä»¥ç»“åˆåç»­è¾“å‡ºçš„Featureä½¿ç”¨æ¥åˆ†æç›¸åº”çš„èšç±»å’Œåˆ†ç±»å¯é æ€§</p>
<p>å¯ä»¥å°è¯•ä½¿ç”¨ï¼Œæ•™ç¨‹å†™çš„å¾ˆç®€å•æ˜“æ‡‚ã€‚</p>
<h3 id="Histogram-ç›´æ–¹å›¾å‚æ•°ç»Ÿè®¡"><a href="#Histogram-ç›´æ–¹å›¾å‚æ•°ç»Ÿè®¡" class="headerlink" title="Histogram ç›´æ–¹å›¾å‚æ•°ç»Ÿè®¡"></a>Histogram ç›´æ–¹å›¾å‚æ•°ç»Ÿè®¡</h3><p>ä¸€èˆ¬æ¥è¯´ç”¨æ¥ç»Ÿè®¡æ¨¡å‹ä¸­é—´çš„ä¸€äº›å‚æ•°çš„åˆ†å¸ƒæƒ…å†µï¼Œå…·ä½“çš„ä½¿ç”¨åœ¨è®­ç»ƒçš„epochä¹‹é—´ï¼Œå’Œvalæ˜¯ä¸€ä¸ªæ¯”è¾ƒç±»ä¼¼çš„æœºåˆ¶ï¼Œå…·ä½“çš„ä»£ç æ ·ä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># visualize those parameter as historgram</span><br><span class="hljs-comment"># we can add other model here</span><br><span class="hljs-keyword">if</span> i % <span class="hljs-number">10</span> == <span class="hljs-number">0</span>:<br>    <span class="hljs-keyword">for</span> name,param <span class="hljs-keyword">in</span> self.main_model.named_parameters():<br>        self.writer.add_histogram(<span class="hljs-string">&#x27;main_model&#x27;</span>+name,param.clone().cpu().data.numpy(),i)<br>    <span class="hljs-keyword">pass</span><br></code></pre></td></tr></table></figure>
<h3 id="Embedding-Projection"><a href="#Embedding-Projection" class="headerlink" title="Embedding Projection"></a>Embedding Projection</h3><p>@Aiken H 2021 è¿™ä¸€éƒ¨åˆ†å¯èƒ½æ‰æ˜¯ç¥ç»ç½‘ç»œçš„ç‰¹å¾åˆ†å¸ƒçš„å¯è§†åŒ–å›¾ã€‚</p>
<p>ä¸‹é¢è¿™ä¸ªæ˜¯Googleçš„Embedding Projectionï¼Œéœ€è¦ä¸Šä¼ .tsvä¿å­˜çš„æ•°æ®ï¼Œä½†æ˜¯å®é™…ä¸Šå°±æ˜¯Tensorboardä¸Šä¹Ÿæœ‰é›†æˆçš„åŠŸèƒ½</p>
<p><a target="_blank" rel="noopener" href="http://projector.tensorflow.org/">Embedding projector - visualization of high-dimensional data</a></p>
<p><a target="_blank" rel="noopener" href="https://www.tensorflow.org/tensorboard/tensorboard_projector_plugin">Visualizing Data using the Embedding Projector in TensorBoard</a></p>
<h3 id="PR-CURVE"><a href="#PR-CURVE" class="headerlink" title="PR_CURVE"></a>PR_CURVE</h3><p>è¿™é‡Œä¼šè´´ä¸Špr_curveä¸­éœ€è¦çš„å‚æ•°å’Œæˆ‘ä»¬è¿™è¾¹ç¼–å†™çš„ç¤ºä¾‹ä»£ç </p>
<h3 id="Add-TEXT"><a href="#Add-TEXT" class="headerlink" title="Add_TEXT"></a>Add_TEXT</h3><p>æ¢è¡Œå¤±æ•ˆé—®é¢˜, è¿™æ˜¯å› ä¸ºåœ¨Tensorboardä¸­è¿™ä¸€éƒ¨åˆ†ä½¿ç”¨çš„æ˜¯Markdownçš„æ ¼å¼, æ‰€ä»¥åœ¨è¿™é‡Œæˆ‘ä»¬åœ¨æ¢è¡Œç¬¦<code>\n</code>ä¹‹å‰, éœ€è¦ä¿ç•™ä¸¤ä¸ªç©ºæ ¼æ‰èƒ½å®ç°çœŸæ­£çš„æ¢è¡Œ</p>
<h3 id="ADD-Figure"><a href="#ADD-Figure" class="headerlink" title="ADD_Figure"></a>ADD_Figure</h3><p>æœ‰æ—¶å€™æˆ‘ä»¬ä¼šå‘ç°æˆ‘ä»¬ç¼–å†™çš„figureåœ¨stepä¸­æ²¡æœ‰å…¨éƒ¨ç°å®å‡ºæ¥, è¿™æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡å¯åŠ¨å‘½ä»¤æ¥å±•ç¤ºæ‰€æœ‰çš„å›¾ç‰‡</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">--samples_per_plugin images=<span class="hljs-number">9999</span><br><span class="hljs-comment"># 999 &gt; the num you want to displ</span><br></code></pre></td></tr></table></figure>
<h2 id="å¯è§†åŒ–ç¥ç»ç½‘ç»œçƒ­åŠ›å›¾ï¼ˆCAMï¼‰"><a href="#å¯è§†åŒ–ç¥ç»ç½‘ç»œçƒ­åŠ›å›¾ï¼ˆCAMï¼‰" class="headerlink" title="å¯è§†åŒ–ç¥ç»ç½‘ç»œçƒ­åŠ›å›¾ï¼ˆCAMï¼‰"></a>å¯è§†åŒ–ç¥ç»ç½‘ç»œçƒ­åŠ›å›¾ï¼ˆCAMï¼‰</h2><p>@Aiken2020 ä¸ºäº†ä¾¿äºæŸ¥çœ‹ç¥ç»ç½‘ç»œçš„<strong>è¾“å‡º</strong>ï¼Œå¯¹äºå›¾åƒçš„å“ªä¸€éƒ¨åˆ†<strong>æ›´åŠ çš„ä¾§é‡</strong>ï¼Œä¹Ÿå°±æ˜¯æŒ‡å¯¼ç½‘ç»œè¿›è¡Œåˆ†ç±»çš„ä¸»è¦æ˜¯å›¾åƒçš„å“ªäº›åŒºåŸŸï¼Œï¼ˆç›¸åº”çš„ä¹Ÿå¯ä»¥æŒ‰ç…§ç±»ä¼¼çš„æ–¹æ³•æŸ¥çœ‹Attention Networkçš„æ•ˆæœæŠŠï¼‰ï¼Œå°±æƒ³ç€<strong>å¯è§†åŒ–ä¸€ä¸‹CAM</strong>ã€‚çœ‹æŒ‡å¯¼åˆ†ç±»çš„é«˜å“åº”åŒºåŸŸæ˜¯å¦è½åœ¨æ ¸å¿ƒåŒºåŸŸã€‚</p>
<p>å‚è€ƒé“¾æ¥ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/sinat_37532065/article/details/103362517">CAM Pytorch</a></p>
<h3 id="ç®—æ³•åŸç†"><a href="#ç®—æ³•åŸç†" class="headerlink" title="ç®—æ³•åŸç†"></a>ç®—æ³•åŸç†</h3><p>å…¶è®¡ç®—æ–¹æ³•å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚å¯¹äºä¸€ä¸ªCNNæ¨¡å‹ï¼Œå¯¹å…¶æœ€åä¸€ä¸ªfeaturemapåšå…¨å±€å¹³å‡æ± åŒ–ï¼ˆGAPï¼‰è®¡ç®—å„é€šé“å‡å€¼ï¼Œç„¶åé€šè¿‡FCå±‚ç­‰æ˜ å°„åˆ°class scoreï¼Œæ‰¾å‡ºargmaxï¼Œ<strong>è®¡ç®—æœ€å¤§çš„é‚£ä¸€ç±»çš„è¾“å‡ºç›¸å¯¹äºæœ€åä¸€ä¸ªfeaturemapçš„æ¢¯åº¦</strong>ï¼ˆå®é™…ä¸Šå°±æ˜¯æœ€åä¸€ä¸ªmapä¸­å“ªäº›å¯¹äºåˆ†ç±»çš„å˜åŒ–å…¶æ›´å¤§çš„ä½œç”¨ï¼Œä¹Ÿå°±æ˜¯ç±»ä¼¼æƒé‡çš„æœºåˆ¶ï¼‰ï¼Œå†æŠŠè¿™ä¸ªæ¢¯åº¦å¯è§†åŒ–åˆ°åŸå›¾ä¸Šå³å¯ã€‚ç›´è§‚æ¥è¯´ï¼Œå°±æ˜¯çœ‹ä¸€ä¸‹<strong>ç½‘ç»œæŠ½å–åˆ°çš„é«˜å±‚ç‰¹å¾çš„å“ªéƒ¨åˆ†å¯¹æœ€ç»ˆçš„classifierå½±å“æ›´å¤§</strong>ã€‚</p>
<p><img src="https://raw.githubusercontent.com/AikenH/md-image/master/img/20191203102807477.png" alt="ImgInGIthu"></p>
<ul>
<li><p>Quote: æ‰¾åˆ°äº†ä¸€ç¯‡åŸºäºKerasçš„CAMå®ç°ï¼Œæ„Ÿè°¢ï¼š</p>
<p>  <a target="_blank" rel="noopener" href="https://blog.csdn.net/Einstellung/article/details/82858974">https://blog.csdn.net/Einstellung/article/details/82858974</a> ä½†æ˜¯æˆ‘è¿˜æ˜¯ä¹ æƒ¯ç”¨Pytorchä¸€ç‚¹ï¼Œæ‰€ä»¥å‚è€ƒç€æ”¹äº†ä¸€ç‰ˆPytorchçš„å®ç°ã€‚å…¶ä¸­ï¼Œæœ‰ä¸€ä¸ªåœ°æ–¹å›°æ‰°äº†ä¸€ä¸‹ï¼Œå› ä¸ºPytorchçš„è‡ªåŠ¨æ±‚å¯¼æœºåˆ¶ï¼Œä¸€èˆ¬åªä¼šä¿å­˜å‡½æ•°å€¼å¯¹è¾“å…¥çš„å¯¼æ•°å€¼ï¼Œè€Œä¸­é—´å˜é‡çš„å¯¼æ•°å€¼éƒ½æ²¡æœ‰ä¿ç•™ï¼Œè€Œæ­¤å¤„æˆ‘ä»¬éœ€è¦è®¡ç®—è¾“å‡ºå±‚ç›¸å¯¹äºæœ€åä¸€ä¸ªfeature mapæ¢¯åº¦ï¼Œæ‰€ä»¥å‚è€ƒ<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_27061325/article/details/84728539è§£å†³äº†è¯¥é—®é¢˜ã€‚">https://blog.csdn.net/qq_27061325/article/details/84728539è§£å†³äº†è¯¥é—®é¢˜ã€‚</a></p>
</li>
</ul>
<h3 id="ä»£ç å®ç°ï¼š"><a href="#ä»£ç å®ç°ï¼š" class="headerlink" title="ä»£ç å®ç°ï¼š"></a>ä»£ç å®ç°ï¼š</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> cv2<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">draw_CAM</span>(<span class="hljs-params">model, img_path, save_path, transform=<span class="hljs-literal">None</span>, visual_heatmap=<span class="hljs-literal">False</span></span>):<br>    <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    ç»˜åˆ¶ Class Activation Map</span><br><span class="hljs-string">    :param model: åŠ è½½å¥½æƒé‡çš„Pytorch model</span><br><span class="hljs-string">    :param img_path: æµ‹è¯•å›¾ç‰‡è·¯å¾„</span><br><span class="hljs-string">    :param save_path: CAMç»“æœä¿å­˜è·¯å¾„</span><br><span class="hljs-string">    :param transform: è¾“å…¥å›¾åƒé¢„å¤„ç†æ–¹æ³•</span><br><span class="hljs-string">    :param visual_heatmap: æ˜¯å¦å¯è§†åŒ–åŸå§‹heatmapï¼ˆè°ƒç”¨matplotlibï¼‰</span><br><span class="hljs-string">    :return:</span><br><span class="hljs-string">    &#x27;&#x27;&#x27;</span><br>    <span class="hljs-comment"># å›¾åƒåŠ è½½&amp;é¢„å¤„ç†</span><br>    img = Image.<span class="hljs-built_in">open</span>(img_path).convert(<span class="hljs-string">&#x27;RGB&#x27;</span>)<br>    <span class="hljs-keyword">if</span> transform:<br>        img = transform(img)<br>    img = img.unsqueeze(<span class="hljs-number">0</span>)<br><br>    <span class="hljs-comment"># è·å–æ¨¡å‹è¾“å‡ºçš„feature/score</span><br>    model.<span class="hljs-built_in">eval</span>()<br>    features = model.features(img)<br>    output = model.classifier(features)<br><br>    <span class="hljs-comment"># ä¸ºäº†èƒ½è¯»å–åˆ°ä¸­é—´æ¢¯åº¦å®šä¹‰çš„è¾…åŠ©å‡½æ•°</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">extract</span>(<span class="hljs-params">g</span>):<br>        <span class="hljs-keyword">global</span> features_grad<br>        features_grad = g<br><br>    <span class="hljs-comment"># é¢„æµ‹å¾—åˆ†æœ€é«˜çš„é‚£ä¸€ç±»å¯¹åº”çš„è¾“å‡ºscore</span><br>    pred = torch.argmax(output).item()<br>    pred_class = output[:, pred]<br><br>    features.register_hook(extract)<br>    pred_class.backward() <span class="hljs-comment"># è®¡ç®—æ¢¯åº¦</span><br><br>    grads = features_grad   <span class="hljs-comment"># è·å–æ¢¯åº¦</span><br><br>    pooled_grads = torch.nn.functional.adaptive_avg_pool2d(grads, (<span class="hljs-number">1</span>, <span class="hljs-number">1</span>))<br><br>    <span class="hljs-comment"># æ­¤å¤„batch sizeé»˜è®¤ä¸º1ï¼Œæ‰€ä»¥å»æ‰äº†ç¬¬0ç»´ï¼ˆbatch sizeç»´ï¼‰</span><br>    pooled_grads = pooled_grads[<span class="hljs-number">0</span>]<br>    features = features[<span class="hljs-number">0</span>]<br>    <span class="hljs-comment"># 512æ˜¯æœ€åä¸€å±‚featureçš„é€šé“æ•°</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">512</span>):<br>        features[i, ...] *= pooled_grads[i, ...]<br><br>    <span class="hljs-comment"># ä»¥ä¸‹éƒ¨åˆ†åŒKerasç‰ˆå®ç°</span><br>    heatmap = features.detach().numpy()<br>    heatmap = np.mean(heatmap, axis=<span class="hljs-number">0</span>)<br><br>    heatmap = np.maximum(heatmap, <span class="hljs-number">0</span>)<br>    heatmap /= np.<span class="hljs-built_in">max</span>(heatmap)<br><br>    <span class="hljs-comment"># å¯è§†åŒ–åŸå§‹çƒ­åŠ›å›¾</span><br>    <span class="hljs-keyword">if</span> visual_heatmap:<br>        plt.matshow(heatmap)<br>        plt.show()<br><br>    img = cv2.imread(img_path)  <span class="hljs-comment"># ç”¨cv2åŠ è½½åŸå§‹å›¾åƒ</span><br>    heatmap = cv2.resize(heatmap, (img.shape[<span class="hljs-number">1</span>], img.shape[<span class="hljs-number">0</span>]))  <span class="hljs-comment"># å°†çƒ­åŠ›å›¾çš„å¤§å°è°ƒæ•´ä¸ºä¸åŸå§‹å›¾åƒç›¸åŒ</span><br>    heatmap = np.uint8(<span class="hljs-number">255</span> * heatmap)  <span class="hljs-comment"># å°†çƒ­åŠ›å›¾è½¬æ¢ä¸ºRGBæ ¼å¼</span><br>    heatmap = cv2.applyColorMap(heatmap, cv2.COLORMAP_JET)  <span class="hljs-comment"># å°†çƒ­åŠ›å›¾åº”ç”¨äºåŸå§‹å›¾åƒ</span><br>    superimposed_img = heatmap * <span class="hljs-number">0.4</span> + img  <span class="hljs-comment"># è¿™é‡Œçš„0.4æ˜¯çƒ­åŠ›å›¾å¼ºåº¦å› å­</span><br>    cv2.imwrite(save_path, superimposed_img)  <span class="hljs-comment"># å°†å›¾åƒä¿å­˜åˆ°ç¡¬ç›˜</span><br><br></code></pre></td></tr></table></figure>
<h2 id="BUGs"><a href="#BUGs" class="headerlink" title="BUGs"></a>BUGs</h2><p>å¦‚æœæƒ³è¦å±•ç¤ºå‡ºæ‰€æœ‰stepçš„å›¾ç‰‡, æˆ‘ä»¬å¯ä»¥åœ¨å‘½ä»¤è¡Œé‡Œæ‰§è¡Œtensoroardçš„æ—¶å€™æ‰§è¡Œä¸‹åˆ—å‘½ä»¤.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">tensorboard --logdir <span class="hljs-built_in">log</span>/cifar100_resnet18 --samples_per_plugin images=999999<br></code></pre></td></tr></table></figure>
<h1 id="DEBUG"><a href="#DEBUG" class="headerlink" title="DEBUG"></a>DEBUG</h1><h2 id="1-ImportError-cannot-import-name-â€˜PILLOW-VERSIONâ€™"><a href="#1-ImportError-cannot-import-name-â€˜PILLOW-VERSIONâ€™" class="headerlink" title="1.ImportError: cannot import name â€˜PILLOW_VERSIONâ€™"></a>1.ImportError: cannot import name â€˜PILLOW_VERSIONâ€™</h2><p>PILç‰ˆæœ¬è¿‡é«˜ï¼Œæ¢ä½å°±å¯ä»¥ï¼Œä»–ä¸é…æ˜¯ä¸€ä¸ªæ£˜æ‰‹çš„é—®é¢˜</p>
<p><code>pip install Pillow==6.2.2 --user</code></p>
<h2 id="2-æ¨¡å‹å‚æ•°-amp-è®¡ç®—é‡ç»Ÿè®¡-and-Debugè¾“å‡º"><a href="#2-æ¨¡å‹å‚æ•°-amp-è®¡ç®—é‡ç»Ÿè®¡-and-Debugè¾“å‡º" class="headerlink" title="2.æ¨¡å‹å‚æ•°&amp;è®¡ç®—é‡ç»Ÿè®¡ and Debugè¾“å‡º"></a>2.æ¨¡å‹å‚æ•°&amp;è®¡ç®—é‡ç»Ÿè®¡ and Debugè¾“å‡º</h2><ol>
<li>ç”¨æ¥è®¡ç®—æ¨¡å‹æ„å»ºä¸­ç½‘ç»œçš„å‚æ•°ï¼Œç©ºé—´å¤§å°ï¼ŒMAddï¼ŒFLOPsç­‰æŒ‡æ ‡ï¼Œcount_paramså¾ˆå¥½å†™ï¼Œç„¶åå‰©ä¸‹çš„è®¡ç®—æˆ‘ä»¬äº¤ç»™ä¸¤ä¸ªç¬¬ä¸‰æ–¹çš„åº“æ¥å®ç°ï¼š<code>torchstat</code>,<code>thop</code></li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> torchstat <span class="hljs-keyword">import</span> stat<br>stat(model,(<span class="hljs-number">3</span>,<span class="hljs-number">224</span>,<span class="hljs-number">224</span>)) <span class="hljs-comment">#thatâ€˜s all using it in the eval stage</span><br><br></code></pre></td></tr></table></figure>
<ol>
<li>ä¹Ÿå¯ä»¥ä½¿ç”¨<code>torchsummary</code>æ¥æŸ¥çœ‹å„å±‚è¾“å‡ºçš„æ•°æ®çš„ç»´åº¦æ•°ç›®</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> torchsummary <span class="hljs-keyword">import</span> summary<br>summary(model.cuda(),input_size=(<span class="hljs-number">3</span>,<span class="hljs-number">224</span>,<span class="hljs-number">224</span>),batch_size=<span class="hljs-number">1</span>)<br><br></code></pre></td></tr></table></figure>
<ol>
<li>ç›¸åº”çš„Debugè¿˜å¯ä»¥ä½¿ç”¨<code>torchsnooper</code>è¿›è¡Œï¼šå˜é‡çš„ç±»å‹å’Œç»´åº¦è¿½è¸ªè¿™ä¸ªæ¨¡å—é€šè¿‡<code>@xxxx</code>ä¿®é¥°å™¨çš„æ–¹æ³•è°ƒç”¨åœ¨æŒ‡å®šçš„methodå‰é¢ï¼Œèƒ½å¤Ÿåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­è¾“å‡ºä¸€äº›<strong>å‚æ•°å€¼çš„ç±»å‹</strong>å’Œ<strong>æ•°å€¼å˜åŒ–</strong>çš„è¾ƒä¸ºè¯¦ç»†çš„ä¿¡æ¯ã€‚ä¸ªäººç†è§£çš„æœ€ä½³ä½¿ç”¨ç¯å¢ƒæ˜¯ï¼Œç”¨äºè°ƒè¯•æˆ–è€…ç›‘æ§<strong>ç±»å‹ä¹‹é—´çš„é”™è¯¯</strong>ã€‚</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># è¿™ä¸ªpackageå¦‚æœæ²¡è®°é”™çš„è¯å¥½åƒæ˜¯ä½¿ç”¨è£…é¥°å™¨çš„æ–¹æ³•å»è¿›è¡Œæµ‹è¯•</span><br><span class="hljs-meta">@...</span><br>method()<br><br></code></pre></td></tr></table></figure>
<h2 id="3-PyTorchåŠ è½½é¢„è®­ç»ƒæ¨¡å‹"><a href="#3-PyTorchåŠ è½½é¢„è®­ç»ƒæ¨¡å‹" class="headerlink" title="3.PyTorchåŠ è½½é¢„è®­ç»ƒæ¨¡å‹"></a>3.PyTorchåŠ è½½é¢„è®­ç»ƒæ¨¡å‹</h2><p>å…·ä½“é”™è¯¯ï¼šåœ¨äºæ¨¡å‹Dictä¸­çš„Keyå’Œé¢„è®­ç»ƒmodelä¸­çš„Keyä¸å¯¹åº”ï¼Œæ— æ³•åŒ¹é…ã€‚</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs json">Unexpected key(s) in state_dict<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;module.features. ...&quot;</span>.ï¼ŒExpected <span class="hljs-string">&quot;.features....&quot;</span><br><br></code></pre></td></tr></table></figure>
<p>é—®é¢˜åˆ†æï¼š</p>
<p><strong>situation1</strong>ï¼šå¯ä»¥çœ‹åˆ°å‰é¢å¤šäº†moduleè¿™ä¸ªstrï¼Œè¿™ä¸€èˆ¬æ˜¯ç”±äºå…¶ä¸­ä¸€æ–¹ä½¿ç”¨äº†å¤šGPUè®­ç»ƒåç›´æ¥ä¿å­˜çš„ï¼Œä¹Ÿå°±æ˜¯<code>DataParallel</code>æ¨¡å¼ä¸‹å¯¼è‡´çš„ä¸åŒ¹é…é—®é¢˜ã€‚</p>
<p><strong>solution1</strong>ï¼š <a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_32998593/article/details/89343507">å‚è€ƒèµ„æ–™</a></p>
<ol>
<li>loadæ¨¡å‹åå»æ‰å¤šä½™çš„å‚æ•°åœ¨äº‹å…ˆçš„æ—¶å€™å‘ç°è¿™ä¸ªæ–¹æ³•è¿˜æ˜¯å­˜åœ¨é—®é¢˜çš„ï¼Œå¹¶ä¸æ˜¯ç®€å•çš„dictå°è£…çš„ç»“æ„ï¼Œæ‰€ä»¥æ²¡æ³•è¿™æ ·ç®€å•çš„è¿›è¡Œèµ‹å€¼å¤„ç†:x:</li>
<li>ç”¨ç©ºç™½ä»£æ›¿moduleï¼Œæš‚æ—¶è¿˜æ²¡å°è¯•ï¼Œä½†æ˜¯æˆ‘è§‰å¾—ä¼šé‡åˆ°å’Œç¬¬ä¸€ä¸ªä¸€æ ·çš„é—®é¢˜:x:</li>
<li><p>:zap:æœ€ç®€å•çš„æ–¹æ³•ï¼šåŠ è½½æ¨¡å‹åå°†æ¨¡å‹è¿›è¡ŒDataParallelï¼Œå†è¿›è¡Œæ•°æ®çš„è½¬åŒ–ï¼Œå°†æ•°æ®è¿›è¡Œå¹¶è¡ŒåŒ–ã€‚å…·ä½“çš„æ“ä½œå¦‚ä¸‹</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">model.cuda()<br><span class="hljs-comment"># å°†idsè®¾ç½®æˆæ‹¥æœ‰çš„GPUå³å¯ï¼Œä½†æ˜¯ä¸çŸ¥é“å•GPUçš„æƒ…å†µå¯ä¸å¯ä»¥å®ç°è¿™ç§æƒ…å†µ</span><br>model = nn.DataParallel(model, device_ids=<span class="hljs-literal">None</span>)<br><br></code></pre></td></tr></table></figure>
</li>
</ol>
<p><strong>Situation2ï¼š</strong> ä¿å­˜æ¨¡å‹æ ¼å¼ä¸º.pth.tarï¼Œæ— æ³•è½½å…¥è®­ç»ƒå¥½çš„æ¨¡å‹</p>
<p><strong>Solution2</strong>ï¼š</p>
<p>åŸå› æ˜¯å› ä¸ºè¢«ä¿å­˜çš„æ¨¡å‹æ˜¯åœ¨é«˜ç‰ˆæœ¬çš„pytorchä¸‹å®ç°çš„ï¼Œä½†æ˜¯å†ä½ç‰ˆæœ¬ä¸­è¯»å–çš„æ¨¡å‹æ˜¯.pthæ ¼å¼çš„ï¼Œå°±ä¼šå‡ºç°ç‰ˆæœ¬å†²çªã€‚<br>è§£å†³æ–¹æ³•å¦‚ä¸‹ğŸ‘‡ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># åœ¨é«˜ç‰ˆæœ¬çš„ç¯å¢ƒä¸­load modelï¼Œç„¶åå†é‡æ–°ä¿å­˜ï¼Œä¿å­˜çš„æ—¶å€™æ·»åŠ å‚æ•°ï¼Œä½¿å¾—ä¿å­˜æˆæ—§ç‰ˆæœ¬å³å¯</span><br>torch.save(checkpoint,save_path,_use_new_zipfile_serialization=<span class="hljs-literal">False</span>)<br><span class="hljs-comment"># DONE</span><br><br></code></pre></td></tr></table></figure>
<p><strong>xxx is a zip archive(did you mean to use torch.jit.load()?)</strong></p>
<p>ä½¿ç”¨ä½ç‰ˆæœ¬çš„Torchå»Loadé«˜ç‰ˆæœ¬ï¼ˆ&gt;1.6ï¼‰ä¿å­˜çš„æ¨¡å‹ï¼ˆ.pth.tarï¼‰é‡åˆ°çš„é—®é¢˜,</p>
<p>è¿™ç§é”™è¯¯ï¼Œä¸»è¦æ˜¯æ¨¡å‹çš„ç‰ˆæœ¬å†²çªã€‚</p>
<p><strong>è§£å†³åŠæ³•</strong>ï¼šåœ¨é«˜ç‰ˆæœ¬çš„ç¯å¢ƒä¸­ï¼Œé‡æ–°loadæ¨¡å‹ï¼Œç„¶åç›´æ¥saveï¼Œåœ¨ä¿å­˜çš„æ—¶å€™æ·»åŠ å‚æ•°</p>
<p><code>torch.save(model.state_dict(),model_path,_use_new_zipfile_serialization=False)</code></p>
<p>å°±å¯ä»¥ä¿å­˜æˆ.pthçš„æ¨¡å‹ï¼Œä¹Ÿèƒ½åœ¨ä½ç‰ˆæœ¬çš„torchç¯å¢ƒä¸­ä½¿ç”¨äº†</p>
<h2 id="4-some-of-the-strides-of-a-given-numpy-array-are-negative"><a href="#4-some-of-the-strides-of-a-given-numpy-array-are-negative" class="headerlink" title="4.some of the strides of a given numpy array are negative."></a>4.some of the strides of a given numpy array are negative.</h2><p>verï¼štorch1.2 è¿™ä¸ªé—®é¢˜å¯èƒ½ä¼šåœ¨åç»­çš„ç‰ˆæœ¬ä¸­è¢«ä¼˜åŒ–ã€‚</p>
<p><strong>Situation</strong>ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/devilmaycry812839668/p/13761613.html">https://www.cnblogs.com/devilmaycry812839668/p/13761613.html</a><br>é—®é¢˜å‡ºç°åœ¨flatæ“ä½œä¸­ï¼Œåå‘åˆ‡ç‰‡<code>[::-1]</code>ä¼šå¯¼è‡´æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸Šä¸è¿ç»­ï¼Œåœ¨æ—§ç‰ˆæœ¬ä¸­æ— æ³•å®ç°ï¼Œå¯¹è¿™æ ·æ•°æ®è¿›è¡Œå­˜å‚¨ã€‚<br><strong>Solution1</strong>:<br>æ‰€ä»¥åœ¨æ‰§å€’æ’åˆ‡ç‰‡çš„æ—¶å€™æ‰§è¡Œï¼Œ<code>img2 = np.ascontiguousarray(img)</code>  ä½¿å¾—æ•°æ®åœ¨å†…å­˜ç©ºé—´ä¸Šè¿ç»­ã€‚</p>
<p><strong>Solution2</strong>:</p>
<p>æˆ–è€…æ‰§è¡Œå€’æ’åˆ‡ç‰‡çš„æ—¶å€™ï¼Œç›´æ¥<code>return img.copy()</code></p>
<h2 id="5-è¯»å–loaderçš„æ—¶å€™å›¾åƒçš„å¤§å°ä¸ä¸€"><a href="#5-è¯»å–loaderçš„æ—¶å€™å›¾åƒçš„å¤§å°ä¸ä¸€" class="headerlink" title="5.è¯»å–loaderçš„æ—¶å€™å›¾åƒçš„å¤§å°ä¸ä¸€"></a>5.è¯»å–loaderçš„æ—¶å€™å›¾åƒçš„å¤§å°ä¸ä¸€</h2><p>ä½¿ç”¨Cropå¯¹å›¾åƒè¿›è¡Œå¤„ç†çš„æ—¶å€™ï¼Œä¸æ³¨æ„çš„è¯å°±æ˜¯ä¼šå‡ºç°è¿™æ ·çš„é—®é¢˜ï¼Œå›¾åƒçš„sizeéšæœºæ”¹å˜ï¼Œå¯¼è‡´çš„è¾“å‡ºä¸ç»Ÿä¸€ã€‚ä¹Ÿå¯èƒ½æ˜¯Cropå‡½æ•°å†™çš„æœ‰é—®é¢˜ã€‚</p>
<p><strong>bug info</strong>å¦‚ä¸‹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ RuntimeError: invalid argument 0: Sizes of tensors must match except <span class="hljs-keyword">in</span> dimension 0. Got 182 and 360 <span class="hljs-keyword">in</span> dimension 2<br><br></code></pre></td></tr></table></figure>
<p><strong>Solutionï¼š</strong></p>
<p>resizeï¼Œsppï¼Œpaddingï¼Œ<strong>adaptiveMaxPooling</strong>ï¼ˆè‡ªé€‚åº”çš„poolingï¼Œpoolingåˆ°æŒ‡å®šçš„sizeï¼ˆchannelé™¤å¤–ï¼‰ï¼‰</p>
<h2 id="6-bus-error-dataloader-num-worker"><a href="#6-bus-error-dataloader-num-worker" class="headerlink" title="6.bus error dataloader num_worker"></a>6.bus error dataloader num_worker</h2><p>åŸå› æš‚æ—¶è¿˜ä¸æ˜¯å¤ªæ¸…æ¥šï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥æŠŠnum_workerè®¾ç½®ä¸º0 æ¥è§£å†³è¿™ä¸ªé—®é¢˜.jpg</p>
<h2 id="7-bus-errorï¼šinsufficient-shared-memoryï¼ˆshmï¼‰"><a href="#7-bus-errorï¼šinsufficient-shared-memoryï¼ˆshmï¼‰" class="headerlink" title="7.bus errorï¼šinsufficient shared memoryï¼ˆshmï¼‰"></a>7.bus errorï¼šinsufficient shared memoryï¼ˆshmï¼‰</h2><p>è¿™ç§åŸå› é€šå¸¸ä¼šåœ¨dockerç¯å¢ƒä¸­å‡ºç°ï¼Œç”±äºæœªæŒ‡å®šshmå®¹é‡å¤§å°ï¼Œæ¯”å¦‚<code>ipc=host</code>ä¹‹ç±»çš„å‘½ä»¤ï¼Œå°±ä¼šå¯¼è‡´dockerçš„shmåªæœ‰64mï¼Œäºæ˜¯åœ¨è¿è¡Œçš„æ—¶å€™å°±ä¼šå‡ºé—®é¢˜ã€‚è¿™ç§æƒ…å†µä¸‹<strong>åªèƒ½é‡æ–°run docker</strong>ï¼ˆç›®å‰åªæ‰¾åˆ°äº†è¿™ä¸ªæ–¹æ³•ï¼‰ã€‚</p>
<p>å¦‚æœè¦å¦¥åçš„è¯ï¼Œå°±åªèƒ½<strong>è¯•ç€å‡å°batch_size</strong>ã€‚ä½†æ˜¯éšç€æ¨¡å‹çš„è®¾è®¡ä¸Šï¼Œè¿™å…¶å®ä¸æ˜¯ä¸€ä¸ªå¯ä»¥é€ƒé¿çš„é—®é¢˜ï¼Œä¹Ÿä¼šå¢åŠ è«é¡»æœ‰çš„å…¶ä»–æˆæœ¬ï¼Œæ‰€ä»¥ã€‚</p>
<h2 id="8-è®­ç»ƒè¿‡ç¨‹ä¸­Cacheå’ŒMemoryçš„å ç”¨é€æ¸å‡é«˜"><a href="#8-è®­ç»ƒè¿‡ç¨‹ä¸­Cacheå’ŒMemoryçš„å ç”¨é€æ¸å‡é«˜" class="headerlink" title="8.è®­ç»ƒè¿‡ç¨‹ä¸­Cacheå’ŒMemoryçš„å ç”¨é€æ¸å‡é«˜"></a>8.è®­ç»ƒè¿‡ç¨‹ä¸­Cacheå’ŒMemoryçš„å ç”¨é€æ¸å‡é«˜</h2><p>ä¸»è¦çš„ä½“ç°æ˜¯ï¼š<strong>é€æ¸å‡é«˜</strong>è¿™ä¸€ç‚¹ï¼Œè€Œä¸æ˜¯ç¨³å®šçš„æƒ…å†µï¼›</p>
<p>æœ‰ç‚¹ç„å­¦ï¼Œä½†æ˜¯åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åœ¨æ¯ä¸ªiterationç»“æŸçš„æ—¶å€™ä½¿ç”¨æ¸…æ¥šæ˜¾å­˜çš„å‡½æ•°ï¼Œç«Ÿç„¶å°±èƒ½è¿›è¡Œæ§åˆ¶äº†ï¼Œè™½ç„¶æˆ‘ä¸çŸ¥é“ä¸ºå•¥æ¸…æ¥šæ˜¾å­˜çš„å‡½æ•°ä¼šé¡ºä¾¿è¿å†…å­˜ä¸­çš„cacheä¹Ÿä¸€èµ·æ¸…é™¤äº†ï¼Œä½†æ˜¯å°±æ˜¯ï¼Œå­¦ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">torch.cuda.empty_cache()<br></code></pre></td></tr></table></figure>
<h2 id="9-æ¢¯åº¦çˆ†ç‚¸é—®é¢˜ï¼Œç®—æ³•æ²¡æœ‰å­¦ä¹ æ•ˆæœ"><a href="#9-æ¢¯åº¦çˆ†ç‚¸é—®é¢˜ï¼Œç®—æ³•æ²¡æœ‰å­¦ä¹ æ•ˆæœ" class="headerlink" title="9.æ¢¯åº¦çˆ†ç‚¸é—®é¢˜ï¼Œç®—æ³•æ²¡æœ‰å­¦ä¹ æ•ˆæœ"></a>9.æ¢¯åº¦çˆ†ç‚¸é—®é¢˜ï¼Œç®—æ³•æ²¡æœ‰å­¦ä¹ æ•ˆæœ</h2><p>æ¢¯åº¦çˆ†ç‚¸é—®é¢˜ï¼Œåˆ†æå¯èƒ½å‡ºç°å­˜åœ¨çš„é—®é¢˜ï¼š</p>
<ul>
<li>æŸä¸€éƒ¨åˆ†çš„å­¦ä¹ å‚æ•°å¯èƒ½çš„lrè¿‡é«˜ï¼Œæƒé‡è¿‡é«˜ï¼Œå¯¼è‡´è¯¯å·®å¿«é€Ÿä¼ æ’­ã€‚</li>
<li>é—®é¢˜çš„å¤æ‚åº¦è¿‡é«˜ï¼Œç®—æ³•overpoweräº†æŠŠã€‚</li>
</ul>
<p>é’ˆå¯¹äºç¬¬ä¸€ç‚¹çš„è¯ï¼Œæˆ‘ä»¬å‚è€ƒå·¥ç¨‹ç¬”è®°ä¸­çš„å­¦ä¹ ç‡è°ƒæ•´ç­–ç•¥å³å¯ã€‚</p>
<p>å¦‚æœæ˜¯é—®é¢˜çš„å¤æ‚åº¦è¿‡é«˜ï¼Œé‚£ä¹ˆå¯èƒ½æ˜¯é—®é¢˜å¯¹äºæˆ‘ä»¬çš„æ¨¡å‹æ¥è¯´å·²ç»overpowerçš„ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦å»åŠ æ·±ç½‘ç»œçš„å±‚æ•°ï¼Œæˆ–è€…å¯¹ç½‘ç»œè¿›è¡Œè¿›ä¸€æ­¥çš„è®¾è®¡å’Œå¯¹æ•°æ®çš„åˆ†æé—®é¢˜ã€‚</p>
<h2 id="10-ç±»å‹è½¬æ¢é—®é¢˜æ±‡æ€»"><a href="#10-ç±»å‹è½¬æ¢é—®é¢˜æ±‡æ€»" class="headerlink" title="10.ç±»å‹è½¬æ¢é—®é¢˜æ±‡æ€»"></a>10.ç±»å‹è½¬æ¢é—®é¢˜æ±‡æ€»</h2><ol>
<li>æ¯”å¦‚<code>scatter_</code>éœ€è¦å°†æ•°æ®ä»int32çš„æ ¼å¼è½¬æ¢æˆint64ï¼Œæˆ‘ä»¬è¦æŒæ¡ä¸€ä¸‹åœ¨Pytorchä¸­è¿›è¡Œæ•°æ®ç±»å‹è½¬æ¢çš„æŠ€å·§ã€‚</li>
<li><strong>Expected object of scalar type Float but got scalar type Double for argument #2 â€˜targetâ€™</strong> æ•°æ®ç±»å‹ä¸åŒ¹é…ï¼Œä¸€ä¸ªæ˜¯np.float32,å¦ä¸€ä¸ªæ˜¯64<br>å‚è€ƒè§£å†³æ–¹æ¡ˆï¼š<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/56741087/how-to-fix-runtimeerror-expected-object-of-scalar-type-float-but-got-scalar-typ">é‡è¦</a></li>
<li><p><strong>Expected object of scalar type Long but got scalar type Float for argument</strong><br>å¸Œæœ›å¾—åˆ°çš„æ˜¯Longå‹æ ‡é‡æ•°æ®ï¼Œä½†æ˜¯å¾—åˆ°äº†Floatå‹çš„æ•°æ®ï¼ˆå®é™…ä¸Šå¯èƒ½æ˜¯æˆ‘ä»¬è¿›è¡Œæµ‹è¯•çš„æ—¶å€™ä½¿ç”¨äº†å°æ•°å¸¦æ¥çš„ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿèƒ½å°†å…¶è½¬åŒ–å°±æ˜¯äº†ï¼‰</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">Longtensor()<br><span class="hljs-built_in">type</span>(torch.longtensor)<br><br></code></pre></td></tr></table></figure>
</li>
<li><p><strong>RuntimeError: Input type (torch.cuda.FloatTensor) and weight type (torch.DoubleTensor) should be the same</strong><br><strong>RuntimeError: Input type (torch.cuda.ByteTensor) and weight type (torch.cuda.FloatTensor) should be the same</strong>é—®é¢˜å®é™…ä¸Šéƒ½æ˜¯å’Œæƒé‡çš„æ•°æ®ç±»å‹ä¸åŒ¹é…ï¼Œéœ€è¦å°†å­—èŠ‚å‹æˆ–è€…æ˜¯FLoatå‹å‘Weightçš„æ•°æ®ç±»å‹è½¬æ¢ï¼Œä½†æ˜¯å¯èƒ½è¿™é‡Œçš„é—®é¢˜å®é™…ä¸Šå‡ºç°åœ¨å°±æ˜¯æˆ‘ä»¬å¯¼å…¥çš„æ•°æ®ç±»å‹æ˜¯ä¸æ­£ç¡®çš„ã€‚è¿˜æ˜¯ä½¿ç”¨<code>type()</code>å‘½ä»¤æ¥è¿›è¡Œæ•°æ®ç±»å‹çš„è½¬æ¢ï¼Œä½†æ˜¯å…³é”®è¿˜æ˜¯ï¼š<strong>æ£€æŸ¥è¾“å…¥æ•°æ®çš„ç±»å‹ä»¥åŠæ•°å€¼èŒƒå›´ï¼ŒåŒæ—¶çœ‹çœ‹åœ¨è¿›è¡Œdataloaderçš„æ—¶å€™æœ‰æ²¡æœ‰æŒ‡å®što_tensorçš„å˜æ¢ç­‰ç­‰</strong></p>
</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/75dff8e7ed18">å‚è€ƒèµ„æ–™é“¾æ¥</a></p>
<p><strong>è¿›è¡Œæ•°æ®è½¬æ¢çš„å‡ ç§æ–¹å¼</strong></p>
<ol>
<li><p>ä½¿ç”¨å‡½æ•°<code>tensor1.type_as(tensor2)</code>å°†1çš„æ•°æ®ç±»å‹è½¬æ¢æˆ2çš„æ•°æ®ç±»å‹ã€‚</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">tensor_1 = torch.FloatTensor(<span class="hljs-number">5</span>)<br>tensor_2 = torch.IntTensor([<span class="hljs-number">10</span>, <span class="hljs-number">20</span>])<br>tensor_1 = tensor_1.type_as(tensor_2)<br><br></code></pre></td></tr></table></figure>
</li>
<li><p><code>tensor.type(torch.IntTensor)</code></p>
</li>
<li><code>tensor.long()</code>,<code>tensor.char()</code>,<code>tensor.int()</code>,<code>tensor.byte()</code>,<code>tensor.double()</code></li>
<li><code>tenosr.to(torch.long)</code></li>
</ol>
<h2 id="11-æ•°æ®ç»´åº¦ä¸å¯¹åº”é—®é¢˜æ±‡æ€»"><a href="#11-æ•°æ®ç»´åº¦ä¸å¯¹åº”é—®é¢˜æ±‡æ€»" class="headerlink" title="11.æ•°æ®ç»´åº¦ä¸å¯¹åº”é—®é¢˜æ±‡æ€»"></a>11.æ•°æ®ç»´åº¦ä¸å¯¹åº”é—®é¢˜æ±‡æ€»</h2><ol>
<li><p><strong>multi-target not supported at</strong>é—®é¢˜å®é™…ä¸Šå¯ä»¥ç¿»è¯‘æˆï¼šç»´åº¦ä¸Šå’Œäº¤å‰ç†µæŸå¤±å‡½æ•°çš„éœ€æ±‚ä¸å¯¹åº”ã€‚åœ¨ä½¿ç”¨äº¤å‰ç†µæŸå¤±å‡½æ•°çš„æ—¶å€™ï¼Œtargetçš„å½¢çŠ¶åº”è¯¥æ˜¯å’Œlabelçš„å½¢çŠ¶ä¸€è‡´æˆ–è€…æ˜¯åªæœ‰batchsizeè¿™ä¸€ä¸ªç»´åº¦çš„ã€‚å¦‚æœtargetæ˜¯è¿™æ ·çš„ã€batchszieï¼Œ1ã€‘å°±ä¼šå‡ºç°ä¸Šè¿°çš„é”™è¯¯</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">ä½¿ç”¨squeezeï¼ˆï¼‰å‡½æ•°é™ä½ç»´åº¦<br></code></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="12-å–å‡ºå…·ä½“æ•°å€¼æ—¶å€™çš„é—®é¢˜"><a href="#12-å–å‡ºå…·ä½“æ•°å€¼æ—¶å€™çš„é—®é¢˜" class="headerlink" title="12.å–å‡ºå…·ä½“æ•°å€¼æ—¶å€™çš„é—®é¢˜"></a>12.å–å‡ºå…·ä½“æ•°å€¼æ—¶å€™çš„é—®é¢˜</h2><ol>
<li><strong>RuntimeError: Canâ€™t call numpy() on Variable that requires grad. Use var.detach().numpy()</strong>å¯¹äºè¾“å‡ºçš„ç»“æœè¦è½¬æ¢æˆå…·ä½“çš„æ•°å€¼çš„æ—¶å€™ï¼Œå¦‚æœæˆ‘ä»¬åç»­è¿˜éœ€è¦è¿™ä¸ªæ•°å€¼çš„æ¢¯åº¦ï¼Œå°±ä¸èƒ½è½¬æ¢åˆ°<code>cpu</code>åå†è½¬æ¢åˆ°<code>numpy</code>,å°±å¥½æ¯”è¯´ï¼Œæˆ‘ä»¬è¦å–å‡ºLossçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨item()å–å‡ºå…·ä½“çš„æ•°å€¼ï¼Œè€Œä¸éœ€è¦è½¬åˆ°CPU<a href="#">ä¸Š</a></li>
</ol>
<h2 id="13-CPUå ç”¨99"><a href="#13-CPUå ç”¨99" class="headerlink" title="13.CPUå ç”¨99%"></a>13.CPUå ç”¨99%</h2><p>é—®é¢˜æè¿°ï¼šä½¿ç”¨torchè‡ªå¸¦çš„datasetä¸­çš„cifar10çš„æ—¶å€™ï¼Œåœ¨æ¯ä¸ªepochç»“æŸçš„æ—¶å€™ï¼ŒCPUå ç”¨ç‡é«˜è¾¾99%ï¼Œå¹¶ä¸éšç€num_workderè€Œæ”¹å˜ï¼Œé—®é¢˜å¯èƒ½ç”±äºpytorchå¼€è¾Ÿäº†å¤ªå¤šçš„çº¿ç¨‹</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/stay_zezo/article/details/107809409">windows10ä¸‹pytorchçš„GPUåˆ©ç”¨ç‡ä½ï¼Œå ç”¨ç‡ä½_stay_zezoçš„åšå®¢-CSDNåšå®¢</a></p>
<p>å¯èƒ½æ˜¯ç”±äºGPUè¿ç®—å¤ªå¿«äº†ï¼Œå¯ç”¨äº†å¤šçº¿ç¨‹è¿›è¡ŒåŠ è½½æ•°æ®ï¼Œè¿™ç§æ—¶å€™å¯ç”¨<code>pin_memory=true</code> èƒ½èµ·åˆ°ä¸€å®šçš„ä½œç”¨æŠŠï¼ŒåŠ å¿«ä¸€ç‚¹æ•°æ®è¯»å–ã€‚</p>
<p>æœ€ç»ˆè§£å†³æ–¹æ¡ˆ ï¼š<code>pin-memory=false</code> åæ­£åŸå› å¾ˆç¥å¥‡ï¼Œä½†æ˜¯æœ€ç»ˆå°±æ˜¯å› ä¸ºè¿™ä¸ªè§£å†³çš„ï¼Œå¯èƒ½æ˜¯å› ä¸ºmemoryè¶…äº†ï¼Œæ‰€ä»¥æ¯æ¬¡éƒ½éœ€è¦é‡æ–°empty_cache é‡æ–°è£…è¿›é¡µï¼Œæ‰€ä»¥åè€ŒåŠ é‡äº†CPUçš„è´Ÿæ‹…</p>
<h2 id="14-é¢„æµ‹å€¼å…¨ä¸º0ï¼Œæ¨¡å‹æ”¶æ•›åˆ°å¥‡æ€ªçš„åœ°æ–¹ï¼ŒæŸå¤±ä¿æŒä¸€è‡´ï¼ˆå…¨å‡ç­‰ï¼‰"><a href="#14-é¢„æµ‹å€¼å…¨ä¸º0ï¼Œæ¨¡å‹æ”¶æ•›åˆ°å¥‡æ€ªçš„åœ°æ–¹ï¼ŒæŸå¤±ä¿æŒä¸€è‡´ï¼ˆå…¨å‡ç­‰ï¼‰" class="headerlink" title="14. é¢„æµ‹å€¼å…¨ä¸º0ï¼Œæ¨¡å‹æ”¶æ•›åˆ°å¥‡æ€ªçš„åœ°æ–¹ï¼ŒæŸå¤±ä¿æŒä¸€è‡´ï¼ˆå…¨å‡ç­‰ï¼‰"></a>14. é¢„æµ‹å€¼å…¨ä¸º0ï¼Œæ¨¡å‹æ”¶æ•›åˆ°å¥‡æ€ªçš„åœ°æ–¹ï¼ŒæŸå¤±ä¿æŒä¸€è‡´ï¼ˆå…¨å‡ç­‰ï¼‰</h2><p>è¿™ç§æƒ…å†µé€šå¸¸æ˜¯ç”±äºæ¨¡å‹è®¾è®¡ä¸­å­˜åœ¨ä¸€ç‚¹é—®é¢˜ï¼š</p>
<p>æ¯”å¦‚è¿™æ¬¡æ˜¯ç”±äºæ¨¡å‹ä¸­fcåé¢æ·»åŠ äº†reluï¼Œè¿™æ ·å¯¼è‡´è¾“å‡ºçš„è´Ÿå€¼å…¨è¢«æŠ‘åˆ¶äº†ï¼Œå¯¼è‡´å­¦ä¹ å‡ºç°äº†ä¸¥é‡çš„é”™è¯¯åæœã€‚</p>
<h2 id="15-æ¨¡å‹éƒ¨åˆ†ï¼š-è®­ç»ƒä¸­æ¨¡å‹å‡†ç¡®ç‡ä¸ä¸Šå‡"><a href="#15-æ¨¡å‹éƒ¨åˆ†ï¼š-è®­ç»ƒä¸­æ¨¡å‹å‡†ç¡®ç‡ä¸ä¸Šå‡" class="headerlink" title="15.æ¨¡å‹éƒ¨åˆ†ï¼š è®­ç»ƒä¸­æ¨¡å‹å‡†ç¡®ç‡ä¸ä¸Šå‡"></a>15.æ¨¡å‹éƒ¨åˆ†ï¼š è®­ç»ƒä¸­æ¨¡å‹å‡†ç¡®ç‡ä¸ä¸Šå‡</h2><p>ç”±äºæ¡†æ¶å·²ç»éªŒè¯è¿‡æ˜¯å¯ä»¥è¿›è¡Œæ­£å¸¸è®­ç»ƒçš„ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹å‡ºç°æ¨¡å‹çš„å‡†ç¡®ç‡ä¸ä¸Šå‡å¯èƒ½æ˜¯ç”±äºæ¨¡å‹æœ¬èº«è®¾è®¡ï¼ˆå†…éƒ¨ä»£ç ç¼–å†™ï¼‰ä¸Šçš„é—®é¢˜ã€‚</p>
<h2 id="16-On-entry-to-SGEMM-parameter-number-8-had-an-illegal-value"><a href="#16-On-entry-to-SGEMM-parameter-number-8-had-an-illegal-value" class="headerlink" title="16. On entry to SGEMM parameter number 8 had an illegal value"></a>16. On entry to SGEMM parameter number 8 had an illegal value</h2><p>Tracing failed sanity checks!<br>Graphs differed across invocations!</p>
<p>fcçš„é—®é¢˜ï¼Œè¾“å…¥fcå’Œå¯¹åº”çš„ç½‘ç»œè¾“å…¥å±‚ä¸ä¸€è‡´ï¼Œæ£€æŸ¥é˜¶æ®µæ•°ç›®å’Œfeatureè¾“å‡ºçš„ç‰¹å¾ç»´åº¦</p>
<h2 id="17-CUDA-error-device-side-assert-triggered-CUDA-kernel-errors-might-be-asynchronously-reported-at-some-other-API-call"><a href="#17-CUDA-error-device-side-assert-triggered-CUDA-kernel-errors-might-be-asynchronously-reported-at-some-other-API-call" class="headerlink" title="17. CUDA error: device-side assert triggered CUDA kernel errors might be asynchronously reported at some other API call"></a>17. CUDA error: device-side assert triggered CUDA kernel errors might be asynchronously reported at some other API call</h2><p>è¿™ä¸ªé—®é¢˜çš„å‡ºç°çš„æ ¹æœ¬åŸå› åœ¨äºï¼š</p>
<p>ç»´åº¦ä¸åŒ¹é…ï¼šæ ‡ç­¾çš„dimension è¶…å‡ºäº†å…¨è¿æ¥å±‚æœ€åè¾“å‡ºçš„dimensionï¼Œè¿™ä¸€éƒ¨åˆ†é”™è¯¯çš„è§¦å‘ï¼Œå’ŒLossçš„è®¡ç®—ï¼ŒAccçš„è®¡ç®—ï¼Œæœ‰ç€å¼ºçƒˆçš„ç›¸å…³å…³ç³»ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬åœ¨è®­ç»ƒç›¸å…³çš„éªŒè¯å’Œè®­ç»ƒç¯èŠ‚ï¼Œéœ€è¦ä¿æŒè®­ç»ƒæ•°æ®é›†å’ŒéªŒè¯æ•°æ®é›†åœ¨ç±»åˆ«æ•°ç›®ä¸Šçš„ä¸€è‡´æ€§ï¼Œè€Œåœ¨æˆ‘ä»¬éœ€è¦å¯¹æ•°æ®é›†å¤–çš„æ•°æ®è¿›è¡Œæµ‹è¯•çš„æ—¶å€™ï¼Œæˆ‘ä»¬é¿å…è¿›è¡ŒLossçš„è®¡ç®—ï¼Œåœ¨å¯¹Accè¿›è¡Œè®¡ç®—çš„æ—¶å€™ï¼Œä¹Ÿå°½é‡é¿å…Torchä¸­çš„è‡ªæœ‰åº“ï¼Œé¿å…äº§ç”Ÿè¯¥ç±»çš„é—®é¢˜/</p>
<h2 id="RuntimeError-the-derivative-for-target-is-not-implemented"><a href="#RuntimeError-the-derivative-for-target-is-not-implemented" class="headerlink" title="RuntimeError the derivative for target is not implemented"></a>RuntimeError the derivative for target is not implemented</h2><p>é—®é¢˜é€šå¸¸å‡ºç°åœ¨æŸå¤±è®¡ç®—çš„è¿‡ç¨‹ä¸­ï¼Œè¿™ä¸ªé”™è¯¯æ˜¯ç”±äºæˆ‘ä»¬åœ¨æŸå¤±ä¸­çš„ç¬¬äºŒé¡¹ <code>targets</code>ä¸åº”è¯¥æœ‰æ¢¯åº¦ï¼Œä½†æ˜¯åœ¨è¿™ä¸ªåœ°æ–¹å´å­˜åœ¨æ¢¯åº¦å¯¼è‡´çš„.</p>
<p>åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»…ä»…å–å‡º <code>tensor</code>çš„<code>data</code>æˆ–è€…ä½¿ç”¨<code>detach</code>and<code>copy</code>æ¥è¿›è¡Œæ•°å€¼çš„ä¼ é€’</p>
<h2 id="Only-Tensors-created-explicitly-by-the-user-graph-leaves-support-the-deepcopy-protocol-at-the-moment"><a href="#Only-Tensors-created-explicitly-by-the-user-graph-leaves-support-the-deepcopy-protocol-at-the-moment" class="headerlink" title="Only Tensors created explicitly by the user (graph leaves) support the deepcopy protocol at the moment"></a>Only Tensors created explicitly by the user (graph leaves) support the deepcopy protocol at the moment</h2><p>è¯¥é”™è¯¯æ˜¯ç”±deepcopyå’Œrequire_grad, require_fnåŒæ—¶æ„æˆ, å¦‚æœæˆ‘ä»¬å¯¹ä¸€ä¸ªéœ€è¦è®¡ç®—æ¢¯åº¦çš„éå¶å­èŠ‚ç‚¹è¿›è¡Œdeepcopyå°±ä¼šè§¦å‘è¿™ä¸ªé”™è¯¯ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬éœ€è¦å¯¹è¿™ä¸ªæ•°æ®è¿›è¡Œå­˜å‚¨çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡Œ<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">save = copy.deepcopy(feature.data.cpu().numpy())<br></code></pre></td></tr></table></figure></p>
</div><div class="article-licensing box"><div class="licensing-title"><p>PyTorch Handbook 00 ï¼ˆArchiveï¼‰</p><p><a href="http://aikenh.cn/cn/PyTorch/">http://aikenh.cn/cn/PyTorch/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>AikenH</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2021-12-15</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2023-10-30</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><hr style="height:1px;margin:1rem 0"><div class="level is-mobile is-flex"><div class="article-tags is-size-7 is-uppercase"><i class="fas fa-tags has-text-grey"></i>Â <a class="link-muted" rel="tag" href="/tags/Python/">Python,Â </a><a class="link-muted" rel="tag" href="/tags/Pytorch/">Pytorch </a></div></div><!--!--></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">Like this article? Support the author with</h3><div class="buttons is-centered"><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>Alipay</span><span class="qrcode"><img src="/img/alipay.jpg" alt="Alipay"></span></a><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>Wechat</span><span class="qrcode"><img src="/img/wechat.jpg" alt="Wechat"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/cn/NerualNetworkTraining/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Training Strategy</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/cn/Loss-WhyZero/"><span class="level-item">Loss-WhyZero</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_config = function () {
            this.page.url = 'http://aikenh.cn/cn/PyTorch/';
            this.page.identifier = 'cn/PyTorch/';
        };
        (function() {
            var d = document, s = d.createElement('script');  
            s.src = '//' + 'my-tech-blog-3' + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/title.jpg" alt="AikenH"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">AikenH</p><p class="is-size-6 is-block">Future Full-Stack Developer</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>ShenZhen</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">137</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">42</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">101</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/AikenH" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="ZhiHu" href="https://www.zhihu.com/people/Aiken-h"><i class="fab fa-zhihu"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Weibo" href="https://weibo.com/u/1788200627"><i class="fab fa-weibo"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Steam" href="https://steamcommunity.com/id/AikenH/"><i class="fab fa-steam"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/AikenH"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/atom.xml"><i class="fas fa-rss"></i></a></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="level is-mobile" href="#Basic-PartåŸºç¡€è®¾å®šéƒ¨åˆ†"><span class="level-left"><span class="level-item">1</span><span class="level-item">Basic PartåŸºç¡€è®¾å®šéƒ¨åˆ†</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Tensorå¼ é‡è®¡ç®—"><span class="level-left"><span class="level-item">1.1</span><span class="level-item">Tensorå¼ é‡è®¡ç®—</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#ä¸¤ä¸ªtensorçš„æ•°ä¹˜"><span class="level-left"><span class="level-item">1.1.1</span><span class="level-item">ä¸¤ä¸ªtensorçš„æ•°ä¹˜</span></span></a></li><li><a class="level is-mobile" href="#å¼ é‡å‘½å"><span class="level-left"><span class="level-item">1.1.2</span><span class="level-item">å¼ é‡å‘½å</span></span></a></li><li><a class="level is-mobile" href="#ç±»å‹è½¬æ¢"><span class="level-left"><span class="level-item">1.1.3</span><span class="level-item">ç±»å‹è½¬æ¢</span></span></a></li><li><a class="level is-mobile" href="#ç»´åº¦å †å "><span class="level-left"><span class="level-item">1.1.4</span><span class="level-item">ç»´åº¦å †å </span></span></a></li></ul></li><li><a class="level is-mobile" href="#åŸºæœ¬çš„å¼ é‡å‡½æ•°"><span class="level-left"><span class="level-item">1.2</span><span class="level-item">åŸºæœ¬çš„å¼ é‡å‡½æ•°</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#é€‰å–åˆ’çª—"><span class="level-left"><span class="level-item">1.2.1</span><span class="level-item">é€‰å–åˆ’çª—</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Torchç¯å¢ƒè®¾ç½®"><span class="level-left"><span class="level-item">1.3</span><span class="level-item">Torchç¯å¢ƒè®¾ç½®</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#pytorchä¸­çš„éšæœºç§å­åˆå§‹åŒ–"><span class="level-left"><span class="level-item">1.3.1</span><span class="level-item">pytorchä¸­çš„éšæœºç§å­åˆå§‹åŒ–</span></span></a></li><li><a class="level is-mobile" href="#nn-parameter"><span class="level-left"><span class="level-item">1.3.2</span><span class="level-item">nn.parameter()</span></span></a></li><li><a class="level is-mobile" href="#nn-Softmaxä¸­çš„dim"><span class="level-left"><span class="level-item">1.3.3</span><span class="level-item">nn.Softmaxä¸­çš„dim</span></span></a></li></ul></li><li><a class="level is-mobile" href="#æµ‹è¯•ã€éªŒè¯æ¨¡å—"><span class="level-left"><span class="level-item">1.4</span><span class="level-item">æµ‹è¯•ã€éªŒè¯æ¨¡å—</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#åŸºæœ¬ç¼–å†™"><span class="level-left"><span class="level-item">1.4.1</span><span class="level-item">åŸºæœ¬ç¼–å†™</span></span></a></li><li><a class="level is-mobile" href="#model-eval-å’Œmodel-train-çš„åŒºåˆ«"><span class="level-left"><span class="level-item">1.4.2</span><span class="level-item">model.eval()å’Œmodel.train()çš„åŒºåˆ«</span></span></a></li><li><a class="level is-mobile" href="#with-torch-no-grad"><span class="level-left"><span class="level-item">1.4.3</span><span class="level-item">with torch.no_grad()</span></span></a></li><li><a class="level is-mobile" href="#æ¨¡å‹çš„ä¿å­˜å’Œè¯»å–ä¸“é¢˜"><span class="level-left"><span class="level-item">1.4.4</span><span class="level-item">æ¨¡å‹çš„ä¿å­˜å’Œè¯»å–ä¸“é¢˜</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#GPUç›¸å…³çš„è®¾ç½®"><span class="level-left"><span class="level-item">2</span><span class="level-item">GPUç›¸å…³çš„è®¾ç½®</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#æŸ¥çœ‹GPUçŠ¶æ€"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">æŸ¥çœ‹GPUçŠ¶æ€</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#è®¾ç½®é»˜è®¤GPUè®¾å¤‡"><span class="level-left"><span class="level-item">2.1.1</span><span class="level-item">è®¾ç½®é»˜è®¤GPUè®¾å¤‡</span></span></a></li><li><a class="level is-mobile" href="#è®¾å¤‡åŸºæœ¬ä¿¡æ¯"><span class="level-left"><span class="level-item">2.1.2</span><span class="level-item">è®¾å¤‡åŸºæœ¬ä¿¡æ¯</span></span></a></li></ul></li><li><a class="level is-mobile" href="#GPUä½¿ç”¨ç‡ä¼˜åŒ–ï¼ˆæ³¨æ„äº‹é¡¹ï¼‰"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">GPUä½¿ç”¨ç‡ä¼˜åŒ–ï¼ˆæ³¨æ„äº‹é¡¹ï¼‰</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#ç¼“å­˜çˆ†ç‚¸é—®é¢˜"><span class="level-left"><span class="level-item">2.2.1</span><span class="level-item">ç¼“å­˜çˆ†ç‚¸é—®é¢˜</span></span></a></li><li><a class="level is-mobile" href="#è¿è¡Œæ•ˆç‡ä¼˜åŒ–"><span class="level-left"><span class="level-item">2.2.2</span><span class="level-item">è¿è¡Œæ•ˆç‡ä¼˜åŒ–</span></span></a></li><li><a class="level is-mobile" href="#è®¾ç½®ä½¿ç”¨GPUçš„æ–¹å¼"><span class="level-left"><span class="level-item">2.2.3</span><span class="level-item">è®¾ç½®ä½¿ç”¨GPUçš„æ–¹å¼</span></span></a></li><li><a class="level is-mobile" href="#è®¾ç½®ç›¸åº”çš„éšæœºç§å­"><span class="level-left"><span class="level-item">2.2.4</span><span class="level-item">è®¾ç½®ç›¸åº”çš„éšæœºç§å­</span></span></a></li><li><a class="level is-mobile" href="#CUDAè½¬æ¢"><span class="level-left"><span class="level-item">2.2.5</span><span class="level-item">CUDAè½¬æ¢</span></span></a></li><li><a class="level is-mobile" href="#å¤šGPUå¹¶è¡Œ"><span class="level-left"><span class="level-item">2.2.6</span><span class="level-item">å¤šGPUå¹¶è¡Œ</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#CPU"><span class="level-left"><span class="level-item">3</span><span class="level-item">CPU</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#æ ¸å¿ƒå’Œçº¿ç¨‹æ•°è®¾ç½®"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">æ ¸å¿ƒå’Œçº¿ç¨‹æ•°è®¾ç½®</span></span></a></li></ul></li><li><a class="level is-mobile" href="#ç½‘ç»œå®šä¹‰æ¨¡å—"><span class="level-left"><span class="level-item">4</span><span class="level-item">ç½‘ç»œå®šä¹‰æ¨¡å—</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#æ•°æ®å®šä¹‰æ¨¡å—"><span class="level-left"><span class="level-item">4.1</span><span class="level-item">æ•°æ®å®šä¹‰æ¨¡å—</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#åˆ©ç”¨TorchVisionè¯»å–æœ¬åœ°æ•°æ®"><span class="level-left"><span class="level-item">4.1.1</span><span class="level-item">åˆ©ç”¨TorchVisionè¯»å–æœ¬åœ°æ•°æ®</span></span></a></li><li><a class="level is-mobile" href="#torch-è‡ªå®šä¹‰Datasetåçš„ä½¿ç”¨"><span class="level-left"><span class="level-item">4.1.2</span><span class="level-item">torch è‡ªå®šä¹‰Datasetåçš„ä½¿ç”¨</span></span></a></li><li><a class="level is-mobile" href="#Dataloaderä¸­çš„transformerï¼ˆï¼‰ï¼š"><span class="level-left"><span class="level-item">4.1.3</span><span class="level-item">Dataloaderä¸­çš„transformerï¼ˆï¼‰ï¼š</span></span></a></li><li><a class="level is-mobile" href="#Dataloaderä¸­çš„å‚æ•°"><span class="level-left"><span class="level-item">4.1.4</span><span class="level-item">Dataloaderä¸­çš„å‚æ•°</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#collate-fn"><span class="level-left"><span class="level-item">4.1.4.1</span><span class="level-item">collate_fn()</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#ç¼–å†™æ¨¡å‹"><span class="level-left"><span class="level-item">4.2</span><span class="level-item">ç¼–å†™æ¨¡å‹</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#æ¨¡å‹åŸºæœ¬å•å…ƒ"><span class="level-left"><span class="level-item">4.2.1</span><span class="level-item">æ¨¡å‹åŸºæœ¬å•å…ƒ</span></span></a></li><li><a class="level is-mobile" href="#æ¨¡å‹å‚æ•°å…±äº«ï¼š"><span class="level-left"><span class="level-item">4.2.2</span><span class="level-item">æ¨¡å‹å‚æ•°å…±äº«ï¼š</span></span></a></li><li><a class="level is-mobile" href="#ç½‘ç»œå®šä¹‰çš„æ–¹å¼å¯¹æ¯”åˆ†æ"><span class="level-left"><span class="level-item">4.2.3</span><span class="level-item">ç½‘ç»œå®šä¹‰çš„æ–¹å¼å¯¹æ¯”åˆ†æ</span></span></a></li><li><a class="level is-mobile" href="#Detach-amp-detach"><span class="level-left"><span class="level-item">4.2.4</span><span class="level-item">Detach &amp; detach_</span></span></a></li><li><a class="level is-mobile" href="#æ¨¡å‹è°ƒç”¨çš„Tips"><span class="level-left"><span class="level-item">4.2.5</span><span class="level-item">æ¨¡å‹è°ƒç”¨çš„Tips</span></span></a></li><li><a class="level is-mobile" href="#Warm-up-factor"><span class="level-left"><span class="level-item">4.2.6</span><span class="level-item">Warm-up factor</span></span></a></li><li><a class="level is-mobile" href="#Weight-decayï¼ˆL2ï¼‰"><span class="level-left"><span class="level-item">4.2.7</span><span class="level-item">Weight decayï¼ˆL2ï¼‰</span></span></a></li><li><a class="level is-mobile" href="#Learning-Rate-Decay"><span class="level-left"><span class="level-item">4.2.8</span><span class="level-item">Learning Rate Decay</span></span></a></li></ul></li><li><a class="level is-mobile" href="#æŸå¤±å‡½æ•°"><span class="level-left"><span class="level-item">4.3</span><span class="level-item">æŸå¤±å‡½æ•°</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#CrossEntropyäº¤å‰ç†µ"><span class="level-left"><span class="level-item">4.3.1</span><span class="level-item">CrossEntropyäº¤å‰ç†µ</span></span></a></li></ul></li><li><a class="level is-mobile" href="#ä¼˜åŒ–å™¨è®¾è®¡"><span class="level-left"><span class="level-item">4.4</span><span class="level-item">ä¼˜åŒ–å™¨è®¾è®¡</span></span></a></li><li><a class="level is-mobile" href="#æ¨¡å‹å‚æ•°åˆå§‹åŒ–å’Œæ¶æ„æŸ¥çœ‹æ–¹æ³•"><span class="level-left"><span class="level-item">4.5</span><span class="level-item">æ¨¡å‹å‚æ•°åˆå§‹åŒ–å’Œæ¶æ„æŸ¥çœ‹æ–¹æ³•</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#childrenã€modulesã€parametersï¼š"><span class="level-left"><span class="level-item">4.5.1</span><span class="level-item">childrenã€modulesã€parametersï¼š</span></span></a></li><li><a class="level is-mobile" href="#åˆå§‹åŒ–åŸåˆ™ï¼šï¼ˆç»§ç»­è°ƒç ”ï¼‰"><span class="level-left"><span class="level-item">4.5.2</span><span class="level-item">åˆå§‹åŒ–åŸåˆ™ï¼šï¼ˆç»§ç»­è°ƒç ”ï¼‰</span></span></a></li><li><a class="level is-mobile" href="#å…¸å‹çš„å‚æ•°åˆå§‹åŒ–æ–¹æ³•"><span class="level-left"><span class="level-item">4.5.3</span><span class="level-item">å…¸å‹çš„å‚æ•°åˆå§‹åŒ–æ–¹æ³•</span></span></a></li></ul></li><li><a class="level is-mobile" href="#æ•°æ®ç±»å‹å’Œç»´åº¦"><span class="level-left"><span class="level-item">4.6</span><span class="level-item">æ•°æ®ç±»å‹å’Œç»´åº¦</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#è¾“å…¥æ•°æ®çš„é€šé“"><span class="level-left"><span class="level-item">4.6.1</span><span class="level-item">è¾“å…¥æ•°æ®çš„é€šé“</span></span></a></li><li><a class="level is-mobile" href="#æ ‡ç­¾çš„å½¢å¼è½¬æ¢one-hot"><span class="level-left"><span class="level-item">4.6.2</span><span class="level-item">æ ‡ç­¾çš„å½¢å¼è½¬æ¢one-hot</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#Visualize-å¯è§†åŒ–éƒ¨åˆ†"><span class="level-left"><span class="level-item">5</span><span class="level-item">Visualize å¯è§†åŒ–éƒ¨åˆ†</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Tensorboard-in-Pytorch"><span class="level-left"><span class="level-item">5.1</span><span class="level-item">Tensorboard in Pytorch</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Histogram-ç›´æ–¹å›¾å‚æ•°ç»Ÿè®¡"><span class="level-left"><span class="level-item">5.1.1</span><span class="level-item">Histogram ç›´æ–¹å›¾å‚æ•°ç»Ÿè®¡</span></span></a></li><li><a class="level is-mobile" href="#Embedding-Projection"><span class="level-left"><span class="level-item">5.1.2</span><span class="level-item">Embedding Projection</span></span></a></li><li><a class="level is-mobile" href="#PR-CURVE"><span class="level-left"><span class="level-item">5.1.3</span><span class="level-item">PR_CURVE</span></span></a></li><li><a class="level is-mobile" href="#Add-TEXT"><span class="level-left"><span class="level-item">5.1.4</span><span class="level-item">Add_TEXT</span></span></a></li><li><a class="level is-mobile" href="#ADD-Figure"><span class="level-left"><span class="level-item">5.1.5</span><span class="level-item">ADD_Figure</span></span></a></li></ul></li><li><a class="level is-mobile" href="#å¯è§†åŒ–ç¥ç»ç½‘ç»œçƒ­åŠ›å›¾ï¼ˆCAMï¼‰"><span class="level-left"><span class="level-item">5.2</span><span class="level-item">å¯è§†åŒ–ç¥ç»ç½‘ç»œçƒ­åŠ›å›¾ï¼ˆCAMï¼‰</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#ç®—æ³•åŸç†"><span class="level-left"><span class="level-item">5.2.1</span><span class="level-item">ç®—æ³•åŸç†</span></span></a></li><li><a class="level is-mobile" href="#ä»£ç å®ç°ï¼š"><span class="level-left"><span class="level-item">5.2.2</span><span class="level-item">ä»£ç å®ç°ï¼š</span></span></a></li></ul></li><li><a class="level is-mobile" href="#BUGs"><span class="level-left"><span class="level-item">5.3</span><span class="level-item">BUGs</span></span></a></li></ul></li><li><a class="level is-mobile" href="#DEBUG"><span class="level-left"><span class="level-item">6</span><span class="level-item">DEBUG</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#1-ImportError-cannot-import-name-â€˜PILLOW-VERSIONâ€™"><span class="level-left"><span class="level-item">6.1</span><span class="level-item">1.ImportError: cannot import name â€˜PILLOW_VERSIONâ€™</span></span></a></li><li><a class="level is-mobile" href="#2-æ¨¡å‹å‚æ•°-amp-è®¡ç®—é‡ç»Ÿè®¡-and-Debugè¾“å‡º"><span class="level-left"><span class="level-item">6.2</span><span class="level-item">2.æ¨¡å‹å‚æ•°&amp;è®¡ç®—é‡ç»Ÿè®¡ and Debugè¾“å‡º</span></span></a></li><li><a class="level is-mobile" href="#3-PyTorchåŠ è½½é¢„è®­ç»ƒæ¨¡å‹"><span class="level-left"><span class="level-item">6.3</span><span class="level-item">3.PyTorchåŠ è½½é¢„è®­ç»ƒæ¨¡å‹</span></span></a></li><li><a class="level is-mobile" href="#4-some-of-the-strides-of-a-given-numpy-array-are-negative"><span class="level-left"><span class="level-item">6.4</span><span class="level-item">4.some of the strides of a given numpy array are negative.</span></span></a></li><li><a class="level is-mobile" href="#5-è¯»å–loaderçš„æ—¶å€™å›¾åƒçš„å¤§å°ä¸ä¸€"><span class="level-left"><span class="level-item">6.5</span><span class="level-item">5.è¯»å–loaderçš„æ—¶å€™å›¾åƒçš„å¤§å°ä¸ä¸€</span></span></a></li><li><a class="level is-mobile" href="#6-bus-error-dataloader-num-worker"><span class="level-left"><span class="level-item">6.6</span><span class="level-item">6.bus error dataloader num_worker</span></span></a></li><li><a class="level is-mobile" href="#7-bus-errorï¼šinsufficient-shared-memoryï¼ˆshmï¼‰"><span class="level-left"><span class="level-item">6.7</span><span class="level-item">7.bus errorï¼šinsufficient shared memoryï¼ˆshmï¼‰</span></span></a></li><li><a class="level is-mobile" href="#8-è®­ç»ƒè¿‡ç¨‹ä¸­Cacheå’ŒMemoryçš„å ç”¨é€æ¸å‡é«˜"><span class="level-left"><span class="level-item">6.8</span><span class="level-item">8.è®­ç»ƒè¿‡ç¨‹ä¸­Cacheå’ŒMemoryçš„å ç”¨é€æ¸å‡é«˜</span></span></a></li><li><a class="level is-mobile" href="#9-æ¢¯åº¦çˆ†ç‚¸é—®é¢˜ï¼Œç®—æ³•æ²¡æœ‰å­¦ä¹ æ•ˆæœ"><span class="level-left"><span class="level-item">6.9</span><span class="level-item">9.æ¢¯åº¦çˆ†ç‚¸é—®é¢˜ï¼Œç®—æ³•æ²¡æœ‰å­¦ä¹ æ•ˆæœ</span></span></a></li><li><a class="level is-mobile" href="#10-ç±»å‹è½¬æ¢é—®é¢˜æ±‡æ€»"><span class="level-left"><span class="level-item">6.10</span><span class="level-item">10.ç±»å‹è½¬æ¢é—®é¢˜æ±‡æ€»</span></span></a></li><li><a class="level is-mobile" href="#11-æ•°æ®ç»´åº¦ä¸å¯¹åº”é—®é¢˜æ±‡æ€»"><span class="level-left"><span class="level-item">6.11</span><span class="level-item">11.æ•°æ®ç»´åº¦ä¸å¯¹åº”é—®é¢˜æ±‡æ€»</span></span></a></li><li><a class="level is-mobile" href="#12-å–å‡ºå…·ä½“æ•°å€¼æ—¶å€™çš„é—®é¢˜"><span class="level-left"><span class="level-item">6.12</span><span class="level-item">12.å–å‡ºå…·ä½“æ•°å€¼æ—¶å€™çš„é—®é¢˜</span></span></a></li><li><a class="level is-mobile" href="#13-CPUå ç”¨99"><span class="level-left"><span class="level-item">6.13</span><span class="level-item">13.CPUå ç”¨99%</span></span></a></li><li><a class="level is-mobile" href="#14-é¢„æµ‹å€¼å…¨ä¸º0ï¼Œæ¨¡å‹æ”¶æ•›åˆ°å¥‡æ€ªçš„åœ°æ–¹ï¼ŒæŸå¤±ä¿æŒä¸€è‡´ï¼ˆå…¨å‡ç­‰ï¼‰"><span class="level-left"><span class="level-item">6.14</span><span class="level-item">14. é¢„æµ‹å€¼å…¨ä¸º0ï¼Œæ¨¡å‹æ”¶æ•›åˆ°å¥‡æ€ªçš„åœ°æ–¹ï¼ŒæŸå¤±ä¿æŒä¸€è‡´ï¼ˆå…¨å‡ç­‰ï¼‰</span></span></a></li><li><a class="level is-mobile" href="#15-æ¨¡å‹éƒ¨åˆ†ï¼š-è®­ç»ƒä¸­æ¨¡å‹å‡†ç¡®ç‡ä¸ä¸Šå‡"><span class="level-left"><span class="level-item">6.15</span><span class="level-item">15.æ¨¡å‹éƒ¨åˆ†ï¼š è®­ç»ƒä¸­æ¨¡å‹å‡†ç¡®ç‡ä¸ä¸Šå‡</span></span></a></li><li><a class="level is-mobile" href="#16-On-entry-to-SGEMM-parameter-number-8-had-an-illegal-value"><span class="level-left"><span class="level-item">6.16</span><span class="level-item">16. On entry to SGEMM parameter number 8 had an illegal value</span></span></a></li><li><a class="level is-mobile" href="#17-CUDA-error-device-side-assert-triggered-CUDA-kernel-errors-might-be-asynchronously-reported-at-some-other-API-call"><span class="level-left"><span class="level-item">6.17</span><span class="level-item">17. CUDA error: device-side assert triggered CUDA kernel errors might be asynchronously reported at some other API call</span></span></a></li><li><a class="level is-mobile" href="#RuntimeError-the-derivative-for-target-is-not-implemented"><span class="level-left"><span class="level-item">6.18</span><span class="level-item">RuntimeError the derivative for target is not implemented</span></span></a></li><li><a class="level is-mobile" href="#Only-Tensors-created-explicitly-by-the-user-graph-leaves-support-the-deepcopy-protocol-at-the-moment"><span class="level-left"><span class="level-item">6.19</span><span class="level-item">Only Tensors created explicitly by the user (graph leaves) support the deepcopy protocol at the moment</span></span></a></li></ul></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><figure class="media-left"><a class="image" href="/cn/pwsh_BgTask/"><img src="/img/header_img/lml_bg18.jpg" alt="Windows Powershell 01 åå°ä»»åŠ¡"></a></figure><div class="media-content"><p class="date"><time dateTime="2024-01-28T07:44:25.000Z">2024-01-28</time></p><p class="title"><a href="/cn/pwsh_BgTask/">Windows Powershell 01 åå°ä»»åŠ¡</a></p><p class="categories"><a href="/categories/Windows/">Windows</a> / <a href="/categories/Windows/Powershell/">Powershell</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/cn/StableDiffusionWebUI%E9%89%B4%E6%9D%83%E8%AE%BE%E8%AE%A1/"><img src="/img/header_img/lml_bg16.jpg" alt="StableDiffusionWebUIé‰´æƒè®¾è®¡"></a></figure><div class="media-content"><p class="date"><time dateTime="2024-01-27T07:42:36.000Z">2024-01-27</time></p><p class="title"><a href="/cn/StableDiffusionWebUI%E9%89%B4%E6%9D%83%E8%AE%BE%E8%AE%A1/">StableDiffusionWebUIé‰´æƒè®¾è®¡</a></p><p class="categories"><a href="/categories/Machine-Learning/">Machine Learning</a> / <a href="/categories/Machine-Learning/AIGC/">AIGC</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/cn/BackupToolsForHomeServer/"><img src="/img/header_img/lml_bg14.jpg" alt="å®¶åº­æœåŠ¡å™¨çš„å¤‡ä»½å·¥å…·é€‰æ‹©"></a></figure><div class="media-content"><p class="date"><time dateTime="2023-12-29T00:04:06.000Z">2023-12-29</time></p><p class="title"><a href="/cn/BackupToolsForHomeServer/">å®¶åº­æœåŠ¡å™¨çš„å¤‡ä»½å·¥å…·é€‰æ‹©</a></p><p class="categories"><a href="/categories/NAS/">NAS</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/cn/%E5%AE%B6%E5%BA%AD%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%B4%E4%BD%93%E6%96%B9%E6%A1%88/"><img src="/img/header_img/lml_bg15.jpg" alt="å®¶åº­æœåŠ¡å™¨æ•´ä½“æ–¹æ¡ˆ"></a></figure><div class="media-content"><p class="date"><time dateTime="2023-12-20T00:24:36.000Z">2023-12-20</time></p><p class="title"><a href="/cn/%E5%AE%B6%E5%BA%AD%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%B4%E4%BD%93%E6%96%B9%E6%A1%88/">å®¶åº­æœåŠ¡å™¨æ•´ä½“æ–¹æ¡ˆ</a></p><p class="categories"><a href="/categories/NAS/">NAS</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/cn/%E6%A0%91%E8%8E%93%E6%B4%BE%E5%AE%B6%E5%BA%AD%E5%BD%B1%E9%9F%B3%E4%B8%AD%E5%BF%832/"><img src="/img/header_img/lml_bg1.jpg" alt="æ ‘è“æ´¾å®¶åº­å½±éŸ³ä¸­å¿ƒ2"></a></figure><div class="media-content"><p class="date"><time dateTime="2023-11-11T04:08:37.000Z">2023-11-11</time></p><p class="title"><a href="/cn/%E6%A0%91%E8%8E%93%E6%B4%BE%E5%AE%B6%E5%BA%AD%E5%BD%B1%E9%9F%B3%E4%B8%AD%E5%BF%832/">æ ‘è“æ´¾å®¶åº­å½±éŸ³ä¸­å¿ƒ2</a></p><p class="categories"><a href="/categories/Dev/">Dev</a> / <a href="/categories/Dev/Raspberry-pie/">Raspberry-pie</a></p></div></article></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">Aiken&#039;s Blog</a><p class="is-size-7"><span>&copy; 2024 AikenH</span>Â Â Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>Â &amp;Â <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_pv">Visited by <span id="busuanzi_value_site_uv">0</span> users</span> and <span id="busuanzi_container2_site_uv"><span id="busuanzi_value_site_pv">0</span>&nbsp;visits</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.9/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><script src="/js/night.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">Ã—</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>